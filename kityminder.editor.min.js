/*!
 * ====================================================
 * km-editor - v0.0.1 - 2015-05-12
 * https://github.com/fex-team/kityminder-editor
 * GitHub: https://github.com/fex-team/kityminder-editor 
 * Copyright (c) 2015 ; Licensed 
 * ====================================================
 */

!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(a,c,d){function e(a){g.push(a)}function f(a){this.selector=a;for(var b=0;b<g.length;b++)"function"==typeof g[b]&&g[b].call(this,this)}var g=[];return f.assemble=e,e(b.r(5)),e(b.r(6)),e(b.r(10)),e(b.r(12)),e(b.r(7)),e(b.r(8)),e(b.r(11)),e(b.r(9)),d.exports=f}},b[1]={value:function(a,c,d){var e=window.kityminder=b.r(55);return d.exports=e.Editor=b.r(0)}},b[2]={value:function(a,c,d){var e=b.r(19);return d.exports=e}},b[3]={value:function(){}},b[4]={value:function(a,c,d){var e=b.r(55).Minder,f=window.KM=window.KityMinder=function(){var a={},b=0,c={};return{version:"1.3.5",uuid:function(a){return a=a||"unknown",c[a]=c[a]||0,++c[a],a+"_"+c[a]},createMinder:function(a,b){b=b||{},b.renderTo=Utils.isString(a)?document.getElementById(a):a;var c=new e(b);return this.addMinder(b.renderTo,c),c},addMinder:function(c,d){var e;e="string"==typeof c?c:c.id||"KM_INSTANCE_"+b++,a[e]=d},getMinder:function(c,d){var e;return e="string"==typeof c?c:c.id||"KM_INSTANCE_"+b++,a[e]||this.createMinder(c,d)},LANG:{}}}(),g=Utils=f.Utils={extend:kity.Utils.extend.bind(kity.Utils),listen:function(a,b,c){var d=g.isArray(b)?b:g.trim(b).split(/\s+/),e=d.length;if(e)for(;e--;)if(b=d[e],a.addEventListener)a.addEventListener(b,c,!1);else{c._d||(c._d={els:[]});var f=b+c.toString(),h=g.indexOf(c._d.els,a);c._d[f]&&-1!=h||(-1==h&&c._d.els.push(a),c._d[f]||(c._d[f]=function(a){return c.call(a.srcElement,a||window.event)}),a.attachEvent("on"+b,c._d[f]))}a=null},trim:function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},each:function(a,b,c){if(null!=a)if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,d,a[d],a)===!1)return!1}else for(var f in a)if(a.hasOwnProperty(f)&&b.call(c,f,a[f],a)===!1)return!1},addCssRule:function(a,b,c){var d;return void 0===b||b&&b.nodeType&&9==b.nodeType?(c=b&&b.nodeType&&9==b.nodeType?b:c||document,d=c.getElementById(a),d?d.innerHTML:void 0):(c=c||document,d=c.getElementById(a),""===b?d?(d.parentNode.removeChild(d),!0):!1:void(d?d.innerHTML=b:(d=c.createElement("style"),d.id=a,d.innerHTML=b,c.getElementsByTagName("head")[0].appendChild(d))))},keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},proxy:function(a,b){return function(){return a.apply(b,arguments)}},indexOf:function(a,b,c){var d=-1;return c=this.isNumber(c)?c:0,this.each(a,function(a,e){return e>=c&&a===b?(d=e,!1):void 0}),d},argsToArray:function(a,b){return Array.prototype.slice.call(a,b||0)},clonePlainObject:function(a,b){var c;b=b||{};for(var d in a)a.hasOwnProperty(d)&&(c=a[d],g.isObject(c)||g.isArray(c)?(b[d]=g.isArray(c)?[]:{},g.clonePlainObject(a[d],b[d])):b[d]=c);return b},compareObject:function(a,b){var c;if(this.isEmptyObject(a)!==this.isEmptyObject(b))return!1;if(this.getObjectLength(a)!=this.getObjectLength(b))return!1;for(var d in a)if(a.hasOwnProperty(d)){if(c=a[d],void 0===b[d])return!1;if(this.isObject(c)||this.isArray(c)){if(this.isObject(b[d])!==this.isObject(c))return!1;if(this.isArray(c)!==this.isArray(b[d]))return!1;if(this.compareObject(c,b[d])===!1)return!1}else if(c!=b[d])return!1}return!0},getObjectLength:function(a){if(this.isArray(a)||this.isString(a))return a.length;var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},isEmptyObject:function(a){if(null==a)return!0;if(this.isArray(a)||this.isString(a))return 0===a.length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},loadFile:function(){function a(a,c){try{for(var d,e=0;d=b[e++];)if(d.doc===a&&d.url==(c.src||c.href))return d}catch(f){return null}}var b=[];return function(c,d,e){var f=a(c,d);if(f)return void(f.ready?e&&e():f.funs.push(e));if(b.push({doc:c,url:d.src||d.href,funs:[e]}),!c.body){var g=[];for(var h in d)"tag"!=h&&g.push(h+'="'+d[h]+'"');return void c.write("<"+d.tag+" "+g.join(" ")+" ></"+d.tag+">")}if(!d.id||!c.getElementById(d.id)){var i=c.createElement(d.tag);delete d.tag;for(var h in d)i.setAttribute(h,d[h]);i.onload=i.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(f=a(c,d),f.funs.length>0){f.ready=1;for(var b;b=f.funs.pop();)b()}i.onload=i.onreadystatechange=null}},c.getElementsByTagName("head")[0].appendChild(i)}}}(),clone:function(a,b){var c;b=b||{};for(var d in a)a.hasOwnProperty(d)&&(c=a[d],"object"==typeof c?(b[d]=g.isArray(c)?[]:{},g.clone(a[d],b[d])):b[d]=c);return b},unhtml:function(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},cloneArr:function(a){return[].concat(a)},clearWhitespace:function(a){return a.replace(/[\u200b\t\r\n]/g,"")},getValueByIndex:function(a,b){var c=0,d=0;return g.each(a,function(a,e){if(c+e.length>=b){if(b-c==e.length){if(1==e.length&&0===e[0].width)return void c++;d={x:e[e.length-1].x+e[e.length-1].width,y:e[e.length-1].y}}else d=e[b-c];return!1}c+=e.length+(1==e.length&&0===e[0].width?0:1)}),d},getNodeIndex:function(a,b){for(var c=a,d=0;c=c.previousSibling;)b&&3==c.nodeType?c.nodeType!=c.nextSibling.nodeType&&d++:d++;return d}};return Utils.each(["String","Function","Array","Number","RegExp","Object"],function(a,b){f.Utils["is"+b]=function(a){return Object.prototype.toString.apply(a)=="[object "+b+"]"}}),d.exports=e}},b[5]={value:function(a,b,c){function d(){var a=document.querySelector(this.selector);if(!a)throw new Error("Invalid selector: "+this.selector);a.classList.add("km-editor"),this.container=a}return c.exports=d}},b[6]={value:function(a,c,d){function e(a,b,c,d){if(a.when!=b)return!1;if("*"!=a.enter&&a.enter!=d)return!1;if("*"==a.exit||a.exit==c)return!0}function f(a){var b=a,c=" - ",d=" -> ",f=[];this.jump=function(a,c){if(!c)throw new Error("Please tell fsm the reason to jump");var d,g,h=b,j=[h,a].concat([].slice.call(arguments,1));for(d=0;d<f.length;d++)if(g=f[d],e(g.condition,"before",h,a)&&g.apply(null,j))return;for(b=a,i.log("[{0}] {1} -> {2}",c,h,a),d=0;d<f.length;d++)g=f[d],e(g.condition,"after",h,a)&&g.apply(null,j);return b},this.state=function(){return b},this.when=function(a,b){1==arguments.length&&(b=a,a="* -> *");var e,g,h,i;if(g=a.split(c),2==g.length?e="before":(g=a.split(d),2==g.length&&(e="after")),!e)throw new Error("Illegal fsm condition: "+a);h=g[0],i=g[1],b.condition={when:e,exit:h,enter:i},f.push(b)}}function g(){this.fsm=new f("normal")}var h=b.r(13),i=new h("fsm");return d.exports=g}},b[7]={value:function(a,c,d){function e(){var a=this.fsm,b=this.minder,c=(this.receiver,this.container),d=new f(c);a.when("normal -> hotbox",function(){var a,c=b.getSelectedNode();if(c){var e=c.getRenderBox();a={x:e.cx,y:e.cy}}d.active("main",a)}),a.when("normal -> normal",function(a,c,e,f){if("shortcut-handle"==e){var g=d.dispatch(f);g?f.preventDefault():b.dispatchKeyEvent(f)}}),this.hotbox=d}var f=b.r(2);return d.exports=e}},b[8]={value:function(a,c,d){function e(){function a(){j.when("* -> input",e),j.when("input -> *",function(a,b,c){switch(c){case"input-commit":return f();case"input-cancel":return h()}}),k.on("beforemousedown",function(){"input"==j.state()&&j.jump("normal","input-commit")})}function b(){g.flaged&&n.classList.add("debug"),n.onmousedown=function(a){a.stopPropagation()},k.on("layoutallfinish viewchange viewchanged selectionchange",function(a){("viewchange"!=a.type||"input"==j.state())&&i()}),i()}function c(){l.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return-1!=k.queryCommandState("text")},action:d})}function d(){n.innerText=k.queryCommandValue("text"),j.jump("input","input-request"),m.selectAll()}function e(){var a=k.getSelectedNode();if(a){var b=a.getData("font-size")||a.getStyle("font-size");n.style.fontSize=b+"px",n.style.minWidth=0,n.style.minWidth=n.clientWidth+"px",n.classList.add("input"),n.focus()}}function f(){var a=n.innerText;k.execCommand("text",a.replace(/^\n*|\n*$/g,"")),h()}function h(){n.classList.remove("input"),m.selectAll()}function i(){var a=i,b=k.getSelectedNode();b&&(a.timer||(a.timer=setTimeout(function(){var c=b.getRenderBox("TextRenderer");n.style.left=Math.round(c.x)+"px",n.style.top=Math.round(g.flaged?c.bottom+30:c.y)+"px",n.focus(),a.timer=0})))}var j=this.fsm,k=this.minder,l=this.hotbox,m=this.receiver,n=m.element;b(),a(),c(),this.editText=d}b.r(16);var f=b.r(13),g=new f("input");return d.exports=e}},b[9]={value:function(a,c,d){function e(a){return a.ctrlKey||a.metaKey||a.altKey?!1:a.keyCode>=65&&a.keyCode<=90?!0:a.keyCode>=48&&a.keyCode<=57?!0:229==a.keyCode?!0:void 0}function f(){var a=this.fsm,b=this.minder,c=this.receiver,d=this.container,f=c.element,h=this.hotbox;c.listen("normal",function(c){if("keydown"==c.type&&c.is("Space"))return c.preventDefault(),a.jump("hotbox","space-trigger");if("keydown"==c.type&&e(c)){if(b.getSelectedNode())return a.jump("input","user-input");f.innerHTML=""}return"keydown"==c.type?a.jump("normal","shortcut-handle",c):void 0}),c.listen("hotbox",function(b){b.preventDefault();var c=h.dispatch(b);return"back"==c&&h.state()==g.STATE_IDLE?a.jump("normal","hotbox-idle"):void 0}),c.listen("input",function(b){if("keydown"==b.type){if(b.is("Enter"))return b.preventDefault(),a.jump("normal","input-commit");if(b.is("Esc"))return b.preventDefault(),a.jump("normal","input-cancel");(b.is("Tab")||b.is("Shift + Tab"))&&b.preventDefault()}});var i,j,k=2;d.addEventListener("mousedown",function(b){"hotbox"==a.state()?(h.active(g.STATE_IDLE),a.jump("normal","blur")):"normal"==a.state()&&b.button==k&&(i=b.clientX,j=b.clientY)},!1),d.addEventListener("mouseup",function(c){"normal"==a.state()&&c.button==k&&c.clientX==i&&c.clientY==j&&b.getSelectedNode()&&a.jump("hotbox","content-menu")},!1),h.$element.addEventListener("mousedown",function(a){a.stopPropagation()})}var g=b.r(2);return d.exports=f}},b[10]={value:function(a,c,d){function e(){var a=new f({enableKeyReceiver:!1,enableAnimation:!1});a.renderTo(this.selector),a.setTheme(null),a.select(a.getRoot(),!0),a.execCommand("text","中心主题"),this.minder=a}var f=b.r(4);return d.exports=e}},b[11]={value:function(a,b,c){function d(){var a=this,b=this.minder,c=this.hotbox,d=this.fsm,e=c.state("main"),f=["前移:Alt+Up:ArrangeUp","下级:Tab:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","归纳:Shift+Tab|Shift+Insert:AppendParentNode"];f.forEach(function(c){var f=c.split(":"),g=f.shift(),h=f.shift(),i=f.shift();e.button({position:"ring",label:g,key:h,action:function(){0===i.indexOf("Append")?(b.execCommand(i,"新主题"),a.editText()):(b.execCommand(i),d.jump("normal","command-executed"))},enable:function(){return-1!=b.queryCommandState(i)}})})}return c.exports=d}},b[12]={value:function(a,c,d){function e(){function a(a){a.is=function(a){for(var b=a.split("|"),c=0;c<b.length;c++)if(f.is(this,b[c]))return!0;return!1};for(var c,d=0;d<g.length;d++)if(c=g[d],("*"==c.notifyState||c.notifyState==b.state())&&c.call(null,a))return}var b=this.fsm,c=this.minder,d=document.createElement("div");d.contentEditable=!0,d.classList.add("receiver"),d.onkeydown=d.onkeypress=d.onkeyup=a,this.container.appendChild(d);var e={element:d,selectAll:function(){d.innerHTML||(d.innerHTML="&nbsp;");var a=document.createRange(),b=window.getSelection();a.selectNodeContents(d),b.removeAllRanges(),b.addRange(a),d.focus()}};e.selectAll(),c.on("beforemousedown",e.selectAll);var g=[];e.listen=function(a,b){1==arguments.length&&(b=a,a="*"),b.notifyState=a,g.push(b)},this.receiver=e}var f=b.r(17);return d.exports=e}},b[13]={value:function(a,c,d){function e(){}function f(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b}function g(a){var b=this.flaged=-1!=window.location.search.indexOf(a);if(b){var c=f(a)%360,d=h("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",c),g="background: none; color: black;";this.log=function(){var b=h.apply(null,arguments);console.log(h("%c{0}%c{1}",a,b),d,g)}}else this.log=e}var h=b.r(14);return d.exports=g}},b[14]={value:function(a,b,c){function d(a,b){return"object"!=typeof b&&(b=[].slice.call(arguments,1)),String(a).replace(/\{(\w+)\}/gi,function(a,c){return b[c]||c})}return c.exports=d}},b[16]={value:function(){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var a,b,c=window.getSelection(),d=[];for(b=0;b<c.rangeCount;b++)d[b]=c.getRangeAt(b);for(c.removeAllRanges(),c.selectAllChildren(this),a=c.toString(),c.removeAllRanges(),b=0;b<d.length;b++)c.addRange(d[b]);return a}),HTMLElement.prototype.__defineSetter__("innerText",function(a){this.innerHTML=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},b[17]={value:function(a,c,d){return d.exports=b.r(20)}},b[18]={value:function(a,c,d){d.exports=window.HotBox=b.r(19)}},b[19]={value:function(a,c,d){function e(a){return document.createElement(a)}function f(a,b){a.classList.add(b)}function g(a,b){a.classList.remove(b)}function h(a,b){a.appendChild(b)}function i(a,b){return"object"!=typeof b&&(b=[].slice.apply(arguments,1)),String(a).replace(/\{(\w+)\}/g,function(a,c){return b[c]||a})}function j(a){function b(a){return j?void j.active():(a=a||m,j=new a(t),j.active(),i.onmousedown=function(a){a.stopPropagation(),a.preventDefault()},t)}function c(b){var c=b.type.toLowerCase();if(b.keyHash=l.hash(b),b.isKey=function(a){if(!a)return!1;for(var c=a.split(/\s*\|\s*/);c.length;)if(b.keyHash==l.hash(c.shift()))return!0;return!1},b[c]=!0,b.keydown&&t.activeKey&&b.isKey(t.activeKey)&&r==n&&q)return void g("main",{x:a.clientWidth/2,y:a.clientHeight/2});var d=r==n?q:r;if(d){var e=d.handleKeyEvent(b);return"function"==typeof t.onkeyevent&&(b.handleResult=e,t.onkeyevent(b,e)),e}return null}function d(a){if(!a)return r;if(a==n)throw new Error("Can not define or use the `idle` state.");return p[a]=p[a]||new k(this,a),"main"==a&&(q=p[a]),p[a]}function g(a,b){if(a==n)r!=n&&(s.shift().deactive(),s=[]),r=n;else if("back"==a)r!=n&&(r.deactive(),s.shift(),r=s[0],r?r.active():r="idle");else{r!=n&&r.deactive();var c=p[a];s.unshift(c),"function"==typeof t.position&&(b=t.position(b)),c.active(b),r=c}}if("string"==typeof a&&(a=document.querySelector(a)),!(a&&a instanceof HTMLElement))throw new Error("No container or not invalid container for hot box");var i=e(o);f(i,"hotbox"),h(a,i),this.$element=i,this.$container=a;var j,p={},q=null,r=n,s=[],t=this;this.control=b,this.state=d,this.active=g,this.dispatch=c,this.activeKey="space",this.actionKey="space"}function k(a,b){function c(){function a(a){var b=B.ring,c=2*Math.PI/b.length;B.center&&(B.center.indexedPosition=[0,0]),y.style.marginLeft=y.style.marginTop=-a+"px",y.style.width=y.style.height=a+a+"px";for(var d,e,f,g,h=0;h<b.length;h++)d=b[h].$button,e=c*h-Math.PI/2,f=a*Math.cos(e),g=a*Math.sin(e),b[h].indexedPosition=[f,g],d.style.left=f+"px",d.style.top=g+"px"}function b(a){var b=-z.clientWidth/2,c=2*-a-z.clientHeight/2;z.style.marginLeft=b+"px",z.style.marginTop=c+"px",B.top.forEach(function(a){var d=a.$button;a.indexedPosition=[b+d.offsetLeft+d.clientWidth/2,c]})}function c(a){var b=-A.clientWidth/2,c=2*a-A.clientHeight/2;A.style.marginLeft=b+"px",A.style.marginTop=c+"px",B.bottom.forEach(function(a){var d=a.$button;a.indexedPosition=[b+d.offsetLeft+d.clientWidth/2,c]})}function d(){function a(a){var c,d,e,f,g,h,i={},j=0,k={},l=a.indexedPosition,m=Math.abs;b.forEach(function(b){if(a!=b)for(c=b.indexedPosition,g=[],d=c[0]-l[0],e=c[1]-l[1],f=Math.sqrt(d*d+e*e),m(d)>2&&(g.push(d>0?"right":"left"),g.push(f+m(e))),m(e)>2&&(g.push(e>0?"down":"up"),g.push(f+m(d)));g.length;)h=g.shift(),j=g.shift(),(!i[h]||j<k[h])&&(i[h]=b,k[h]=j)}),a.neighbor=i}var b=C.filter(function(a){return a.indexedPosition});b.forEach(a)}var e=15*B.ring.length;a(e),b(e),c(e),d(),G=!1}function d(){return!0}function j(a){var b=e(o);f(b,"button");var c=a.render||k;switch(b.innerHTML=c(i,a),a.position){case"center":h(w,b);break;case"ring":h(x,b);break;case"top":h(z,b);break;case"bottom":h(A,b)}return{action:a.action,enable:a.enable||d,key:a.key,next:a.next,label:a.label,data:a.data||null,$button:b}}function k(a,b){return a('<span class="label">{label}</span><span class="key">{key}</span>',{label:b.label,key:b.key&&b.key.split("|")[0]})}function l(b){b=b||{x:a.$container.clientWidth/2,y:a.$container.clientHeight/2},b&&(v.style.left=b.x+"px",v.style.top=b.y+"px"),C.forEach(function(a){var b=a.$button;b&&b.classList[a.enable()?"add":"remove"]("enabled")}),f(v,u),G&&c(),D||q(B.center||B.ring[0]||B.top[0]||B.bottom[0]),F=!0}function m(){g(v,u),q(null),F=!1}function p(a){E&&E.$button&&g(E.$button,t),E=a,E&&E.$button&&f(E.$button,t)}function q(a){D&&D.$button&&D.$button&&g(D.$button,s),D=a,D&&D.$button&&f(D.$button,s)}function r(b){b&&((!b.enable||b.enable())&&(b.action&&b.action(b),a.active(b.next||n)),p(null),q(null))}var s="selected",t="pressed",u="active",v=e(o),w=e(o),x=e(o),y=e("div"),z=e(o),A=e(o);f(v,"state"),f(v,b),f(w,"center"),f(x,"ring"),f(y,"ring-shape"),f(z,"top"),f(A,"bottom"),h(a.$element,v),h(v,y),h(v,w),h(v,x),h(v,z),h(v,A),this.name=b;var B={center:null,ring:[],top:[],bottom:[],behind:[]},C=[],D=null,E=null,F=!1,G=!0;this.button=function(a){var b=j(a);"center"==a.position?B.center=b:B[a.position]&&B[a.position].push(b),C.push(b),G=!0},this.active=l,this.deactive=m,v.onmouseup=function(a){if(!a.button)for(var b=a.target;b&&b!=v;)b.classList.contains("button")&&C.forEach(function(a){a.$button==b&&r(a)}),b=b.parentNode},this.handleKeyEvent=function(c){var d=null;if(c.keydown){if(C.forEach(function(e){c.isKey(e.key)&&(F||a.hintDeactiveMainState?(q(e),p(e),d="buttonpress"):(r(e),d="execute"),c.preventDefault(),c.stopPropagation(),!F&&a.hintDeactiveMainState&&a.active(b))}),F){if(c.isKey("esc"))return E?c.isKey(E.key)||p(null):a.active("back"),"back";["up","down","left","right"].forEach(function(a){if(c.isKey(a)){if(!D)return void q(B.center||B.ring[0]||B.top[0]||B.bottom[0]);for(var b=D.neighbor[a];b&&!b.enable();)b=b.neighbor[a];b&&q(b),d="navigate"}}),c.isKey("space")&&D?(p(D),d="buttonpress"):E&&E!=D&&(p(null),d="selectcancel")}}else!c.keyup||!F&&a.hintDeactiveMainState||E&&(c.isKey("space")&&D==E||c.isKey(E.key))&&(r(E),c.preventDefault(),c.stopPropagation(),d="execute");return d}}var l=b.r(20),m=b.r(21),n=j.STATE_IDLE="idle",o="div";d.exports=j}},b[20]={value:function(a,c){function d(a){return"string"==typeof a?g(a):f(a)}function e(a,b){return a&&b&&d(a)==d(b)}function f(a){var b=0;return(a.ctrlKey||a.metaKey)&&(b|=i),a.altKey&&(b|=j),a.shiftKey&&(b|=k),-1==[16,17,18,91].indexOf(a.keyCode)&&(b|=a.keyCode),b}function g(a){var b=0;return a.toLowerCase().split(/\s*\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":b|=i;break;case"alt":b|=j;break;case"shift":b|=k;break;default:b|=h[a]}}),b}var h=b.r(22),i=4096,j=8192,k=16384;c.hash=d,c.is=e}},b[21]={value:function(a,c,d){function e(a){function b(){j=document.createElement("input"),j.classList.add(g),m.appendChild(j),l=!0}function c(){j.onkeyup=e,j.onkeypress=e,j.onkeydown=e,j.onfocus=h,j.onblur=i,l&&(j.oninput=function(){j.value=null})}function d(){m.onmousedown=function(a){h(),a.preventDefault()}}function e(b){k&&a.dispatch(b)}function h(){j.select(),j.focus(),k=!0,m.classList.add(f)}function i(){j.blur(),k=!1,m.classList.remove(f)}var j,k=!0,l=!1,m=a.$container;b(),c(),d(),h(),this.handle=e,this.active=h,this.deactive=i}var f=(b.r(20),"hotbox-focus"),g="hotbox-key-receiver";d.exports=e}},b[22]={value:function(a,b,c){var d={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}},b[23]={value:function(){var a=b.r(38),c=b.r(32),d=(new a.Marker).pipe(function(){var b=7,c=new a.Circle(b-1);this.addShape(c),this.setRef(b-1,0).setViewBox(-b,-b,b+b,b+b).setWidth(b).setHeight(b),this.dot=c,this.node.setAttribute("markerUnits","userSpaceOnUse")});c.register("arc",function(b,c,e,f,g){var h,i,j,k=b.getLayoutBox(),l=c.getLayoutBox(),m=Math.abs,n=[],o=k.x>l.x?"right":"left";b.getMinder().getPaper().addResource(d),h=new a.Point(l.cx,l.cy),i="left"==o?new a.Point(k.right+2,k.cy):new a.Point(k.left-2,k.cy),j=a.Vector.fromPoints(h,i),n.push("M",h),n.push("A",m(j.x),m(j.y),0,0,j.x*j.y>0?0:1,i),e.setMarker(d),d.dot.fill(g),e.setPathData(n)})}},b[24]={value:function(){var a=(b.r(38),b.r(32));a.register("bezier",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=b.getLayoutVectorOut().normalize(),g=Math.round,h=Math.abs,i=[];if(i.push("M",g(d.x),g(d.y)),h(f.x)>h(f.y)){var j=(e.x+d.x)/2;i.push("C",j,d.y,j,e.y,e.x,e.y)}else{var k=(e.y+d.y)/2;i.push("C",d.x,k,e.x,k,e.x,e.y)}c.setMarker(null),c.setPathData(i)})}},b[25]={value:function(){var a=(b.r(38),b.r(32));a.register("fish-bone-master",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=Math.abs,g=f(d.y-e.y),h=f(d.x-e.x),i=[];i.push("M",d.x,d.y),i.push("h",h-g),i.push("L",e.x,e.y),c.setMarker(null),c.setPathData(i)})}},b[26]={value:function(){var a=(b.r(38),b.r(32));a.register("l",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=b.getLayoutVectorOut(),g=[],h=Math.round,i=Math.abs;g.push("M",d.round()),i(f.x)>i(f.y)?g.push("H",h(e.x)):g.push("V",e.y),g.push("L",e),c.setPathData(g)})}},b[27]={value:function(){var a=(b.r(38),b.r(32));a.register("poly",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=b.getLayoutVectorOut().normalize(),g=Math.round,h=Math.abs,i=[];switch(i.push("M",g(d.x),g(d.y)),!0){case h(f.x)>h(f.y)&&f.x<0:i.push("h",-b.getStyle("margin-left")),i.push("v",e.y-d.y),i.push("H",e.x);break;case h(f.x)>h(f.y)&&f.x>=0:i.push("h",b.getStyle("margin-right")),i.push("v",e.y-d.y),i.push("H",e.x);break;case h(f.x)<=h(f.y)&&f.y<0:i.push("v",-b.getStyle("margin-top")),i.push("h",e.x-d.x),i.push("V",e.y);break;case h(f.x)<=h(f.y)&&f.y>=0:i.push("v",b.getStyle("margin-bottom")),i.push("h",e.x-d.x),i.push("V",e.y)}c.setMarker(null),c.setPathData(i)})}},b[28]={value:function(){var a=b.r(38),c=b.r(32);c.register("under",function(b,c,d){var e,f,g,h,i=b.getLayoutBox(),j=c.getLayoutBox(),k=(Math.abs,[]),l=i.x>j.x?"right":"left",m=(b.getStyle("connect-radius"),i.bottom+3),n="sub"==c.getType()?j.bottom+3:j.cy;"right"==l?(e=new a.Point(j.right,n),f=new a.Point(i.left-10,m),g=new a.Point(i.right,m)):(e=new a.Point(j.left,n),f=new a.Point(i.right+10,m),g=new a.Point(i.left,m)),h=(e.x+f.x)/2,k.push("M",e),k.push("C",h,e.y,h,f.y,f),k.push("L",g),d.setMarker(null),d.setPathData(k)})}},b[29]={value:function(){var a=b.r(40),c={enableAnimation:!0,layoutAnimationDuration:300,viewAnimationDuration:100,zoomAnimationDuration:300},d={};a.registerInitHook(function(){this.setDefaultOptions(c),this.getOption("enableAnimation")||this.disableAnimation()}),a.prototype.enableAnimation=function(){for(var a in c)c.hasOwnProperty(a)&&this.setOption(d[a])},a.prototype.disableAnimation=function(){for(var a in c)c.hasOwnProperty(a)&&(d[a]=this.getOption(a),this.setOption(a,0))}}},b[30]={value:function(a,c,d){var e=b.r(38),f=(b.r(53),b.r(40)),g=(b.r(42),b.r(34)),h=0,i=-1,j=1,k=e.createClass("Command",{constructor:function(){this._isContentChange=!0,this._isSelectionChange=!1},execute:function(){throw new Error("Not Implement: Command.execute()")},setContentChanged:function(a){this._isContentChange=!!a},isContentChanged:function(){return this._isContentChange},setSelectionChanged:function(a){this._isSelectionChange=!!a},isSelectionChanged:function(){return this._isContentChange},queryState:function(){return h},queryValue:function(){return 0},isNeedUndo:function(){return!0}});k.STATE_NORMAL=h,k.STATE_ACTIVE=j,k.STATE_DISABLED=i,e.extendClass(f,{_getCommand:function(a){return this._commands[a.toLowerCase()]},_queryCommand:function(a,b,c){var d=this._getCommand(a);if(d){var e=d["query"+b];if(e)return e.apply(d,[this].concat(c))}return 0},queryCommandState:function(a){return this._queryCommand(a,"State",[].slice.call(arguments,1))},queryCommandValue:function(a){return this._queryCommand(a,"Value",[].slice.call(arguments,1))},execCommand:function(a){if(!a)return null;a=a.toLowerCase();var b,c,d,e,f=[].slice.call(arguments,1),h=this;return b=this._getCommand(a),e={command:b,commandName:a.toLowerCase(),commandArgs:f},b&&~this.queryCommandState(a)?(!this._hasEnterExecCommand&&b.isNeedUndo()?(this._hasEnterExecCommand=!0,c=this._fire(new g("beforeExecCommand",e,!0)),c||(this._fire(new g("saveScene")),this._fire(new g("preExecCommand",e,!1)),d=b.execute.apply(b,[h].concat(f)),this._fire(new g("execCommand",e,!1)),this._fire(new g("saveScene")),b.isContentChanged()&&this._firePharse(new g("contentchange")),this._interactChange()),this._hasEnterExecCommand=!1):(d=b.execute.apply(b,[h].concat(f)),this._hasEnterExecCommand||this._interactChange()),void 0===d?null:d):!1}}),d.exports=k}},b[31]={value:function(){function a(a){var b=a.version||(a.root?"1.4.0":"1.1.3");switch(b){case"1.1.3":e(a);case"1.2.0":case"1.2.1":d(a);case"1.3.0":case"1.3.1":case"1.3.2":case"1.3.3":case"1.3.4":case"1.3.5":f(a)}return a}function c(a,b){b(a),a.children&&a.children.forEach(function(a){c(a,b)})}function d(a){c(a,function(a){var b=a.data;delete b.layout_bottom_offset,delete b.layout_default_offset,delete b.layout_filetree_offset})}function e(a){var b=a.data.currentstyle;delete a.data.currentstyle,"bottom"==b?(a.template="structure",a.theme="snow"):"default"==b&&(a.template="default",a.theme="classic"),c(a,function(a){var b=a.data;"PriorityIcon"in b&&(b.priority=b.PriorityIcon,delete b.PriorityIcon),"ProgressIcon"in b&&(b.progress=1+(b.ProgressIcon-1<<1),delete b.ProgressIcon),delete b.point,delete b.layout})}function f(a){a.root={data:a.data,children:a.children},delete a.data,delete a.children}b.r(53);return a}},b[32]={value:function(a,c){function d(a,b){j[a]=b}var e=b.r(38),f=b.r(53),g=b.r(41),h=b.r(40),i=b.r(42),j={};d("default",function(a,b,c){c.setPathData(["M",b.getLayoutVertexOut(),"L",a.getLayoutVertexIn()])}),e.extendClass(i,{getConnect:function(){return this.data.connect||"default"},getConnectProvider:function(){return j[this.getConnect()]||j["default"]},getConnection:function(){return this._connection||null}}),e.extendClass(h,{getConnectContainer:function(){return this._connectContainer},createConnect:function(a){if(!a.isRoot()){var b=new e.Path;a._connection=b,this._connectContainer.addShape(b),this.updateConnect(a)}},removeConnect:function(a){var b=this;a.traverse(function(a){b._connectContainer.removeShape(a._connection),a._connection=null})},updateConnect:function(a){var b=a._connection,c=a.parent;if(c&&b){if(c.isCollapsed())return void b.setVisible(!1);b.setVisible(!0);var d=a.getConnectProvider(),e=a.getStyle("connect-color")||"white",f=a.getStyle("connect-width")||2;b.stroke(e,f),d(a,c,b,f,e),f%2===0?b.setTranslate(.5,.5):b.setTranslate(0,0)}}}),g.register("Connect",{init:function(){this._connectContainer=(new e.Group).setId(f.uuid("minder_connect_group")),this.getRenderContainer().prependShape(this._connectContainer)},events:{nodeattach:function(a){this.createConnect(a.node)},nodedetach:function(a){this.removeConnect(a.node)},"layoutapply layoutfinish noderender":function(a){this.updateConnect(a.node)}}}),c.register=d}},b[33]={value:function(a,c){function d(a,b){j[a]=b}var e=b.r(38),f=(b.r(53),b.r(40)),g=(b.r(42),b.r(34)),h=b.r(31),i=b.r(45),j={};c.registerProtocol=d,e.extendClass(f,{setup:function(a){if("string"==typeof a&&(a=document.querySelector(a)),a){var b=a.getAttribute("minder-data-type");if(b in j){var c=a.textContent;a.textContent=null,this.renderTo(a),this.importData(b,c)}return this}},exportJson:function(){function a(b){var c={};c.data=b.getData();var d=b.getChildren();if(d.length){c.children=[];for(var e=0;e<d.length;e++)c.children.push(a(d[e]))}return c}var b={root:a(this.getRoot())};return b.template=this.getTemplate(),b.theme=this.getTheme(),b.version=f.version,b},importJson:function(a){function b(a,c,d){var e=c.data;a.data={};for(var f in e)a.setData(f,e[f]);for(var g=c.children||[],h=0;h<g.length;h++){var i=d.createNode(null,a);b(i,g[h],d)}return a}if(a){for(this._fire(new g("preimport",null,!1));this._root.getChildren().length;)this.removeNode(this._root.getChildren()[0]);return a=h(a),b(this._root,a.root,this),this.setTemplate(a.template||"default"),this.setTheme(a.theme||null),this.refresh(),this.fire("import"),this._firePharse({type:"contentchange"}),this._interactChange(),this}},exportData:function(a,b){var c,d;return c=this.exportJson(),!a||(d=j[a],d&&d.encode)?(this._fire(new g("beforeexport",{json:c,protocolName:a,protocol:d})),i.resolve(d.encode(c,this,b))):i.reject(new Error("Not supported protocol:"+a))},importData:function(a,b,c){var d,e=this;if(a&&(d=j[a],!d||!d.decode))return i.reject(new Error("Not supported protocol:"+a));var f={local:b,protocolName:a,protocol:d};return this._fire(new g("beforeimport",f)),i.resolve(d.decode(b,this,c)).then(function(a){return e.importJson(a),a})}})}},b[34]={value:function(a,c,d){var e=b.r(38),f=(b.r(53),b.r(40)),g=e.createClass("MindEvent",{constructor:function(a,b,c){b=b||{},b.getType&&"ShapeEvent"==b.getType()?(this.kityEvent=b,this.originEvent=b.originEvent):b.target&&b.preventDefault?this.originEvent=b:e.Utils.extend(this,b),this.type=a,this._canstop=c||!1},getPosition:function(a){return this.kityEvent?a&&"minder"!=a?this.kityEvent.getPosition.call(this.kityEvent,a):this.kityEvent.getPosition(this.minder.getRenderContainer()):void 0},getTargetNode:function(){var a=this.kityEvent&&this.kityEvent.targetShape;if(!a)return null;for(;!a.minderNode&&a.container;)a=a.container;var b=a.minderNode;return b&&a.getOpacity()<1?null:b||null},stopPropagation:function(){this._stoped=!0},stopPropagationImmediately:function(){this._immediatelyStoped=!0,this._stoped=!0},shouldStopPropagation:function(){return this._canstop&&this._stoped},shouldStopPropagationImmediately:function(){return this._canstop&&this._immediatelyStoped},preventDefault:function(){this.originEvent.preventDefault()},isRightMB:function(){var a=!1;return this.originEvent?("which"in this.originEvent?a=3==this.originEvent.which:"button"in this.originEvent&&(a=2==this.originEvent.button),a):!1},getKeyCode:function(){var a=this.originEvent;return a.keyCode||a.which}});f.registerInitHook(function(){this._initEvents()}),e.extendClass(f,{_initEvents:function(){this._eventCallbacks={}},_resetEvents:function(){this._initEvents(),this._bindEvents()},_bindEvents:function(){this._paper.on("click dblclick mousedown contextmenu mouseup mousemove mouseover mousewheel DOMMouseScroll touchstart touchmove touchend dragenter dragleave drop",this._firePharse.bind(this)),window&&window.addEventListener("resize",this._firePharse.bind(this))},dispatchKeyEvent:function(a){this._firePharse(a)},_firePharse:function(a){var b,c,d;"DOMMouseScroll"==a.type&&(a.type="mousewheel",a.wheelDelta=a.originEvent.wheelDelta=-10*a.originEvent.detail,a.wheelDeltaX=a.originEvent.mozMovementX,a.wheelDeltaY=a.originEvent.mozMovementY),b=new g("before"+a.type,a,!0),this._fire(b)||(c=new g("pre"+a.type,a,!0),d=new g(a.type,a,!0),(this._fire(c)||this._fire(d))&&this._fire(new g("after"+a.type,a,!1)))},_interactChange:function(){var a=this;a._interactScheduled||(setTimeout(function(){a._fire(new g("interactchange")),a._interactScheduled=!1},100),a._interactScheduled=!0)},_listen:function(a,b){
var c=this._eventCallbacks[a]||(this._eventCallbacks[a]=[]);c.push(b)},_fire:function(a){a.minder=this;var b=this.getStatus(),c=this._eventCallbacks[a.type.toLowerCase()]||[];if(b&&(c=c.concat(this._eventCallbacks[b+"."+a.type.toLowerCase()]||[])),0!==c.length){for(var d=(this.getStatus(),0);d<c.length&&(c[d].call(this,a),!a.shouldStopPropagationImmediately());d++);return a.shouldStopPropagation()}},on:function(a,b){var c=this;return a.split(/\s+/).forEach(function(a){c._listen(a.toLowerCase(),b)}),this},off:function(a,b){var c,d,e,f,g=a.split(/\s+/);for(c=0;c<g.length;c++)if(e=this._eventCallbacks[g[c].toLowerCase()]){for(f=null,d=0;d<e.length;d++)e[d]==b&&(f=d);null!==f&&e.splice(f,1)}},fire:function(a,b){var c=new g(a,b);return this._fire(c),this}}),d.exports=g}},b[35]={value:function(){var a=b.r(38),c=b.r(40);c.registerInitHook(function(){this.on("beforemousedown",function(a){this.focus(),a.preventDefault()}),this.on("paperrender",function(){this.focus()})}),a.extendClass(c,{focus:function(){if(!this.isFocused()){var a=this._renderTarget;a.classList.add("focus"),this.renderNodeBatch(this.getSelectedNodes())}return this.fire("focus"),this},blur:function(){if(this.isFocused()){var a=this._renderTarget;a.classList.remove("focus"),this.renderNodeBatch(this.getSelectedNodes())}return this.fire("blur"),this},isFocused:function(){var a=this._renderTarget;return a&&a.classList.contains("focus")}})}},b[36]={value:function(a,b,c){var d={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190,controlKeys:{16:1,17:1,18:1,20:1,91:1,224:1},notContentChange:{13:1,9:1,33:1,34:1,35:1,36:1,16:1,17:1,18:1,20:1,91:1,37:1,38:1,39:1,40:1,113:1,114:1,115:1,144:1,27:1},isSelectedNodeKey:{37:1,38:1,39:1,40:1,13:1,9:1}};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}},b[37]={value:function(){function a(a,b,c){b.split(" ").forEach(function(b){a.addEventListener(b,c,!1)})}var c=b.r(38),d=(b.r(53),b.r(40));d.registerInitHook(function(){this.setDefaultOptions({enableKeyReceiver:!0}),this.getOption("enableKeyReceiver")&&this.on("paperrender",function(){this._initKeyReceiver()})}),c.extendClass(d,{_initKeyReceiver:function(){if(!this._keyReceiver){var b=this._keyReceiver=document.createElement("input");b.classList.add("km-receiver");var c=this._renderTarget;c.appendChild(b);var d=this;a(b,"keydown keyup keypress copy paste blur focus input",function(a){switch(a.type){case"blur":d.blur();break;case"focus":d.focus();break;case"input":b.value=null}d._firePharse(a),a.preventDefault()}),this.on("focus",function(){b.select(),b.focus()}),this.on("blur",function(){b.blur()}),this.isFocused()&&(b.select(),b.focus())}}})}},b[38]={value:function(a,b,c){c.exports=window.kity}},b[39]={value:function(a,c,d){function e(a,b){k[a]=b,f=f||a}var f,g=b.r(38),h=b.r(53),i=b.r(40),j=b.r(42),k=(b.r(34),b.r(30),{}),l=g.createClass("Layout",{doLayout:function(){throw new Error("Not Implement: Layout.doLayout()")},align:function(a,b,c){var d=this;c=c||0,a.forEach(function(a){var e=d.getTreeBox([a]),f=a.getLayoutTransform();switch(b){case"left":return f.translate(c-e.left,0);case"right":return f.translate(c-e.right,0);case"top":return f.translate(0,c-e.top);case"bottom":return f.translate(0,c-e.bottom)}})},stack:function(a,b,c){var d=this,e=0;return c=c||function(a,b,c){return a.getStyle({x:"margin-right",y:"margin-bottom"}[c])+b.getStyle({x:"margin-left",y:"margin-top"}[c])},a.forEach(function(a,f,g){var h=d.getTreeBox([a]),i={x:h.width,y:h.height}[b],j={x:h.left,y:h.top}[b],k=a.getLayoutTransform();"x"==b?k.translate(e-j,0):k.translate(0,e-j),e+=i,g[f+1]&&(e+=c(a,g[f+1],b))}),e},move:function(a,b,c){a.forEach(function(a){a.getLayoutTransform().translate(b,c)})},getBranchBox:function(a){var b,c,d,e,f=new g.Box;for(b=0;b<a.length;b++)c=a[b],d=c.getLayoutTransform(),e=c.getContentBox(),f=f.merge(d.transformBox(e));return f},getTreeBox:function(a){var b,c,d,e,f=new g.Box;for(a instanceof Array||(a=[a]),b=0;b<a.length;b++)c=a[b],d=c.getLayoutTransform(),e=c.getContentBox(),c.isExpanded()&&c.children.length&&(e=e.merge(this.getTreeBox(c.children))),f=f.merge(d.transformBox(e));return f},getOrderHint:function(){return[]}});l.register=e,i.registerInitHook(function(){this.refresh()}),h.extend(i,{getLayoutList:function(){return k},getLayoutInstance:function(a){var b=k[a];if(!b)throw new Error("Missing Layout: "+a);var c=new b;return c}}),g.extendClass(j,{getLayout:function(){var a=this.getData("layout");return a=a||(this.isRoot()?f:this.parent.getLayout())},setLayout:function(a){return a&&("inherit"==a?this.setData("layout"):this.setData("layout",a)),this},layout:function(a){return this.setLayout(a).getMinder().layout(),this},getLayoutInstance:function(){return i.getLayoutInstance(this.getLayout())},getOrderHint:function(){return this.parent.getLayoutInstance().getOrderHint(this)},getExpandPosition:function(){return this.getLayoutInstance().getExpandPosition()},getLayoutTransform:function(){return this._layoutTransform||new g.Matrix},getGlobalLayoutTransformPreview:function(){var a=this.parent?this.parent.getLayoutTransform():new g.Matrix,b=this.getLayoutTransform(),c=this.getLayoutOffset();return c&&b.translate(c.x,c.y),a.merge(b)},getLayoutPointPreview:function(){return this.getGlobalLayoutTransformPreview().transformPoint(new g.Point)},getGlobalLayoutTransform:function(){return this._globalLayoutTransform?this._globalLayoutTransform:this.parent?this.parent.getGlobalLayoutTransform():new g.Matrix},setLayoutTransform:function(a){return this._layoutTransform=a,this},setGlobalLayoutTransform:function(a){return this.getRenderContainer().setMatrix(this._globalLayoutTransform=a),this},setVertexIn:function(a){this._vertexIn=a},setVertexOut:function(a){this._vertexOut=a},getVertexIn:function(){return this._vertexIn||new g.Point},getVertexOut:function(){return this._vertexOut||new g.Point},getLayoutVertexIn:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexIn())},getLayoutVertexOut:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexOut())},setLayoutVectorIn:function(a){return this._layoutVectorIn=a,this},setLayoutVectorOut:function(a){return this._layoutVectorOut=a,this},getLayoutVectorIn:function(){return this._layoutVectorIn||new g.Vector},getLayoutVectorOut:function(){return this._layoutVectorOut||new g.Vector},getLayoutBox:function(){var a=this.getGlobalLayoutTransform();return a.transformBox(this.getContentBox())},getLayoutPoint:function(){var a=this.getGlobalLayoutTransform();return a.transformPoint(new g.Point)},getLayoutOffset:function(){if(!this.parent)return new g.Point;var a=this.getData("layout_"+this.parent.getLayout()+"_offset");return a?new g.Point(a.x,a.y):new g.Point},setLayoutOffset:function(a){if(!this.parent)return this;if(a&&!this.hasLayoutOffset()){var b=this.getLayoutTransform().m;a=a.offset(b.e,b.f),this.setLayoutTransform(null)}return this.setData("layout_"+this.parent.getLayout()+"_offset",a?{x:a.x,y:a.y}:null),this},hasLayoutOffset:function(){return!!this.getData("layout_"+this.parent.getLayout()+"_offset")},resetLayoutOffset:function(){return this.setLayoutOffset(null)},getLayoutRoot:function(){return this.isLayoutRoot()?this:this.parent.getLayoutRoot()},isLayoutRoot:function(){return this.getData("layout")||this.isRoot()}}),g.extendClass(i,{layout:function(){function a(b,c){b.isExpanded(),0||b.children.forEach(function(b){a(b,c)});var d=b.getLayoutInstance(),e=b.getChildren().filter(function(a){return!a.hasLayoutOffset()});d.doLayout(b,e,c)}var b=this.getOption("layoutAnimationDuration");this.getRoot().traverse(function(a){a.setLayoutTransform(null)}),a(this.getRoot(),1),a(this.getRoot(),2);var c=this;return this.applyLayoutResult(this.getRoot(),b,function(){c.fire("layoutallfinish")}),this.fire("layout")},refresh:function(){return this.getRoot().renderTree(),this.layout().fire("contentchange")._interactChange(),this},applyLayoutResult:function(a,b,c){function d(){--i||c&&c()}function e(a,b){a.setGlobalLayoutTransform(b),h.fire("layoutapply",{node:a,matrix:b})}function f(a,c){var i=a.getLayoutTransform().merge(c),j=a.getGlobalLayoutTransform()||new g.Matrix,k=a.getLayoutOffset();i.translate(k.x,k.y),i.m.e=Math.round(i.m.e),i.m.f=Math.round(i.m.f),a._layoutTimeline&&(a._layoutTimeline.stop(),a._layoutTimeline=null),b?a._layoutTimeline=new g.Animator(j,i,e).start(a,b,"ease").on("finish",function(){setTimeout(function(){e(a,i),h.fire("layoutfinish",{node:a,matrix:i}),d()},150)}):(e(a,i),h.fire("layoutfinish",{node:a,matrix:i}),d());for(var l=0;l<a.children.length;l++)f(a.children[l],i)}a=a||this.getRoot();var h=this,i=a.getComplex();return i>200&&(b=0),f(a,a.parent?a.parent.getGlobalLayoutTransform():new g.Matrix),this}}),d.exports=l}},b[40]={value:function(a,c,d){var e=b.r(38),f=b.r(53),g=[],h=e.createClass("Minder",{constructor:function(a){this._options=f.extend({},a);for(var b,c=g.slice();c.length;)b=c.shift(),"function"==typeof b&&b.call(this,this._options);this.fire("ready")}});h.version="1.4.0",h.registerInitHook=function(a){g.push(a)},d.exports=h}},b[41]={value:function(a,c){var d=b.r(38),e=b.r(53),f=b.r(40),g={};c.register=function(a,b){g[a]=b},f.registerInitHook(function(){this._initModules()}),d.extendClass(f,{_initModules:function(){var a=g,b=this._options.modules||e.keys(a);this._commands={},this._query={},this._modules={},this._rendererClasses={};var c,d,f,h,i,j,k,l=this;for(c=0;c<b.length;c++)if(d=b[c],a[d]&&(h="function"==typeof a[d]?a[d].call(l):a[d],this._modules[d]=h,h)){h.defaultOptions&&l.setDefaultOptions(h.defaultOptions),h.init&&h.init.call(l,this._options),i=h.commands;for(d in i)this._commands[d.toLowerCase()]=new i[d];if(j=h.events)for(f in j)l.on(f,j[f]);if(k=h.renderers)for(f in k)this._rendererClasses[f]=this._rendererClasses[f]||[],e.isArray(k[f])?this._rendererClasses[f]=this._rendererClasses[f].concat(k[f]):this._rendererClasses[f].push(k[f]);h.commandShortcutKeys&&this.addCommandShortcutKeys(h.commandShortcutKeys)}},_garbage:function(){for(this.clearSelect();this._root.getChildren().length;)this._root.removeChild(0)},destroy:function(){var a=this._modules;this._resetEvents(),this._garbage();for(var b in a)a[b].destroy&&a[b].destroy.call(this)},reset:function(){var a=this._modules;this._garbage();for(var b in a)a[b].reset&&a[b].reset.call(this)}})}},b[42]={value:function(a,c,d){var e=b.r(38),f=b.r(53),g=b.r(40),h=e.createClass("MinderNode",{constructor:function(a){this.parent=null,this.root=this,this.children=[],this.data={id:f.guid(),created:+new Date},this.initContainers(),f.isString(a)?this.setText(a):f.isObject(a)&&f.extend(this.data,a)},initContainers:function(){this.rc=(new e.Group).setId(f.uuid("minder_node")),this.rc.minderNode=this},isRoot:function(){return this.root===this},isLeaf:function(){return 0===this.children.length},getRoot:function(){return this.root||this},getParent:function(){return this.parent},getLevel:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},getComplex:function(){var a=0;return this.traverse(function(){a++}),a},getType:function(){return this.type=["root","main","sub"][Math.min(this.getLevel(),2)],this.type},isAncestorOf:function(a){for(var b=a.parent;b;){if(b==this)return!0;b=b.parent}return!1},getData:function(a){return a?this.data[a]:this.data},setData:function(a,b){this.data[a]=b},setText:function(a){return this.data.text=a},getText:function(){return this.data.text||null},preTraverse:function(a,b){var c=this.getChildren();b||a(this);for(var d=0;d<c.length;d++)c[d].preTraverse(a)},postTraverse:function(a,b){for(var c=this.getChildren(),d=0;d<c.length;d++)c[d].postTraverse(a);b||a(this)},traverse:function(a,b){return this.postTraverse(a,b)},getChildren:function(){return this.children},getIndex:function(){return this.parent?this.parent.children.indexOf(this):-1},insertChild:function(a,b){void 0===b&&(b=this.children.length),a.parent&&a.parent.removeChild(a),a.parent=this,a.root=this.root,this.children.splice(b,0,a)},appendChild:function(a){return this.insertChild(a)},prependChild:function(a){return this.insertChild(a,0)},removeChild:function(a){var b,c=a;a instanceof h&&(c=this.children.indexOf(a)),c>=0&&(b=this.children.splice(c,1)[0],b.parent=null,b.root=b)},clearChildren:function(){this.children=[]},getChild:function(a){return this.children[a]},getRenderContainer:function(){return this.rc},getCommonAncestor:function(a){return h.getNodeCommonAncestor(this,a)},contains:function(a){return this==a||this.isAncestorOf(a)},clone:function(){var a=new h;return a.data=f.clone(this.data),this.children.forEach(function(b){a.appendChild(b.clone())}),a},compareTo:function(a){if(!f.comparePlainObject(this.data,a.data))return!1;if(!f.comparePlainObject(this.temp,a.temp))return!1;if(this.children.length!=a.children.length)return!1;for(var b=0;this.children[b];){if(!this.children[b].compareTo(a.children[b]))return!1;b++}return!0},getMinder:function(){return this.getRoot().minder}});h.getCommonAncestor=function(a,b){if(a instanceof Array)return h.getCommonAncestor.apply(this,a);switch(arguments.length){case 1:return a.parent||a;case 2:if(a.isAncestorOf(b))return a;if(b.isAncestorOf(a))return b;for(var c=a.parent;c&&!c.isAncestorOf(b);)c=c.parent;return c;default:return Array.prototype.reduce.call(arguments,function(a,b){return h.getCommonAncestor(a,b)},a)}},e.extendClass(g,{getRoot:function(){return this._root},setRoot:function(a){this._root=a,a.minder=this},createNode:function(a,b,c){var d=new h(a);return this.fire("nodecreate",{node:d,parent:b,index:c}),this.appendNode(d,b,c),d},appendNode:function(a,b,c){return b&&b.insertChild(a,c),this.attachNode(a),this},removeNode:function(a){a.parent&&(a.parent.removeChild(a),this.detachNode(a),this.fire("noderemove",{node:a}))},attachNode:function(a){var b=this.getRenderContainer();a.traverse(function(a){a.attached=!0,b.addShape(a.getRenderContainer())}),b.addShape(a.getRenderContainer()),this.fire("nodeattach",{node:a})},detachNode:function(a){var b=this.getRenderContainer();a.traverse(function(a){a.attached=!1,b.removeShape(a.getRenderContainer())}),this.fire("nodedetach",{node:a})},getMinderTitle:function(){return this.getRoot().getText()}}),d.exports=h}},b[43]={value:function(){var a=b.r(38),c=b.r(53),d=b.r(40);d.registerInitHook(function(){this._defaultOptions={}}),a.extendClass(d,{setDefaultOptions:function(a){return c.extend(this._defaultOptions,a),this},getOption:function(a){return a?a in this._options?this._options[a]:this._defaultOptions[a]:c.extend({},this._defaultOptions,this._options)},setOption:function(a,b){this._options[a]=b}})}},b[44]={value:function(){var a=b.r(38),c=b.r(53),d=b.r(40);d.registerInitHook(function(){this._initPaper()}),a.extendClass(d,{_initPaper:function(){this._paper=new a.Paper,this._paper._minder=this,this._paper.getNode().ondragstart=function(a){a.preventDefault()},this._paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),this._addRenderContainer(),this.setRoot(this.createNode()),this._options.renderTo&&this.renderTo(this._options.renderTo)},_addRenderContainer:function(){this._rc=(new a.Group).setId(c.uuid("minder")),this._paper.addShape(this._rc)},renderTo:function(a){if("string"==typeof a&&(a=document.querySelector(a)),a){if("script"==a.tagName.toLowerCase()){var b=document.createElement("div");b.id=a.id,b["class"]=a["class"],a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a),a=b}a.classList.add("km-view"),this._paper.renderTo(this._renderTarget=a),this._bindEvents(),this.fire("paperrender")}return this},getRenderContainer:function(){return this._rc},getPaper:function(){return this._paper},getRenderTarget:function(){return this._renderTarget}})}},b[45]={value:function(a,b,c){var d=0,e=1,f=2,g=function(a){return this instanceof g?(this.id="Thenable/1.0.7",this.state=d,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],void("function"==typeof a&&a.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new g(a)};g.prototype={fulfill:function(a){return h(this,e,"fulfillValue",a)},reject:function(a){return h(this,f,"rejectReason",a)},then:function(a,b){var c=this,d=new g;return c.onFulfilled.push(k(a,d,"fulfill")),c.onRejected.push(k(b,d,"reject")),i(c),d}};var h=function(a,b,c,e){return a.state===d&&(a.state=b,a[c]=e,i(a)),a},i=function(a){a.state===e?j(a,"onFulfilled",a.fulfillValue):a.state===f&&j(a,"onRejected",a.rejectReason)},j=function(a,b,c){if(0!==a[b].length){var d=a[b];a[b]=[];var e=function(){for(var a=0;a<d.length;a++)d[a](c)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(e):"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}},k=function(a,b,c){return function(d){if("function"!=typeof a)b[c].call(b,d);else{var e;try{e=d instanceof g?d.then(a):a(d)}catch(f){return void b.reject(f)}l(b,e)}}},l=function(a,b){if(a===b)return void a.reject(new TypeError("cannot resolve promise with itself"));var c;if("object"==typeof b&&null!==b||"function"==typeof b)try{c=b.then}catch(d){return void a.reject(d)}if("function"!=typeof c)a.fulfill(b);else{var e=!1;try{c.call(b,function(c){e||(e=!0,c===b?a.reject(new TypeError("circular thenable chain")):l(a,c))},function(b){e||(e=!0,a.reject(b))})}catch(d){e||a.reject(d)}}};g.resolve=function(a){return new g(function(b){b(a)})},g.reject=function(a){return new g(function(b,c){c(a)})},c.exports=g}},b[46]={value:function(){var a=b.r(38),c=b.r(40);c.registerInitHook(function(a){a.readOnly&&this.setDisabled()}),a.extendClass(c,{disable:function(){var a=this;a.bkqueryCommandState=a.queryCommandState,a.bkqueryCommandValue=a.queryCommandValue,a.queryCommandState=function(b){var c=this._getCommand(b);return c&&c.enableReadOnly?a.bkqueryCommandState.apply(a,arguments):-1},a.queryCommandValue=function(b){var c=this._getCommand(b);return c&&c.enableReadOnly?a.bkqueryCommandValue.apply(a,arguments):null},this.setStatus("readonly"),a._interactChange()},enable:function(){var a=this;a.bkqueryCommandState&&(a.queryCommandState=a.bkqueryCommandState,delete a.bkqueryCommandState),a.bkqueryCommandValue&&(a.queryCommandValue=a.bkqueryCommandValue,delete a.bkqueryCommandValue),this.setStatus("normal"),a._interactChange()}})}},b[47]={value:function(a,c,d){function e(){function a(a,b){var c=[];["center","left","right","top","bottom","outline","outside"].forEach(function(a){var d="before"+a,e="after"+a;b[d]&&(c=c.concat(b[d])),b[a]&&(c=c.concat(b[a])),b[e]&&(c=c.concat(b[e]))}),a._renderers=c.map(function(b){return new b(a)})}return{renderNodeBatch:function(b){var c,d,e,g,h=this._rendererClasses,i=[],j=0;if(b.length){for(d=0;d<b.length;d++)g=b[d],g._renderers||a(g,h),g._contentBox=new f.Box,this.fire("beforerender",{node:g});for(j=b[0]._renderers.length,c=0;j>c;c++){for(d=0;d<b.length;d++)"function"==typeof i[d]&&(i[d]=i[d]()),i[d]instanceof f.Box||(i[d]=new f.Box(i[d]));for(d=0;d<b.length;d++)g=b[d],e=g._renderers[c],i[d]&&(g._contentBox=g._contentBox.merge(i[d]),e.contentBox=i[d]),e.shouldRender(g)?(e.getRenderShape()||(e.setRenderShape(e.create(g)),e.bringToBack?g.getRenderContainer().prependShape(e.getRenderShape()):g.getRenderContainer().appendShape(e.getRenderShape())),e.getRenderShape().setVisible(!0),i[d]=e.update(e.getRenderShape(),g,g._contentBox)):e.getRenderShape()&&(e.getRenderShape().setVisible(!1),i[d]=null)}for(d=0;d<b.length;d++)this.fire("noderender",{node:b[d]})}},renderNode:function(b){var c,d=this._rendererClasses;b._renderers||a(b,d),this.fire("beforerender",{node:b}),b._contentBox=new f.Box,b._renderers.forEach(function(a){a.shouldRender(b)?(a.getRenderShape()||(a.setRenderShape(a.create(b)),a.bringToBack?b.getRenderContainer().prependShape(a.getRenderShape()):b.getRenderContainer().appendShape(a.getRenderShape())),a.getRenderShape().setVisible(!0),c=a.update(a.getRenderShape(),b,b._contentBox),"function"==typeof c&&(c=c()),c&&(b._contentBox=b._contentBox.merge(c),a.contentBox=c)):a.getRenderShape()&&a.getRenderShape().setVisible(!1)}),this.fire("noderender",{node:b})}}}var f=b.r(38),g=b.r(40),h=b.r(42),i=f.createClass("Renderer",{constructor:function(a){this.node=a},create:function(){throw new Error("Not implement: Renderer.create()")},shouldRender:function(){return!0},watchChange:function(a){var b;b=void 0===this.watchingData?!0:this.watchingData!=a?!0:!1,this.watchingData=a},shouldDraw:function(){return!0},update:function(a,b,c){return this.shouldDraw()&&this.draw(a,b),this.place(a,b,c)},draw:function(){throw new Error("Not implement: Renderer.draw()")},place:function(){throw new Error("Not implement: Renderer.place()")},getRenderShape:function(){return this._renderShape||null},setRenderShape:function(a){this._renderShape=a}});f.extendClass(g,e()),f.extendClass(h,{render:function(){return this.attached?(this.getMinder().renderNode(this),this):void 0},renderTree:function(){if(this.attached){var a=[];return this.traverse(function(b){a.push(b)}),this.getMinder().renderNodeBatch(a),this}},getRenderer:function(a){var b=this._renderers;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].getType()==a)return b[c];return null},getContentBox:function(){return this.parent&&this.parent.isCollapsed()?new f.Box:this._contentBox||new f.Box},getRenderBox:function(a,b){var c=a&&this.getRenderer(a),d=c?c.contentBox:this.getContentBox(),e=f.Matrix.getCTM(this.getRenderContainer(),b||"paper");return e.transformBox(d)}}),d.exports=i}},b[48]={value:function(){var a=b.r(38),c=b.r(53),d=b.r(40),e=b.r(42);d.registerInitHook(function(){this._initSelection()}),a.extendClass(d,{_initSelection:function(){this._selectedNodes=[]},renderChangedSelection:function(a){var b=this.getSelectedNodes(),c=[];for(b.forEach(function(b){-1==a.indexOf(b)&&c.push(b)}),a.forEach(function(a){-1==b.indexOf(a)&&c.push(a)}),c.length&&(this._interactChange(),this.fire("selectionchange"));c.length;)c.shift().render()},getSelectedNodes:function(){return this._selectedNodes},getSelectedNode:function(){return this.getSelectedNodes()[0]||null},removeAllSelectedNodes:function(){var a=this._selectedNodes.splice(0);return this._selectedNodes=[],this.renderChangedSelection(a),this.fire("selectionclear")},removeSelectedNodes:function(a){var b=this,d=this._selectedNodes.slice(0);return a=c.isArray(a)?a:[a],a.forEach(function(a){var c;-1!==(c=b._selectedNodes.indexOf(a))&&b._selectedNodes.splice(c,1)}),this.renderChangedSelection(d),this},select:function(a,b){var d=this.getSelectedNodes().slice(0);b&&(this._selectedNodes=[]);var e=this;return a=c.isArray(a)?a:[a],a.forEach(function(a){-1===e._selectedNodes.indexOf(a)&&e._selectedNodes.unshift(a)}),this.renderChangedSelection(d),this},toggleSelect:function(a){return c.isArray(a)?a.forEach(this.toggleSelect.bind(this)):a.isSelected()?this.removeSelectedNodes(a):this.select(a),this},isSingleSelect:function(){return 1==this._selectedNodes.length},getSelectedAncestors:function(a){function b(a,b){for(var c=a.length-1;c>=0;--c)if(a[c].isAncestorOf(b))return!0;return!1}var c,d=this.getSelectedNodes().slice(0),e=[],f=d.indexOf(this.getRoot());for(~f&&!a&&d.splice(f,1),d.sort(function(a,b){return a.getLevel()-b.getLevel()});c=d.pop();)b(d,c)||e.push(c);return e}}),a.extendClass(e,{isSelected:function(){var a=this.getMinder();return a&&-1!=a.getSelectedNodes().indexOf(this)}})}},b[49]={value:function(){function a(a){var b=4096,c=8192,d=16384,f=0;return"string"==typeof a?a.toLowerCase().split(/\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":f|=b;break;case"alt":f|=c;break;case"shift":f|=d;break;default:f|=e[a]}}):((a.ctrlKey||a.metaKey)&&(f|=b),a.altKey&&(f|=c),a.shiftKey&&(f|=d),f|=a.keyCode),f}var c=b.r(38),d=b.r(53),e=b.r(36),f=b.r(40),g=b.r(34);c.extendClass(g,{isShortcutKey:function(b){var c=this.originEvent;return c?a(b)==a(c):!1}}),f.registerInitHook(function(){this._initShortcutKey()}),c.extendClass(f,{_initShortcutKey:function(){this._bindShortcutKeys()},_bindShortcutKeys:function(){var a=this._shortcutKeys={},b="hasOwnProperty";this.on("keydown",function(c){for(var d in a)if(a[b](d)&&c.isShortcutKey(d)){var e=a[d];if(e.__statusCondition&&e.__statusCondition!=this.getStatus())return;e(),c.preventDefault()}})},addShortcut:function(a,b){var c=this._shortcutKeys;a.split(/\|\s*/).forEach(function(a){var d,e=a.split("::");e.length>1&&(a=e[1],d=e[0],b.__statusCondition=d),c[a]=b})},addCommandShortcutKeys:function(a,b){var c=this._commandShortcutKeys||(this._commandShortcutKeys={}),e={};b?e[a]=b:e=a;var f=this;d.each(e,function(a,b){c[b]=a,f.addShortcut(a,function(){0===f.queryCommandState(b)&&f.execCommand(b)})})},getCommandShortcutKey:function(a){var b=this._commandShortcutKeys;return b&&b[a]||null}})}},b[50]={value:function(){var a=b.r(38),c=b.r(40),d=~window.location.href.indexOf("status"),e=~window.location.href.indexOf("trace");c.registerInitHook(function(){this._initStatus()}),a.extendClass(c,{_initStatus:function(){this._status="normal",this._rollbackStatus="normal"},setStatus:function(a,b){return"readonly"!=this._status||b?(a!=this._status&&(this._rollbackStatus=this._status,this._status=a,this.fire("statuschange",{lastStatus:this._rollbackStatus,currentStatus:this._status}),d&&(console.log(window.event.type,this._rollbackStatus,"->",this._status),e&&console.trace())),this):this},rollbackStatus:function(){this.setStatus(this._rollbackStatus)},getRollbackStatus:function(){return this._rollbackStatus},getStatus:function(){return this._status}})}},b[51]={value:function(a,c){function d(a,b){k[a]=b}var e=b.r(38),f=b.r(53),g=b.r(40),h=b.r(30),i=b.r(42),j=b.r(41),k={};c.register=d,f.extend(g,{getTemplateList:function(){return k}}),e.extendClass(g,function(){var a=g.prototype.getTheme;return{useTemplate:function(a,b){this.setTemplate(a),this.refresh(b||800)},getTemplate:function(){return this._template||"default"},setTemplate:function(a){this._template=a||null},getTemplateSupport:function(a){var b=k[this.getTemplate()];return b&&b[a]},getTheme:function(b){var c=this.getTemplateSupport("getTheme")||a;return c.call(this,b)}}}()),e.extendClass(i,function(){var a=i.prototype.getLayout,b=i.prototype.getConnect;return{getLayout:function(){var b=this.getMinder().getTemplateSupport("getLayout")||a;return b.call(this,this)},getConnect:function(){var a=this.getMinder().getTemplateSupport("getConnect")||b;return a.call(this,this)}}}()),j.register("TemplateModule",{commands:{template:e.createClass("TemplateCommand",{base:h,execute:function(a,b){a.useTemplate(b),a.execCommand("camera")},queryValue:function(a){return a.getTemplate()||"default"}})}})}},b[52]={value:function(a,c){function d(a,b){l[a]=b}var e=b.r(38),f=b.r(53),g=b.r(40),h=b.r(42),i=b.r(41),j=b.r(30),k={left:function(a){return 3 in a&&a[3]||1 in a&&a[1]||a[0]},right:function(a){return 1 in a&&a[1]||a[0]},top:function(a){return a[0]},bottom:function(a){return 2 in a&&a[2]||a[0]}},l={};c.register=d,f.extend(g,{getThemeList:function(){return l}}),e.extendClass(g,{useTheme:function(a){return this.setTheme(a),this.refresh(800),!0},setTheme:function(a){var b=this._theme;this._theme=a||null;var c=this.getRenderTarget();return c&&(c.classList.remove("km-theme-"+b),a&&c.classList.add("km-theme-"+a),c.style.background=this.getStyle("background")),this.fire("themechange",{theme:a}),this},getTheme:function(){return this._theme||this.getOption("defaultTheme")||"fresh-blue"},getThemeItems:function(a){this.getTheme(a);return l[this.getTheme(a)]},getStyle:function(a,b){var c,d,e,g,h=this.getThemeItems(b);if(a in h)return h[a];if(c=a.split("-"),c.length<2)return null;if(d=c.pop(),a=c.join("-"),a in h){if(e=h[a],f.isArray(e)&&(g=k[d]))return g(e);if(!isNaN(e))return e}return null},getNodeStyle:function(a,b){var c=this.getStyle(a.getType()+"-"+b,a);return null!==c?c:this.getStyle(b,a)}}),e.extendClass(h,{getStyle:function(a){return this.getMinder().getNodeStyle(this,a)}}),i.register("Theme",{defaultOptions:{defaultTheme:"fresh-blue"},commands:{theme:e.createClass("ThemeCommand",{base:j,execute:function(a,b){return a.useTheme(b)},queryValue:function(a){return a.getTheme()||"default"}})}}),g.registerInitHook(function(){this.setTheme()})}},b[53]={value:function(a,c){var d=b.r(38),e={};c.extend=d.Utils.extend.bind(d.Utils),c.each=d.Utils.each.bind(d.Utils),c.uuid=function(a){return e[a]=e[a]?e[a]+1:1,a+e[a]},c.guid=function(){return(1e6*+new Date+Math.floor(1e6*Math.random())).toString(36)},c.trim=function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},c.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},c.clone=function(a){return JSON.parse(JSON.stringify(a))},c.comparePlainObject=function(a,b){return JSON.stringify(a)==JSON.stringify(b)},c.encodeHtml=function(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},c.clearWhiteSpace=function(a){return a.replace(/[\u200b\t\r\n]/g,"")},c.each(["String","Function","Array","Number","RegExp","Object"],function(a){var b=Object.prototype.toString;c["is"+a]=function(c){return b.apply(c)=="[object "+a+"]"}})}},b[54]={value:function(a,c,d){d.exports=window.kityminder=b.r(55)}},b[55]={value:function(a,c,d){var e={version:b.r(40).version};b.r(53),e.Minder=b.r(40),e.Command=b.r(30),e.Node=b.r(42),b.r(43),b.r(29),e.Event=b.r(34),e.data=b.r(33),b.r(31),e.KeyMap=b.r(36),b.r(49),b.r(50),b.r(44),b.r(48),b.r(35),b.r(37),e.Module=b.r(41),b.r(46),e.Render=b.r(47),e.Connect=b.r(32),e.Layout=b.r(39),e.Theme=b.r(52),e.Template=b.r(51),e.Promise=b.r(45),b.r(61),b.r(62),b.r(63),b.r(64),b.r(65),b.r(66),b.r(67),b.r(68),b.r(69),b.r(70),b.r(71),b.r(72),b.r(73),b.r(74),b.r(75),b.r(76),b.r(77),b.r(78),b.r(79),b.r(80),b.r(81),b.r(82),b.r(83),b.r(87),b.r(84),b.r(86),b.r(85),b.r(60),b.r(56),b.r(57),b.r(58),b.r(59),b.r(93),b.r(96),b.r(95),b.r(94),b.r(97),b.r(23),b.r(24),b.r(25),b.r(26),b.r(27),b.r(28),b.r(88),b.r(92),b.r(89),b.r(91),b.r(90),d.exports=e}},b[56]={value:function(){function a(a){function b(a){var b=[],d=a.getLayoutBox(),f=5;return"x"==e?(b.push({type:"up",node:a,area:new c.Box({x:d.x,y:d.top-a.getStyle("margin-top")-f,width:d.width,height:a.getStyle("margin-top")}),path:["M",d.x,d.top-f,"L",d.right,d.top-f]}),b.push({type:"down",node:a,area:new c.Box({x:d.x,y:d.bottom+f,width:d.width,height:a.getStyle("margin-bottom")}),path:["M",d.x,d.bottom+f,"L",d.right,d.bottom+f]})):(b.push({type:"up",node:a,area:new c.Box({x:d.left-a.getStyle("margin-left")-f,y:d.top,width:a.getStyle("margin-left"),height:d.height}),path:["M",d.left-f,d.top,"L",d.left-f,d.bottom]}),b.push({type:"down",node:a,area:new c.Box({x:d.right+f,y:d.top,width:a.getStyle("margin-right"),height:d.height}),path:["M",d.right+f,d.top,"L",d.right+f,d.bottom]})),b}var e="left"==a||"right"==a?"x":"y",f="left"==a||"top"==a?-1:1,g={left:"right",right:"left",top:"bottom",bottom:"top",x:"y",y:"x"};d.register(a,c.createClass({base:d,doLayout:function(b,d){var h=b.getContentBox();if("x"==e?(b.setVertexOut(new c.Point(h[a],h.cy)),b.setLayoutVectorOut(new c.Vector(f,0))):(b.setVertexOut(new c.Point(h.cx,h[a])),b.setLayoutVectorOut(new c.Vector(0,f))),!d.length)return!1;d.forEach(function(b){var d=b.getContentBox();b.setLayoutTransform(new c.Matrix),"x"==e?(b.setVertexIn(new c.Point(d[g[a]],d.cy)),b.setLayoutVectorIn(new c.Vector(f,0))):(b.setVertexIn(new c.Point(d.cx,d[g[a]])),b.setLayoutVectorIn(new c.Vector(0,f)))}),this.align(d,g[a]),this.stack(d,g[e]);var i,j,k=this.getBranchBox(d);"x"==e?(i=h[a],i+=f*b.getStyle("margin-"+a),i+=f*d[0].getStyle("margin-"+g[a]),j=h.bottom,j-=h.height/2,j-=k.height/2,j-=k.y):(i=h.right,i-=h.width/2,i-=k.width/2,i-=k.x,j=h[a],j+=f*b.getStyle("margin-"+a),
j+=f*d[0].getStyle("margin-"+g[a])),this.move(d,i,j)},getOrderHint:b}))}var c=b.r(38),d=b.r(39);["left","right","top","bottom"].forEach(a)}},b[57]={value:function(){function a(a){var b="filetree-"+(a>0?"down":"up");d.register(b,c.createClass({base:d,doLayout:function(b,d){var e=b.getContentBox(),f=20;if(b.setVertexOut(new c.Point(e.left+f,a>0?e.bottom:e.top)),b.setLayoutVectorOut(new c.Vector(0,a)),d.length){d.forEach(function(a){var b=a.getContentBox();a.setLayoutTransform(new c.Matrix),a.setVertexIn(new c.Point(b.left,b.cy)),a.setLayoutVectorIn(new c.Vector(1,0))}),this.align(d,"left"),this.stack(d,"y");var g=0;g+=e.left,g+=f,g+=d[0].getStyle("margin-left");var h=0;a>0?(h+=e.bottom,h+=b.getStyle("margin-bottom"),h+=d[0].getStyle("margin-top")):(h-=this.getTreeBox(d).bottom,h+=e.top,h-=b.getStyle("margin-top"),h-=d[0].getStyle("margin-bottom")),this.move(d,g,h)}},getOrderHint:function(a){var b=[],d=a.getLayoutBox(),e=a.getLevel()>1?3:5;return b.push({type:"up",node:a,area:new c.Box({x:d.x,y:d.top-a.getStyle("margin-top")-e,width:d.width,height:a.getStyle("margin-top")}),path:["M",d.x,d.top-e,"L",d.right,d.top-e]}),b.push({type:"down",node:a,area:new c.Box({x:d.x,y:d.bottom+e,width:d.width,height:a.getStyle("margin-bottom")}),path:["M",d.x,d.bottom+e,"L",d.right,d.bottom+e]}),b}}))}var c=b.r(38),d=b.r(39);[-1,1].forEach(a)}},b[58]={value:function(){var a=b.r(38),c=b.r(39);c.register("fish-bone-master",a.createClass("FishBoneMasterLayout",{base:c,doLayout:function(b,c){var d=[],e=[],f=c[0],g=b.getContentBox();if(b.setVertexOut(new a.Point(g.right,g.cy)),b.setLayoutVectorOut(new a.Vector(1,0)),f){var h=(f.getContentBox(),b.getStyle("margin-right")),i=f.getStyle("margin-left"),j=f.getStyle("margin-top"),k=f.getStyle("margin-bottom");c.forEach(function(b,c){b.setLayoutTransform(new a.Matrix);var f=b.getContentBox();c%2?(e.push(b),b.setVertexIn(new a.Point(f.left,f.top)),b.setLayoutVectorIn(new a.Vector(1,1))):(d.push(b),b.setVertexIn(new a.Point(f.left,f.bottom)),b.setLayoutVectorIn(new a.Vector(1,-1)))}),this.stack(d,"x"),this.stack(e,"x"),this.align(d,"bottom"),this.align(e,"top");var l=g.right+h+i,m=g.cy-k-b.getStyle("margin-top"),n=g.cy+j+b.getStyle("margin-bottom");this.move(d,l,m),this.move(e,l+i,n)}}}))}},b[59]={value:function(){var a=b.r(38),c=b.r(39);c.register("fish-bone-slave",a.createClass("FishBoneSlaveLayout",{base:c,doLayout:function(b,c,d){var e=this,f=Math.abs,g=.382,h=b.getContentBox(),i=b.getLayoutVectorIn();b.setLayoutVectorOut(i);var j=h.left+h.width*g,k=new a.Point(j,i.y>0?h.bottom:h.top);b.setVertexOut(k);var l=c[0];if(l){var m=l.getContentBox();c.forEach(function(b){b.setLayoutTransform(new a.Matrix),b.setLayoutVectorIn(new a.Vector(1,0)),b.setVertexIn(new a.Point(m.left,m.cy))}),this.stack(c,"y"),this.align(c,"left");var n=0,o=0;n+=k.x,b.getLayoutVectorOut().y<0?(o-=this.getTreeBox(c).bottom,o+=b.getContentBox().top,o-=b.getStyle("margin-top"),o-=l.getStyle("margin-bottom")):(o+=b.getContentBox().bottom,o+=b.getStyle("margin-bottom"),o+=l.getStyle("margin-top")),this.move(c,n,o),2==d&&c.forEach(function(b){var c=b.getLayoutTransform(),d=b.getContentBox(),g=c.transformPoint(new a.Point(d.left,0));e.move([b],f(g.y-k.y),0)})}}}))}},b[60]={value:function(){var a=b.r(38),c=b.r(39),d=b.r(40);c.register("mind",a.createClass({base:c,doLayout:function(b,c){var e=Math.ceil(b.children.length/2),f=[],g=[];c.forEach(function(a){a.getIndex()<e?f.push(a):g.push(a)});var h=d.getLayoutInstance("left"),i=d.getLayoutInstance("right");h.doLayout(b,g),i.doLayout(b,f);var j=b.getContentBox();b.setVertexOut(new a.Point(j.cx,j.cy)),b.setLayoutVectorOut(new a.Vector(0,0))},getOrderHint:function(b){var c=[],d=b.getLayoutBox(),e=5;return c.push({type:"up",node:b,area:new a.Box({x:d.x,y:d.top-b.getStyle("margin-top")-e,width:d.width,height:b.getStyle("margin-top")}),path:["M",d.x,d.top-e,"L",d.right,d.top-e]}),c.push({type:"down",node:b,area:new a.Box({x:d.x,y:d.bottom+e,width:d.width,height:b.getStyle("margin-bottom")}),path:["M",d.x,d.bottom+e,"L",d.right,d.bottom+e]}),c}}))}},b[61]={value:function(){function a(a,b){return a.getIndex()-b.getIndex()}function c(b,c){return-a(b,c)}var d=b.r(38),e=b.r(42),f=b.r(30),g=b.r(41);d.extendClass(e,{arrange:function(a){var b=this.parent;if(b){var c=b.children;if(!(0>a||a>=c.length))return c.splice(this.getIndex(),1),c.splice(a,0,this),this}}});var h=d.createClass("ArrangeUpCommand",{base:f,execute:function(b){var c=b.getSelectedNodes();c.sort(a);var d=c.map(function(a){return a.getIndex()});c.forEach(function(a,b){a.arrange(d[b]-1)}),b.layout(300)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),i=d.createClass("ArrangeUpCommand",{base:f,execute:function(a){var b=a.getSelectedNodes();b.sort(c);var d=b.map(function(a){return a.getIndex()});b.forEach(function(a,b){a.arrange(d[b]+1)}),a.layout(300)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),j=d.createClass("ArrangeCommand",{base:f,execute:function(a,b){var c=a.getSelectedNodes().slice();if(c.length){var d=e.getCommonAncestor(c);if(d==c[0].parent){var f=c.map(function(a){return{index:a.getIndex(),node:a}}),g=Math.min.apply(Math,f.map(function(a){return a.index}))>=b;f.sort(function(a,b){return g?b.index-a.index:a.index-b.index}),f.forEach(function(a){a.node.arrange(b)}),a.layout(300)}}},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}});g.register("ArrangeModule",{commands:{arrangeup:h,arrangedown:i,arrange:j},contextmenu:[{command:"arrangeup"},{command:"arrangedown"},{divider:!0}],commandShortcutKeys:{arrangeup:"normal::alt+Up",arrangedown:"normal::alt+Down"}})}},b[62]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41),e=b.r(80);d.register("basestylemodule",function(){function b(a,b){return a.getData(b)||a.getStyle(b)}var d=this;return e.registerStyleHook(function(a,c){{var d=b(a,"font-weight"),e=b(a,"font-style");[d,e].join("/")}c.eachItem(function(a,b){b.setFont({weight:d,style:e})})}),{commands:{bold:a.createClass("boldCommand",{base:c,execute:function(a){var b=a.getSelectedNodes();b.forEach(1==this.queryState("bold")?function(a){a.setData("font-weight").render()}:function(a){a.setData("font-weight","bold").render()}),a.layout()},queryState:function(){var a=d.getSelectedNodes(),b=0;return 0===a.length?-1:(a.forEach(function(a){return a&&a.getData("font-weight")?(b=1,!1):void 0}),b)}}),italic:a.createClass("italicCommand",{base:c,execute:function(a){var b=a.getSelectedNodes();b.forEach(1==this.queryState("italic")?function(a){a.setData("font-style").render()}:function(a){a.setData("font-style","italic").render()}),a.layout()},queryState:function(){var a=d.getSelectedNodes(),b=0;return 0===a.length?-1:(a.forEach(function(a){return a&&a.getData("font-style")?(b=1,!1):void 0}),b)}})},commandShortcutKeys:{bold:"ctrl+b",italic:"ctrl+i"}}})}},b[63]={value:function(){var a=b.r(38),c=(b.r(53),b.r(42)),d=b.r(30),e=b.r(41);e.register("ClipboardModule",function(){function b(a,c){h.push(c),f.appendNode(c,a),c.render(),c.setLayoutOffset(null);for(var d,e=c.children.map(function(a){return a.clone()}),g=0;d=e[g];g++)b(c,d)}function e(a){a.length&&(a.sort(function(a,b){return b.getIndex()-a.getIndex()}),g=a.map(function(a){return a.clone()}))}var f=this,g=[],h=[],i=a.createClass("CopyCommand",{base:d,execute:function(a){e(a.getSelectedAncestors(!0)),this.setContentChanged(!1)}}),j=a.createClass("CutCommand",{base:d,execute:function(a){var b=a.getSelectedAncestors();0!==b.length&&(e(b),a.select(c.getCommonAncestor(b),!0),b.slice().forEach(function(b){a.removeNode(b)}),a.layout(300))}}),k=a.createClass("PasteCommand",{base:d,execute:function(a){if(g.length){var c=a.getSelectedNode();if(!c)return;for(var d,e=0;d=g[e];e++)b(c,d.clone());a.select(h,!0),h=[],a.layout(300)}},queryState:function(a){return a.getSelectedNode()?0:-1}});return{commands:{copy:i,cut:j,paste:k},commandShortcutKeys:{copy:"normal::ctrl+c|",cut:"normal::ctrl+x",paste:"normal::ctrl+v"}}})}},b[64]={value:function(){var a=b.r(38),c=(b.r(53),b.r(42)),d=b.r(30),e=b.r(41),f=a.createClass("MoveToParentCommand",{base:d,execute:function(a,b,c){for(var d,e=b.length-1;e>=0;e--)d=b[e],d.parent&&(d.parent.removeChild(d),c.appendChild(d),d.render());c.expand(),a.select(b,!0)}}),g=a.createClass("DropHinter",{base:a.Group,constructor:function(){this.callBase(),this.rect=new a.Rect,this.addShape(this.rect)},render:function(a){this.setVisible(!!a),a&&(this.rect.setBox(a.getLayoutBox()).setRadius(a.getStyle("radius")||0).stroke(a.getStyle("drop-hint-color")||"yellow",a.getStyle("drop-hint-width")||2),this.bringTop())}}),h=a.createClass("OrderHinter",{base:a.Group,constructor:function(){this.callBase(),this.area=new a.Rect,this.path=new a.Path,this.addShapes([this.area,this.path])},render:function(a){this.setVisible(!!a),a&&(this.area.setBox(a.area),this.area.fill(a.node.getStyle("order-hint-area-color")||"rgba(0, 255, 0, .5)"),this.path.setPathData(a.path),this.path.stroke(a.node.getStyle("order-hint-path-color")||"#0f0",a.node.getStyle("order-hint-path-width")||1))}}),i=a.createClass("TreeDragger",{constructor:function(a){this._minder=a,this._dropHinter=new g,this._orderHinter=new h,a.getRenderContainer().addShapes([this._dropHinter,this._orderHinter])},dragStart:function(a){this._startPosition=a},dragMove:function(b){var c=10;if(this._startPosition){var d=a.Vector.fromPoints(this._dragPosition||this._startPosition,b),e=this._minder;if(this._dragPosition=b,!this._dragMode){if(a.Vector.fromPoints(this._dragPosition,this._startPosition).length()<c)return;if(!this._enterDragMode())return}for(var f=0;f<this._dragSources.length;f++)this._dragSources[f].setLayoutOffset(this._dragSources[f].getLayoutOffset().offset(d)),e.applyLayoutResult(this._dragSources[f]);this._dropTest()?this._renderOrderHint(this._orderSucceedHint=null):this._orderTest()}},dragEnd:function(){if(this._startPosition=null,this._dragPosition=null,this._dragMode){if(this._fadeDragSources(1),this._dropSucceedTarget)this._dragSources.forEach(function(a){a.setLayoutOffset(null)}),this._minder.layout(-1),this._minder.execCommand("movetoparent",this._dragSources,this._dropSucceedTarget);else if(this._orderSucceedHint){var a=this._orderSucceedHint,b=a.node.getIndex(),c=this._dragSources.map(function(a){return a.setLayoutOffset(null),a.getIndex()}),d=Math.max.apply(Math,c),e=Math.min.apply(Math,c);e>b&&"down"==a.type&&b++,b>d&&"up"==a.type&&b--,a.node.setLayoutOffset(null),this._minder.execCommand("arrange",b),this._renderOrderHint(null)}else this._minder.fire("savescene");this._minder.layout(300),this._leaveDragMode(),this._minder.fire("contentchange")}},_enterDragMode:function(){return this._calcDragSources(),this._dragSources.length?(this._fadeDragSources(.5),this._calcDropTargets(),this._calcOrderHints(),this._dragMode=!0,this._minder.setStatus("dragtree"),!0):(this._startPosition=null,!1)},_calcDragSources:function(){this._dragSources=this._minder.getSelectedAncestors()},_fadeDragSources:function(a){var b=this._minder;this._dragSources.forEach(function(c){c.getRenderContainer().setOpacity(a,200),c.traverse(function(c){1>a?b.detachNode(c):b.attachNode(c)},!0)})},_calcDropTargets:function(){function a(b,c){var d,e=[];return e.push(c),c.getChildren().forEach(function(c){for(d=0;d<b.length;d++)if(b[d]==c)return;e=e.concat(a(b,c))}),e}this._dropTargets=a(this._dragSources,this._minder.getRoot()),this._dropTargetBoxes=this._dropTargets.map(function(a){return a.getLayoutBox()})},_calcOrderHints:function(){var a=this._dragSources,b=c.getCommonAncestor(a);if(b==a[0]&&(b=a[0].parent),0===a.length||b!=a[0].parent)return void(this._orderHints=[]);var d=b.children;this._orderHints=d.reduce(function(b,c){return-1==a.indexOf(c)&&(b=b.concat(c.getOrderHint())),b},[])},_leaveDragMode:function(){this._dragMode=!1,this._dropSucceedTarget=null,this._orderSucceedHint=null,this._renderDropHint(null),this._renderOrderHint(null),this._minder.rollbackStatus()},_drawForDragMode:function(){this._text.setContent(this._dragSources.length+" items"),this._text.setPosition(this._startPosition.x,this._startPosition.y+5),this._minder.getRenderContainer().addShape(this)},_boxTest:function(a,b,c){var d,e,f,g,h,i=this._dragSources.map(function(a){return a.getLayoutBox()});for(c=c||function(a){return a&&!a.isEmpty()},d=0;d<a.length;d++)for(f=a[d],h=b.call(this,f,d),e=0;e<i.length;e++){g=i[e];var j=g.intersect(h);if(c(j,g,h))return f}return null},_dropTest:function(){return this._dropSucceedTarget=this._boxTest(this._dropTargets,function(a,b){return this._dropTargetBoxes[b]},function(a,b,c){function d(a){return a.width*a.height}return a?d(a)>.5*Math.min(d(b),d(c))?!0:a.width+1>=Math.min(b.width,c.width)?!0:a.height+1>=Math.min(b.height,c.height)?!0:!1:!1}),this._renderDropHint(this._dropSucceedTarget),!!this._dropSucceedTarget},_orderTest:function(){return this._orderSucceedHint=this._boxTest(this._orderHints,function(a){return a.area}),this._renderOrderHint(this._orderSucceedHint),!!this._orderSucceedHint},_renderDropHint:function(a){this._dropHinter.render(a)},_renderOrderHint:function(a){this._orderHinter.render(a)},preventDragMove:function(){this._startPosition=null}});e.register("DragTree",function(){var a;return{init:function(){a=new i(this),window.addEventListener("mouseup",function(){a.dragEnd()})},events:{"normal.mousedown inputready.mousedown":function(b){b.originEvent.button||b.getTargetNode()&&b.getTargetNode()!=this.getRoot()&&a.dragStart(b.getPosition())},"normal.mousemove dragtree.mousemove":function(b){a.dragMove(b.getPosition())},"normal.mouseup dragtree.beforemouseup":function(b){a.dragEnd(),b.preventDefault()},statuschange:function(b){"textedit"==b.lastStatus&&"normal"==b.currentStatus&&a.preventDragMove()}},commands:{movetoparent:f}}})}},b[65]={value:function(){var a=b.r(38),c=b.r(53),d=b.r(36),e=b.r(42),f=b.r(30),g=b.r(41),h=b.r(47);g.register("Expand",function(){var b=this,g="expandState",i="expand",j="collapse";a.extendClass(e,{expand:function(){return this.setData(g,i),this},collapse:function(){return this.setData(g,j),this},isExpanded:function(){var a=this.getData(g)!==j;return a&&(this.isRoot()||this.parent.isExpanded())},isCollapsed:function(){return!this.isExpanded()}});var k=a.createClass("ExpandCommand",{base:f,execute:function(a,b){var c=a.getSelectedNode();if(c){for(b&&(c=c.parent);c.parent;)c.expand(),c=c.parent;c.renderTree(),a.layout(100)}},queryState:function(a){return a.getSelectedNode()?0:-1}}),l=a.createClass("ExpandToLevelCommand",{base:f,execute:function(a,b){a.getRoot().traverse(function(a){a.getLevel()<b&&a.expand(),a.getLevel()==b&&a.collapse()}),a.refresh(100)},enableReadOnly:!0}),m=a.createClass("Expander",{base:a.Group,constructor:function(b){this.callBase(),this.radius=6,this.outline=new a.Circle(this.radius).stroke("gray").fill("white"),this.sign=(new a.Path).stroke("gray"),this.addShapes([this.outline,this.sign]),this.initEvent(b),this.setId(c.uuid("node_expander")),this.setStyle("cursor","pointer")},initEvent:function(a){this.on("mousedown",function(b){a.isExpanded()?a.collapse():a.expand(),a.renderTree().getMinder().layout(100),a.getMinder().fire("contentchange"),b.stopPropagation(),b.preventDefault()}),this.on("dblclick click mouseup",function(a){a.stopPropagation(),a.preventDefault()})},setState:function(a){if("hide"==a)return void this.setVisible(!1);this.setVisible(!0);var b=["M",1.5-this.radius,0,"L",this.radius-1.5,0];a==j&&b.push(["M",0,1.5-this.radius,"L",0,this.radius-1.5]),this.sign.setPathData(b)}}),n=a.createClass("ExpanderRenderer",{base:h,create:function(a){return a.isRoot()?void 0:(this.expander=new m(a),a.getRenderContainer().prependShape(this.expander),a.expanderRenderer=this,this.node=a,this.expander)},shouldRender:function(a){return!a.isRoot()},update:function(a,b){if(b.parent){var c=b.parent.isExpanded();a.setState(c&&b.children.length?b.getData(g):"hide");var d=b.getLayoutVectorIn().normalize(a.radius+b.getStyle("stroke-width")),e=b.getVertexIn().offset(d.reverse());this.expander.setTranslate(e)}}});return{commands:{expand:k,expandtolevel:l},events:{layoutapply:function(a){var b=a.node.getRenderer("ExpanderRenderer");b.getRenderShape()&&b.update(b.getRenderShape(),a.node)},beforerender:function(a){var b=a.node,c=!b.parent||b.parent.isExpanded();b.getRenderContainer().setVisible(c),c||a.stopPropagation()},"normal.keydown":function(a){if("textedit"!=this.getStatus()){if(a.originEvent.keyCode==d["/"]){var b=this.getSelectedNode();if(!b||b==this.getRoot())return;var c=b.isExpanded();this.getSelectedNodes().forEach(function(a){c?a.collapse():a.expand(),a.renderTree()}),this.layout(100),this.fire("contentchange"),a.preventDefault(),a.stopPropagationImmediately()}a.isShortcutKey("Alt+`")&&this.execCommand("expandtolevel",9999);for(var e=1;6>e;e++)a.isShortcutKey("Alt+"+e)&&this.execCommand("expandtolevel",e)}}},renderers:{outside:n},contextmenu:[{command:"expandtoleaf",query:function(){return!b.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",9999)}},{command:"expandtolevel1",query:function(){return!b.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",1)}},{command:"expandtolevel2",query:function(){return!b.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",2)}},{command:"expandtolevel3",query:function(){return!b.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",3)}},{divider:!0}]}})}},b[66]={value:function(){function a(a,b){return a.getData(b)||a.getStyle(b)}var c=b.r(38),d=(b.r(53),b.r(40),b.r(42),b.r(30)),e=b.r(41),f=b.r(80);f.registerStyleHook(function(b,c){var d=b.getData("color"),e=b.getStyle("selected-color"),f=b.getStyle("color"),g=d||(b.isSelected()&&e?e:f),h=a(b,"font-family"),i=a(b,"font-size");c.fill(g),c.eachItem(function(a,b){b.setFont({family:h,size:i})})}),e.register("fontmodule",{commands:{forecolor:c.createClass("fontcolorCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.setData("color",b),a.render()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){return 1==a.getSelectedNodes().length?a.getSelectedNodes()[0].getData("color"):"mixed"}}),background:c.createClass("backgroudCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.setData("background",b),a.render()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){return 1==a.getSelectedNodes().length?a.getSelectedNodes()[0].getData("background"):"mixed"}}),fontfamily:c.createClass("fontfamilyCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(c){c.setData("font-family",b),c.render(),a.layout()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("font-family"):null}}),fontsize:c.createClass("fontsizeCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(c){c.setData("font-size",b),c.render(),a.layout(300)})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("font-size"):null}})}})}},b[67]={value:function(){function a(b,e){var g;if(d(b)!==d(e))return!1;if(c(b)!=c(e))return!1;for(var h in b)if(b.hasOwnProperty(h)){if(g=b[h],void 0===e[h])return!1;if(f.isObject(g)||f.isArray(g)){if(f.isObject(e[h])!==f.isObject(g))return!1;if(f.isArray(g)!==f.isArray(e[h]))return!1;if(a(g,e[h])===!1)return!1}else if(g!=e[h])return!1}return!0}function c(a){if(f.isArray(a)||f.isString(a))return a.length;var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}function d(a){if(null===a||void 0===a)return!0;if(f.isArray(a)||f.isString(a))return 0===a.length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var e=b.r(38),f=b.r(53),g=(b.r(40),b.r(42),b.r(30)),h=b.r(41),i=e.createClass("Scene",{constructor:function(a,b){this.data=a.clone(),this.inputStatus=b},getData:function(){return this.data},cloneData:function(){return this.getData().clone()},equals:function(a){return this.getData().compareTo(a.getData())},isInputStatus:function(){return this.inputStatus},setInputStatus:function(a){this.inputStatus=a}}),j=e.createClass("HistoryManager",{constructor:function(a){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.km=a},undo:function(){if(this.hasUndo){var a=this.list[this.index];if(a&&a.isInputStatus())return this.saveScene(),this.restore(--this.index),void a.setInputStatus(!1);if(1==this.list.length)return void this.restore(0);if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].equals(this.list[this.index-1]);)if(this.index--,0===this.index)return this.restore(0);this.restore(--this.index)}},redo:function(){if(this.hasRedo){for(;this.list[this.index].equals(this.list[this.index+1]);)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},partialRenewal:function(b){function c(b,c){return b.getText()!=c.getText()?!1:a(b.getData(),c.getData())===!1?!1:!0}function d(a,b){b.isSelected()&&f.push(b),g.appendNode(b,a),b.render();for(var c,e=b.children.slice(),h=0;c=e[h++];)d(b,c)}function e(a,b){c(a,b)===!1&&a.setValue(b),a.render(),a.isSelected()&&f.push(a);for(var h,i,j=0,k=0;h=a.children[j],i=b.children[k],h||i;j++,k++)h&&!i?(j--,g.removeNode(h)):!h&&i?(k--,d(a,i)):e(h,i)}var f=[],g=this.km;e(g.getRoot(),b),g.layout(200),g.select(f,!0),f=[]},restore:function(a){a=void 0===a?this.index:a;var b=this.list[a];this.partialRenewal(b.cloneData()),this.update(),this.km.fire("restoreScene"),this.km.fire("contentChange")},getScene:function(a){return new i(this.km.getRoot(),a)},saveScene:function(a){var b=this.getScene(a),c=this.list[this.index];return c&&c.equals(b)?void(a&&(c.setInputStatus(!0),this.update())):(this.list=this.list.slice(0,this.index+1),this.list.push(b),this.list.length>this.km.getOption("maxUndoCount")&&this.list.shift(),this.index=this.list.length-1,void this.update())},update:function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1];var a=this.list[this.index];a&&a.isInputStatus()&&(this.hasUndo=!0)},reset:function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1}});h.register("HistoryModule",function(){return this.historyManager=new j(this),{defaultOptions:{maxUndoCount:20,maxInputCount:20},commands:{undo:e.createClass("UndoCommand",{base:g,execute:function(a){a.historyManager.undo()},queryState:function(a){return a.historyManager.hasUndo?0:-1},isNeedUndo:function(){return!1}}),redo:e.createClass("RedoCommand",{base:g,execute:function(a){a.historyManager.redo()},queryState:function(a){return a.historyManager.hasRedo?0:-1},isNeedUndo:function(){return!1}})},commandShortcutKeys:{undo:"ctrl+z",redo:"ctrl+y"},events:{saveScene:function(a){this.historyManager.saveScene(a.inputStatus)},"import":function(){this.historyManager.reset()}}}})}},b[68]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41),e=b.r(47),f="M16.614,10.224h-1.278c-1.668,0-3.07-1.07-3.599-2.556h4.877c0.707,0,1.278-0.571,1.278-1.278V3.834 c0-0.707-0.571-1.278-1.278-1.278h-4.877C12.266,1.071,13.668,0,15.336,0h1.278c2.116,0,3.834,1.716,3.834,3.834V6.39 C20.448,8.508,18.73,10.224,16.614,10.224z M5.112,5.112c0-0.707,0.573-1.278,1.278-1.278h7.668c0.707,0,1.278,0.571,1.278,1.278 S14.765,6.39,14.058,6.39H6.39C5.685,6.39,5.112,5.819,5.112,5.112z M2.556,3.834V6.39c0,0.707,0.573,1.278,1.278,1.278h4.877 c-0.528,1.486-1.932,2.556-3.599,2.556H3.834C1.716,10.224,0,8.508,0,6.39V3.834C0,1.716,1.716,0,3.834,0h1.278 c1.667,0,3.071,1.071,3.599,2.556H3.834C3.129,2.556,2.556,3.127,2.556,3.834z";d.register("hyperlink",{commands:{hyperlink:a.createClass("hyperlink",{base:c,execute:function(a,b,c){var d=a.getSelectedNodes();d.forEach(function(a){a.setData("hyperlink",b),a.setData("hyperlinkTitle",b&&c),a.render()}),a.layout()},queryState:function(a){var b=a.getSelectedNodes(),c=0;return 0===b.length?-1:(b.forEach(function(a){return a&&a.getData("hyperlink")?(c=0,!1):void 0}),c)},queryValue:function(a){var b=a.getSelectedNode();return{url:b.getData("hyperlink"),title:b.getData("hyperlinkTitle")}}})},renderers:{right:a.createClass("hyperlinkrender",{base:e,create:function(){var b=new a.HyperLink,c=new a.Path,d=new a.Rect(24,22,-2,-6,4).fill("rgba(255, 255, 255, 0)");return c.setPathData(f).fill("#666"),b.addShape(d),b.addShape(c),b.setTarget("_blank"),b.setStyle("cursor","pointer"),b.on("mouseover",function(){d.fill("rgba(255, 255, 200, .8)")}).on("mouseout",function(){d.fill("rgba(255, 255, 255, 0)")}),b},shouldRender:function(a){return a.getData("hyperlink")},update:function(b,c,d){var e=c.getData("hyperlink");b.setHref(e);var f=c.getData("hyperlinkTitle");f=f?[f,"(",e,")"].join(""):e,b.node.setAttributeNS("http://www.w3.org/1999/xlink","title",f);var g=c.getStyle("space-right");return b.setTranslate(d.right+g+2,-5),new a.Box({x:d.right+g,y:-11,width:24,height:22})}})}})}},b[69]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41),e=b.r(47);d.register("image",function(){function b(a,b){var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.onerror=function(){b(null)},c.src=a}function d(a,b,c,d){var e=a/b,f=c/d;return a>c&&e>f?(a=c,b=a/e):b>d&&(b=d,a=b*e),{width:0|a,height:0|b}}var f=a.createClass("ImageCommand",{base:c,execute:function(a,c,e){var f=a.getSelectedNodes();b(c,function(b,g){f.forEach(function(f){var h=d(b,g,a.getOption("maxImageWidth"),a.getOption("maxImageHeight"));f.setData("image",c),f.setData("imageTitle",c&&e),f.setData("imageSize",c&&h),f.render()}),a.fire("saveScene"),a.layout(300)})},queryState:function(a){var b=a.getSelectedNodes(),c=0;return 0===b.length?-1:(b.forEach(function(a){return a&&a.getData("image")?(c=0,!1):void 0}),c)},queryValue:function(a){var b=a.getSelectedNode();return{url:b.getData("image"),title:b.getData("imageTitle")}}}),g=a.createClass("ImageRenderer",{base:e,create:function(b){return new a.Image(b.getData("image"))},shouldRender:function(a){return a.getData("image")},update:function(b,c,d){var e=c.getData("image"),f=c.getData("imageTitle"),g=c.getData("imageSize"),h=c.getStyle("space-top");if(g){f&&b.node.setAttributeNS("http://www.w3.org/1999/xlink","title",f);var i=d.cx-g.width/2,j=d.y-g.height-h;return b.setUrl(e).setX(0|i).setY(0|j).setWidth(0|g.width).setHeight(0|g.height),new a.Box(0|i,0|j,0|g.width,0|g.height)}}});return{defaultOptions:{maxImageWidth:200,maxImageHeight:200},commands:{image:f},renderers:{top:g}}})}},b[70]={value:function(){{var a=(b.r(38),b.r(53),b.r(36),b.r(40),b.r(42),b.r(30),b.r(41));b.r(47)}a.register("KeyboardModule",function(){function a(a){var b,d=[];a.traverse(function(a){b=a.getLayoutBox(),b.width&&b.height&&d.push({left:b.x,top:b.y,right:b.x+b.width,bottom:b.y+b.height,width:b.width,height:b.height,node:a,text:a.getText()})});for(var e=0;e<d.length;e++)c(d,e)}function b(a,b){var c,d,h,i,j,k,l;return c=e(a.left,b.left),d=f(a.right,b.right),h=e(a.top,b.top),i=f(a.bottom,b.bottom),j=d-c-a.width-b.width,k=i-h-a.height-b.height,l=0>j?k:0>k?j:g(j*j+k*k),{cx:l,cy:l}}function c(a,c){for(var d,e,f=a[c],g={},h=0;h<a.length;h++)h!=c&&(d=a[h],e=b(d,f),d.right<f.left&&(!g.left||e.cx<g.left.dist)&&(g.left={dist:e.cx,node:d.node}),d.left>f.right&&(!g.right||e.cx<g.right.dist)&&(g.right={dist:e.cx,node:d.node}),d.bottom<f.top&&(!g.top||e.cy<g.top.dist)&&(g.top={dist:e.cy,node:d.node}),d.top>f.bottom&&(!g.down||e.cy<g.down.dist)&&(g.down={dist:e.cy,node:d.node}));f.node._nearestNodes={right:g.right&&g.right.node||null,top:g.top&&g.top.node||null,left:g.left&&g.left.node||null,down:g.down&&g.down.node||null}}function d(b,c){var d=b.getSelectedNode();if(!d)return b.select(b.getRoot()),void a(b.getRoot());d._nearestNodes||a(b.getRoot());var e=d._nearestNodes[c];e&&b.select(e,!0)}{var e=Math.min,f=Math.max,g=(Math.abs,Math.sqrt);Math.exp}return{events:{layoutallfinish:function(){var b=this.getRoot();a(b)},"normal.keydown readonly.keydown":function(a){var b=this;["left","right","up","down"].forEach(function(c){a.isShortcutKey(c)&&(d(b,"up"==c?"top":c),a.preventDefault())})}}}})}},b[71]={value:function(){var a=b.r(38),c=b.r(30),d=b.r(41),e=a.createClass("LayoutCommand",{base:c,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.layout(b)})},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("layout"):void 0},queryState:function(a){return a.getSelectedNode()?0:-1}}),f=a.createClass("ResetLayoutCommand",{base:c,execute:function(a){var b=a.getSelectedNodes();b.length||(b=[a.getRoot()]),b.forEach(function(a){a.traverse(function(a){a.resetLayoutOffset(),a.isRoot()||a.setData("layout",null)})}),a.layout(300)},enableReadOnly:!0});d.register("LayoutModule",{commands:{layout:e,resetlayout:f},contextmenu:[{command:"resetlayout"},{divider:!0}],commandShortcutKeys:{resetlayout:"Ctrl+Shift+L"}})}},b[72]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42)),d=b.r(30),e=b.r(41),f=(b.r(47),a.createClass("AppendChildCommand",{base:d,execute:function(a,b){var c=a.getSelectedNode();if(!c)return null;c.expand();var d=a.createNode(b,c);a.select(d,!0),d.render(),a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}})),g=a.createClass("AppendSiblingCommand",{base:d,execute:function(a,b){var c=a.getSelectedNode(),d=c.parent;if(!d)return a.execCommand("AppendChildNode",b);var e=a.createNode(b,d,c.getIndex()+1);e.setGlobalLayoutTransform(c.getGlobalLayoutTransform()),a.select(e,!0),e.render(),a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),h=a.createClass("RemoverNodeCommand",{base:d,execute:function(a){var b=a.getSelectedNodes(),d=c.getCommonAncestor.apply(null,b),e=b[0].getIndex();if(b.forEach(function(b){b.isRoot()||a.removeNode(b)}),1==b.length){var f=d.children[e-1]||d.children[e];a.select(f||d||a.getRoot(),!0)}else a.select(d||a.getRoot(),!0);a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b&&!b.isRoot()?0:-1}}),i=a.createClass("AppendParentCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();c.sort(function(a,b){return a.getIndex()-b.getIndex()});var d=c[0].parent,e=a.createNode(b,d,c[0].getIndex());c.forEach(function(a){e.appendChild(a)}),e.setGlobalLayoutTransform(c[c.length>>1].getGlobalLayoutTransform()),a.select(e,!0),a.layout(600)},queryState:function(a){var b=a.getSelectedNodes();if(b.length){var c=b[0].parent;if(!c)return-1;for(var d=1;d<b.length;d++)if(b[d].parent!=c)return-1;return 0}}});e.register("NodeModule",function(){return{commands:{AppendChildNode:f,AppendSiblingNode:g,RemoveNode:h,AppendParentNode:i},commandShortcutKeys:{appendsiblingnode:"normal::Enter",appendchildnode:"normal::Insert|Tab",appendparentnode:"normal::Shift+Tab|normal::Shift+Insert",removenode:"normal::Del|Backspace"}}})}},b[73]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41),e=b.r(47);d.register("NoteModule",function(){var b="M9,9H3V8h6L9,9L9,9z M9,7H3V6h6V7z M9,5H3V4h6V5z M8.5,11H2V2h8v7.5 M9,12l2-2V1H1v11",d=a.createClass("NoteCommand",{base:c,execute:function(a,b){var c=a.getSelectedNode();c.setData("note",b),c.render(),c.getMinder().layout(300)},queryState:function(a){return 1===a.getSelectedNodes().length?0:-1},queryValue:function(a){var b=a.getSelectedNode();return b&&b.getData("note")}}),f=a.createClass("NoteIcon",{base:a.Group,constructor:function(){this.callBase(),this.width=16,this.height=17,this.rect=new a.Rect(16,17,.5,-8.5,2).fill("transparent"),this.path=(new a.Path).setPathData(b).setTranslate(2.5,-6.5),this.addShapes([this.rect,this.path]),this.on("mouseover",function(){this.rect.fill("rgba(255, 255, 200, .8)")}).on("mouseout",function(){this.rect.fill("transparent")}),this.setStyle("cursor","pointer")}}),g=a.createClass("NoteIconRenderer",{base:e,create:function(a){var b=new f;return b.on("mousedown",function(b){b.preventDefault(),a.getMinder().fire("editnoterequest")}),b.on("mouseover",function(){a.getMinder().fire("shownoterequest",{node:a,
icon:b})}),b.on("mouseout",function(){a.getMinder().fire("hidenoterequest",{node:a,icon:b})}),b},shouldRender:function(a){return a.getData("note")},update:function(b,c,d){var e=d.right+c.getStyle("space-left"),f=d.cy;return b.path.fill(c.getStyle("color")),b.setTranslate(e,f),new a.Box(e,Math.round(f-b.height/2),b.width,b.height)}});return{renderers:{right:g},commands:{note:d}}})}},b[74]={value:function(){var a=b.r(38),c=b.r(53),d=(b.r(40),b.r(42),b.r(30),b.r(41)),e=b.r(47),f=a.createClass("OutlineRenderer",{base:e,create:function(){var b=(new a.Rect).setId(c.uuid("node_outline"));return this.bringToBack=!0,b},update:function(b,c,d){var e=c.getStyle("padding-left"),f=c.getStyle("padding-right"),g=c.getStyle("padding-top"),h=c.getStyle("padding-bottom"),i={x:d.x-e,y:d.y-g,width:d.width+e+f,height:d.height+g+h},j=c.isSelected()?c.getMinder().isFocused()?"selected-":"blur-selected-":"";return b.setPosition(i.x,i.y).setSize(i.width,i.height).setRadius(c.getStyle("radius")).fill(c.getData("background")||c.getStyle(j+"background")||c.getStyle("background")).stroke(c.getStyle(j+"stroke"||c.getStyle("stroke")),c.getStyle(j+"stroke-width")),new a.Box(i)}}),g=a.createClass("ShadowRenderer",{base:e,create:function(){return this.bringToBack=!0,new a.Rect},shouldRender:function(a){return a.getStyle("shadow")},update:function(a,b,c){a.setPosition(c.x+4,c.y+5).setSize(c.width,c.height).fill(b.getStyle("shadow")).setRadius(b.getStyle("radius"))}}),h=new a.Marker;h.setWidth(10),h.setHeight(12),h.setRef(0,0),h.setViewBox(-6,-4,8,10),h.addShape((new a.Path).setPathData("M-5-3l5,3,-5,3").stroke("#33ffff"));var i=/wire/.test(window.location.href),j=a.createClass("WireframeRenderer",{base:e,create:function(){var b=new a.Group,c=this.oxy=(new a.Path).stroke("#f6f").setPathData("M0,-50L0,50M-50,0L50,0"),d=this.wireframe=(new a.Rect).stroke("lightgreen"),e=this.vectorIn=(new a.Path).stroke("#66ffff"),f=this.vectorOut=(new a.Path).stroke("#66ffff");return e.setMarker(h,"end"),f.setMarker(h,"end"),b.addShapes([c,d,e,f])},shouldRender:function(){return i},update:function(a,b,c){this.wireframe.setPosition(c.x,c.y).setSize(c.width,c.height);var d=b.getVertexIn(),e=b.getVertexOut(),f=b.getLayoutVectorIn().normalize(30),g=b.getLayoutVectorOut().normalize(30);this.vectorIn.setPathData(["M",d.offset(f.reverse()),"L",d]),this.vectorOut.setPathData(["M",e,"l",g])}});d.register("OutlineModule",function(){return{events:i?{ready:function(){this.getPaper().addResource(h)},layoutallfinish:function(){this.getRoot().traverse(function(a){a.getRenderer("WireframeRenderer").update(null,a,a.getContentBox())})}}:null,renderers:{outline:f,outside:[g,j]}}})}},b[75]={value:function(){var a=b.r(38),c=b.r(53),d=(b.r(40),b.r(42),b.r(30)),e=b.r(41),f=b.r(47);e.register("PriorityModule",function(){var b=[null,["#FF1200","#840023"],["#0074FF","#01467F"],["#00AF00","#006300"],["#FF962E","#B25000"],["#A464FF","#4720C4"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"]],e="M0,13c0,3.866,3.134,7,7,7h6c3.866,0,7-3.134,7-7V7H0V13z",g="M20,10c0,3.866-3.134,7-7,7H7c-3.866,0-7-3.134-7-7V7c0-3.866,3.134-7,7-7h6c3.866,0,7,3.134,7,7V10z",h="priority",i=a.createClass("PriorityIcon",{base:a.Group,constructor:function(){this.callBase(),this.setSize(20),this.create(),this.setId(c.uuid("node_priority"))},setSize:function(a){this.width=this.height=a},create:function(){var b,c,d,f;b=(new a.Path).setPathData(g).fill("white"),c=(new a.Path).setPathData(e).setTranslate(.5,.5),d=(new a.Path).setPathData(g).setOpacity(.8).setTranslate(.5,.5),f=(new a.Text).setX(this.width/2-.5).setY(this.height/2).setTextAnchor("middle").setVerticalAlign("middle").setFontItalic(!0).setFontSize(12).fill("white"),this.addShapes([c,d,f]),this.mask=d,this.back=c,this.number=f},setValue:function(a){var c=this.back,d=this.mask,e=this.number,f=b[a];f&&(c.fill(f[1]),d.fill(f[0])),e.setContent(a)}}),j=a.createClass("SetPriorityCommand",{base:d,execute:function(a,b){for(var c=a.getSelectedNodes(),d=0;d<c.length;d++)c[d].setData(h,b||null).render();a.layout()},queryValue:function(a){for(var b,c=a.getSelectedNodes(),d=0;d<c.length&&!(b=c[d].getData(h));d++);return b||null},queryState:function(a){return a.getSelectedNodes().length?0:-1}});return{commands:{priority:j},renderers:{left:a.createClass("PriorityRenderer",{base:f,create:function(){return new i},shouldRender:function(a){return a.getData(h)},update:function(b,c,d){var e,f,g=c.getData(h),i=c.getStyle("space-left");return b.setValue(g),e=d.left-b.width-i,f=-b.height/2,b.setTranslate(e,f),new a.Box({x:e,y:f,width:b.width,height:b.height})}})}}})}},b[76]={value:function(){var a=b.r(38),c=b.r(53),d=(b.r(40),b.r(42),b.r(30)),e=b.r(41),f=b.r(47);e.register("ProgressModule",function(){var b=this,e="progress",g="#FFED83",h="#43BC00",i="M10,3c4.418,0,8,3.582,8,8h1c0-5.523-3.477-10-9-10S1,5.477,1,11h1C2,6.582,5.582,3,10,3z",j="#8E8E8E",k="M10,0C4.477,0,0,4.477,0,10c0,5.523,4.477,10,10,10s10-4.477,10-10C20,4.477,15.523,0,10,0zM10,18c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S14.418,18,10,18z",l=(new a.LinearGradient).pipe(function(a){a.setStartPosition(0,0),a.setEndPosition(0,1),a.addStop(0,"#fff"),a.addStop(1,"#ccc")}),m="M15.812,7.896l-6.75,6.75l-4.5-4.5L6.25,8.459l2.812,2.803l5.062-5.053L15.812,7.896z",n="#EEE";b.getPaper().addResource(l);var o=a.createClass("ProgressIcon",{base:a.Group,constructor:function(a){this.callBase(),this.setSize(20),this.create(),this.setValue(a),this.setId(c.uuid("node_progress")),this.translate(.5,.5)},setSize:function(a){this.width=this.height=a},create:function(){var b,c,d,e,f;b=new a.Circle(9).fill(g),c=new a.Pie(9,0).fill(h),d=(new a.Path).setPathData(i).setTranslate(-10,-10).fill(j),e=(new a.Path).setTranslate(-10,-10).setPathData(k).fill(l),f=(new a.Path).setTranslate(-10,-10).setPathData(m).fill(n),this.addShapes([b,c,d,f,e]),this.pie=c,this.check=f},setValue:function(a){this.pie.setAngle(-360*(a-1)/8),this.check.setVisible(9==a)}}),p=a.createClass("ProgressCommand",{base:d,execute:function(a,b){for(var c=a.getSelectedNodes(),d=0;d<c.length;d++)c[d].setData(e,b||null).render();a.layout()},queryValue:function(a){for(var b,c=a.getSelectedNodes(),d=0;d<c.length&&!(b=c[d].getData(e));d++);return b||null},queryState:function(a){return a.getSelectedNodes().length?0:-1}});return{commands:{progress:p},renderers:{left:a.createClass("ProgressRenderer",{base:f,create:function(){return new o},shouldRender:function(a){return a.getData(e)},update:function(b,c,d){var f,g,h=c.getData(e),i=c.getStyle("space-left");return b.setValue(h),f=d.left-b.width-i,g=-b.height/2,b.setTranslate(f+b.width/2,g+b.height/2),new a.Box(f,g,b.width,b.height)}})}}})}},b[77]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40)),d=(b.r(42),b.r(30)),e=b.r(41),f=b.r(47);e.register("Resource",function(){var b=[51,303,75,200,157,0,26,254].map(function(b){return a.Color.createHSL(b,100,85)}),e=a.Color.createHSL(0,0,95);a.extendClass(c,{getResourceColor:function(a){var c,d=this._getResourceColorIndexMapping();return d.hasOwnProperty(a)||(c=this._getNextResourceColorIndex(),d[a]=c),b[d[a]]||e},getUsedResource:function(){var a,b=this._getResourceColorIndexMapping(),c=[];for(a in b)b.hasOwnProperty(a)&&c.push(a);return c},_getNextResourceColorIndex:function(){var a,c,d,e=this._getResourceColorIndexMapping();c=[];for(a in e)e.hasOwnProperty(a)&&c.push(e[a]);for(d=0;d<b.length;d++)if(!~c.indexOf(d))return d;return-1},_getResourceColorIndexMapping:function(){return this._resourceColorMapping||(this._resourceColorMapping={})}});var g=a.createClass("ResourceCommand",{base:d,execute:function(a,b){var c=a.getSelectedNodes();"string"==typeof b&&(b=[b]),c.forEach(function(a){a.setData("resource",b).render()}),a.layout(200)},queryValue:function(a){var b=a.getSelectedNodes(),c=[];return b.forEach(function(a){var b=a.getData("resource");b&&b.forEach(function(a){~c.indexOf(a)||c.push(a)})}),c},queryState:function(a){return a.getSelectedNode()?0:-1}}),h=a.createClass("ResourceOverlay",{base:a.Group,constructor:function(){this.callBase();var b,c;c=this.rect=(new a.Rect).setRadius(4),b=this.text=(new a.Text).setFontSize(12).setVerticalAlign("middle"),this.addShapes([c,b])},setValue:function(a,b){var c,d,e,f=8,g=4;c=this.text,a==this.lastResourceName?d=this.lastBox:(c.setContent(a),d=c.getBoundaryBox(),this.lastResourceName=a,this.lastBox=d),c.setX(f).fill(b.dec("l",70)),e=this.rect,e.setPosition(0,d.y-g),this.width=Math.round(d.width+2*f),this.height=Math.round(d.height+2*g),e.setSize(this.width,this.height),e.fill(b)}}),i=a.createClass("ResourceRenderer",{base:f,create:function(){return this.overlays=[],new a.Group},shouldRender:function(a){return a.getData("resource")&&a.getData("resource").length},update:function(b,c,d){var e,f,g,i=c.getStyle("space-right"),j=this.overlays,k=c.getData("resource"),l=c.getMinder();for(g=0,e=0;e<k.length;e++)g+=i,f=j[e],f||(f=new h,j.push(f),b.addShape(f)),f.setVisible(!0),f.setValue(k[e],l.getResourceColor(k[e])),f.setTranslate(g,-1),g+=f.width;for(;f=j[e++];)f.setVisible(!1);return b.setTranslate(d.right,0),new a.Box({x:d.right,y:Math.round(-j[0].height/2),width:g,height:j[0].height})}});return{commands:{resource:g},renderers:{right:i}}})}},b[78]={value:function(){{var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30),b.r(41));b.r(47)}c.register("Select",function(){var b=this,c=b.getRenderContainer(),d=function(){var d=null,e=new a.Path,f=!1,g=10;return{selectStart:function(a){return a.originEvent.button||a.originEvent.altKey?void 0:d?this.selectEnd():void(d=a.getPosition(c).round())},selectMove:function(h){if("textedit"!=b.getStatus()&&d){var i=d,j=h.getPosition(c);if(!f){if(a.Vector.fromPoints(i,j).length()<g)return;f=!0,c.addShape(e),e.fill(b.getStyle("marquee-background")).stroke(b.getStyle("marquee-stroke")).setOpacity(.8).getDrawer().clear()}var k=new a.Box(i.x,i.y,j.x-i.x,j.y-i.y),l=[];k.left=Math.round(k.left),k.top=Math.round(k.top),k.right=Math.round(k.right),k.bottom=Math.round(k.bottom),e.getDrawer().pipe(function(){this.clear(),this.moveTo(k.left,k.top),this.lineTo(k.right,k.top),this.lineTo(k.right,k.bottom),this.lineTo(k.left,k.bottom),this.close()}),b.getRoot().traverse(function(a){var b=a.getLayoutBox();b.intersect(k).isEmpty()||l.push(a)}),b.select(l,!0),window.getSelection().removeAllRanges()}},selectEnd:function(){d&&(d=null),f&&(e.fadeOut(200,"ease",0,function(){e.remove&&e.remove()}),f=!1)}}}(),e=null,f=null;return{init:function(){window.addEventListener("mouseup",function(){d.selectEnd()})},events:{mousedown:function(a){var b=a.getTargetNode();b?a.originEvent.shiftKey?this.toggleSelect(b):b.isSelected()?this.isSingleSelect()||(e=b,f=a.getPosition()):this.select(b,!0):(this.removeAllSelectedNodes(),d.selectStart(a),this.setStatus("normal"))},mousemove:d.selectMove,mouseup:function(b){var c=b.getTargetNode();if(c&&c==e){var g=b.getPosition(),h=a.Vector.fromPoints(f,g);h.length()<1&&this.select(e,!0),e=null}d.selectEnd(b)},"normal.keydown":function(a){if(a.isShortcutKey("ctrl+a")){var b=[];this.getRoot().traverse(function(a){b.push(a)}),this.select(b,!0),a.preventDefault()}}}}})}},b[79]={value:function(){{var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41);b.r(47)}d.register("StyleModule",function(){function b(a){for(var b=a.getData(),c=0;c<d.length;c++)if(d[c]in b)return!0}var d=["font-size","font-family","font-weight","font-style","background","color"],e=null;return{commands:{copystyle:a.createClass("CopyStyleCommand",{base:c,execute:function(a){var b=a.getSelectedNode(),c=b.getData();return e={},d.forEach(function(a){a in c?e[a]=c[a]:(e[a]=null,delete e[a])}),e},queryState:function(a){var c=a.getSelectedNodes();return 1!==c.length?-1:b(c[0])?0:-1}}),pastestyle:a.createClass("PastStyleCommand",{base:c,execute:function(a){return a.getSelectedNodes().forEach(function(a){for(var b in e)e.hasOwnProperty(b)&&a.setData(b,e[b])}),a.renderNodeBatch(a.getSelectedNodes()),a.layout(300),e},queryState:function(a){return e&&a.getSelectedNodes().length?0:-1}}),clearstyle:a.createClass("ClearStyleCommand",{base:c,execute:function(a){return a.getSelectedNodes().forEach(function(a){d.forEach(function(b){a.setData(b)})}),a.renderNodeBatch(a.getSelectedNodes()),a.layout(300),e},queryState:function(a){var c=a.getSelectedNodes();if(!c.length)return-1;for(var d=0;d<c.length;d++)if(b(c[d]))return 0;return-1}})}}})}},b[80]={value:function(a,c,d){var e=b.r(38),f=b.r(53),g=(b.r(40),b.r(42)),h=b.r(30),i=b.r(41),j=b.r(47),k={"微软雅黑,Microsoft YaHei":-.15,"arial black,avant garde":-.17,"default":-.15},l=e.createClass("TextRenderer",{base:j,create:function(){return(new e.Group).setId(f.uuid("node_text"))},update:function(a,b){function c(a){return b.getData(a)||b.getStyle(a)}var d=b.getText(),f=d?d.split("\n"):[" "],g=b.getStyle("line-height"),h=c("font-size"),i=c("font-family")||"default",j=g*h*f.length-(g-1)*h,l=-j/2;if(e.Browser.ie){var m=k[i]||0;a.setTranslate(0,m*h)}var n=new e.Box,o=Math.round;this.setTextStyle(b,a);var p,q,r,s,t=f.length,u=a.getItems().length;if(u>t)for(p=t,q;q=a.getItem(p);)a.removeItem(p);else if(t>u)for(var v=t-u;v--;)r=(new e.Text).setAttr("text-rendering","inherit"),e.Browser.ie?r.setVerticalAlign("top"):r.setAttr("dominant-baseline","text-before-edge"),a.addItem(r);for(p=0,r;s=f[p],r=a.getItem(p);p++)r.setContent(s),e.Browser.ie&&r.fixPosition();this.setTextStyle(b,a);var w=b.getText()+["font-size","font-name","font-weight","font-style"].map(c).join("/");return b._currentTextHash==w&&b._currentTextGroupBox?b._currentTextGroupBox:(b._currentTextHash=w,function(){a.eachItem(function(a,b){var c=l+a*h*g;b.setY(c);var d=b.getBoundaryBox();n=n.merge(new e.Box(0,c,d.height&&d.width||1,h))});var c=new e.Box(o(n.x),o(n.y),o(n.width),o(n.height));return b._currentTextGroupBox=c,c})},setTextStyle:function(a,b){var c=l._styleHooks;c.forEach(function(c){c(a,b)})}}),m=e.createClass({base:h,execute:function(a,b){var c=a.getSelectedNode();c&&(c.setText(b),c.render(),a.layout())},queryState:function(a){return 1==a.getSelectedNodes().length?0:-1},queryValue:function(a){var b=a.getSelectedNode();return b?b.getText():null}});f.extend(l,{_styleHooks:[],registerStyleHook:function(a){l._styleHooks.push(a)}}),e.extendClass(g,{getTextGroup:function(){return this.getRenderer("TextRenderer").getRenderShape()}}),i.register("text",{commands:{text:m},renderers:{center:l}}),d.exports=l}},b[81]={value:function(){var a=b.r(38),c=(b.r(53),b.r(40),b.r(42),b.r(30)),d=b.r(41),e=(b.r(47),a.createClass("ViewDragger",{constructor:function(a){this._minder=a,this._enabled=!1,this._bind();var b=this;this._minder.getViewDragger=function(){return b},this.setEnabled(!1)},isEnabled:function(){return this._enabled},setEnabled:function(a){var b=this._minder.getPaper();b.setStyle("cursor",a?"pointer":"default"),b.setStyle("cursor",a?"-webkit-grab":"default"),this._enabled=a},move:function(a,b){var c=(this._minder,this.getMovement().offset(a));this.moveTo(c,b)},moveTo:function(b,c){if(c){var d=this;return this._moveTimeline&&this._moveTimeline.stop(),this._moveTimeline=this._minder.getRenderContainer().animate(new a.Animator(this.getMovement(),b,function(a,b){d.moveTo(b)}),c,"easeOutCubic"),this._moveTimeline.on("finish",function(){d._moveTimeline=null}),this}this._minder.getRenderContainer().setTranslate(b.round()),this._minder.fire("viewchange")},getMovement:function(){var b=this._minder.getRenderContainer().transform.translate;return b?b[0]:new a.Point},getView:function(){var b=this._minder,c=b._lastClientSize||{width:b.getRenderTarget().clientWidth,height:b.getRenderTarget().clientHeight},d=this.getMovement(),e=new a.Box(0,0,c.width,c.height),f=b.getPaper().getViewPortMatrix();return f.inverse().translate(-d.x,-d.y).transformBox(e)},_bind:function(){function b(a){if(e){e=null,a.stopPropagation(),d&&(c.setEnabled(!1),d=!1,"hand"==c._minder.getStatus()&&c._minder.rollbackStatus());var b=c._minder.getPaper();b.setStyle("cursor","hand"==c._minder.getStatus()?"-webkit-grab":"default"),c._minder.fire("viewchanged")}}var c=this,d=!1,e=null,f=null;this._minder.on("normal.mousedown normal.touchstart inputready.mousedown inputready.touchstart readonly.mousedown readonly.touchstart",function(a){2==a.originEvent.button&&a.originEvent.preventDefault(),(a.getTargetNode()==this.getRoot()||2==a.originEvent.button||a.originEvent.altKey)&&(e=a.getPosition("view"),d=!0)}).on("normal.mousemove normal.touchmove readonly.mousemove readonly.touchmove inputready.mousemove inputready.touchmove",function(b){if("touchmove"==b.type&&b.preventDefault(),d){var f=a.Vector.fromPoints(e,b.getPosition("view"));if(f.length()>10){this.setStatus("hand",!0);var g=c._minder.getPaper();g.setStyle("cursor","-webkit-grabbing")}}}).on("hand.beforemousedown hand.beforetouchstart",function(a){if(c.isEnabled()){e=a.getPosition("view"),a.stopPropagation();var b=c._minder.getPaper();b.setStyle("cursor","-webkit-grabbing")}}).on("hand.beforemousemove hand.beforetouchmove",function(b){if(e){f=b.getPosition("view");var d=a.Vector.fromPoints(e,f);c.move(d),b.stopPropagation(),b.preventDefault(),b.originEvent.preventDefault(),e=f}}).on("mouseup touchend",b),window.addEventListener("mouseup",b),this._minder.on("contextmenu",function(a){a.preventDefault()})}}));d.register("View",function(){var b=a.createClass("ToggleHandCommand",{base:c,execute:function(a){"hand"!=a.getStatus()?a.setStatus("hand",!0):a.rollbackStatus(),this.setContentChanged(!1)},queryState:function(a){return"hand"==a.getStatus()?1:0},enableReadOnly:!0}),d=a.createClass("CameraCommand",{base:c,execute:function(b,c){c=c||b.getRoot();var d=b.getPaper().getViewPort(),e=c.getRenderContainer().getRenderBox("view"),f=d.center.x-e.x-e.width/2,g=d.center.y-e.y,h=b._viewDragger,i=b.getOption("viewAnimationDuration");h.move(new a.Point(f,g),i),this.setContentChanged(!1)},enableReadOnly:!0}),f=a.createClass("MoveCommand",{base:c,execute:function(b,c){var d=b._viewDragger,e=b._lastClientSize,f=b.getOption("viewAnimationDuration");switch(c){case"up":d.move(new a.Point(0,e.height/2),f);break;case"down":d.move(new a.Point(0,-e.height/2),f);break;case"left":d.move(new a.Point(e.width/2,0),f);break;case"right":d.move(new a.Point(-e.width/2,0),f)}},enableReadOnly:!0});return{init:function(){this._viewDragger=new e(this)},commands:{hand:b,camera:d,move:f},events:{statuschange:function(a){this._viewDragger.setEnabled("hand"==a.currentStatus)},mousewheel:function(a){var b,c;if(a=a.originEvent,!a.ctrlKey&&!a.shiftKey){"wheelDeltaX"in a?(b=a.wheelDeltaX||0,c=a.wheelDeltaY||0):(b=0,c=a.wheelDelta),this._viewDragger.move({x:b/2.5,y:c/2.5});var d=this;clearTimeout(this._mousewheeltimer),this._mousewheeltimer=setTimeout(function(){d.fire("viewchanged")},100),a.preventDefault()}},"normal.dblclick readonly.dblclick":function(b){b.kityEvent.targetShape instanceof a.Paper&&this.execCommand("camera",this.getRoot(),800)},paperrender:function(){this.execCommand("camera",null,0),this._lastClientSize={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight}},resize:function(){var b={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight},c=this._lastClientSize;this._viewDragger.move(new a.Point((b.width-c.width)/2|0,(b.height-c.height)/2|0)),this._lastClientSize=b},"selectionchange layoutallfinish":function(){var b=this.getSelectedNode();if(b){var c=this._viewDragger,d=c.getView(),e=b.getLayoutBox(),f=150,g=150,h=0,i=0;e.right>d.right-g?h+=d.right-e.right-f:e.left<d.left+g&&(h+=d.left-e.left+f),e.bottom>d.bottom-g&&(i+=d.bottom-e.bottom-f),e.top<d.top+g&&(i+=d.top-e.top+f),(h||i)&&c.move(new a.Point(h,i))}}}}})}},b[82]={value:function(){{var a=b.r(38),c=(b.r(53),b.r(40)),d=(b.r(42),b.r(30)),e=b.r(41);b.r(47)}e.register("Zoom",function(){function b(){var a=h._zoomValue>=100?"optimize-speed":"geometricPrecision";h.getRenderContainer().setAttr("text-rendering",a)}function e(b){var c=b.shapeNode,d=c.getCTM(),e=new a.Matrix(d.a,d.b,d.c,d.d,(0|d.e)+.5,(0|d.f)+.5);c.setAttribute("transform","matrix("+e.toString()+")")}function f(c,d){{var e=c.getPaper();e.getViewPort()}if(d){b();var f=c.getOption("zoomAnimationDuration");if(c.getRoot().getComplex()>200||!f)c._zoomValue=d,c.zoom(d),c.fire("viewchange");else{var h=new a.Animator({beginValue:c._zoomValue,finishValue:d,setter:function(a,b){a.zoom(b)}});c._zoomValue=d,g&&g.pause(),g=h.start(c,f,"easeInOutSine"),g.on("finish",function(){c.fire("viewchange")})}c.fire("zoom",{zoom:d})}}var g,h=this;a.extendClass(c,{zoom:function(a){var b=this.getPaper(),c=b.getViewPort();c.zoom=a/100,c.center={x:c.center.x,y:c.center.y},b.setViewPort(c),100==a&&e(b)},getZoomValue:function(){return this._zoomValue}});var i=a.createClass("Zoom",{base:d,execute:f,queryValue:function(a){return a._zoomValue}}),j=a.createClass("ZoomInCommand",{base:d,execute:function(a){f(a,this.nextValue(a))},queryState:function(a){return+!this.nextValue(a)},nextValue:function(a){var b,c=a.getOption("zoom");for(b=0;b<c.length;b++)if(c[b]>a._zoomValue)return c[b];return 0},enableReadOnly:!0}),k=a.createClass("ZoomOutCommand",{base:d,execute:function(a){f(a,this.nextValue(a))},queryState:function(a){return+!this.nextValue(a)},nextValue:function(a){var b,c=a.getOption("zoom");for(b=c.length-1;b>=0;b--)if(c[b]<a._zoomValue)return c[b];return 0},enableReadOnly:!0});return{init:function(){this._zoomValue=100,this.setDefaultOptions({zoom:[10,20,50,100,200]}),b()},commands:{zoomin:j,zoomout:k,zoom:i},events:{"normal.mousewheel readonly.mousewheel":function(b){if(b.originEvent.ctrlKey||b.originEvent.metaKey){var c=b.originEvent.wheelDelta,d=this;a.Browser.mac||(c=-c),Math.abs(c)>100&&(clearTimeout(this._wheelZoomTimeout),this._wheelZoomTimeout=setTimeout(function(){d.getPaper()._zoom||1;0>c?d.execCommand("zoom-in"):c>0&&d.execCommand("zoom-out")},100),b.originEvent.preventDefault())}}},commandShortcutKeys:{zoomin:"ctrl+=",zoomout:"ctrl+-"}}})}},b[83]={value:function(a,c,d){var e=b.r(33);e.registerProtocol("json",d.exports={fileDescription:"KityMinder 格式",fileExtension:".km",dataType:"json",mineType:"application/json",encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}})}},b[84]={value:function(a,c,d){function e(a){return f(a,1).join("\n")}function f(a,b){var c=[];b=b||1;var d=g(b);c.push(d+" "+a.data.text),c.push(o);var e=a.data.note;if(e){var h=/^#/.test(e);h&&(c.push(p),e=e.replace(/^#+/gm,function(a){return d+a})),c.push(e),h&&c.push(q),c.push(o)}return a.children&&a.children.forEach(function(a){c=c.concat(f(a,b+1))}),c}function g(a){for(var b="";a--;)b+="#";return b}function h(a){var b,c,d,e,f,g,h,m={};a=a.replace(/^(.+)\n={3,}/,function(a,b){return"# "+b}),b=a.split(n);for(var o=0;o<b.length;o++)c=b[o],d=k(c),d.noteClose?g=!1:d.noteStart?g=!0:(h=d.codeBlock?!h:h,g||h||!d.level||d.level>e+1?f&&j(f,c):(e=d.level,f=i(d.content,m[e-1]),m[e]=f));return l(m[1]),m[1]}function i(a,b){var c={data:{text:a,note:""}};return b&&(b.children?b.children.push(c):b.children=[c]),c}function j(a,b){a.data.note+=b+"\n"}function k(a){var b=/^(#+)?\s*(.*)$/.exec(a);return{level:b[1]&&b[1].length||null,content:b[2],noteStart:a==p,noteClose:a==q,codeBlock:/^\s*```/.test(a)}}function l(a){if(/\S/.test(a.data.note)){for(var b=a.data.note.split("\n");b.length&&!/\S/.test(b[0]);)b.shift();for(;b.length&&!/\S/.test(b[b.length-1]);)b.pop();a.data.note=b.join("\n")}else a.data.note=null,delete a.data.note;a.children&&a.children.forEach(l)}var m=b.r(33),n=/\r\n|\r|\n/,o="",p="<!--Note-->",q="<!--/Note-->";m.registerProtocol("markdown",d.exports={fileDescription:"Markdown/GFM 格式",fileExtension:".md",mineType:"text/markdown",dataType:"markdown",encode:function(a){return e(a)},decode:function(a){return h(a)}})}},b[85]={value:function(a,c,d){function e(a){return new j(function(b,c){var d=document.createElement("img");d.onload=function(){b(this)},d.onerror=function(a){c(a)},d.crossOrigin="",d.src=a})}function f(a){var b,c,d,e,f,g,h=a.getPaper(),i=(h.container,a.getRenderContainer()),j=i.getRenderBox(),l=j.width+1,m=j.height+1;return b=h.shapeNode.getAttribute("transform"),h.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),i.translate(-j.x,-j.y),c=h.container.innerHTML,i.translate(j.x,j.y),h.shapeNode.setAttribute("transform",b),d=document.createElement("div"),d.innerHTML=c,e=d.querySelector("svg"),e.setAttribute("width",j.width+1),e.setAttribute("height",j.height+1),e.setAttribute("style",'font-family: Arial, "Microsoft Yahei","Heiti SC";'),d=document.createElement("div"),d.appendChild(e),c=d.innerHTML,c=c.replace(' xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:ns1:xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:NS2="" NS2:xmlns:ns1=""',""),c=c.replace(/&nbsp;/g,"&#xa0;"),f=new Blob([c],{type:"image/svg+xml"}),g=k.createObjectURL(f),{width:l,height:m,dataUrl:g,xml:c}}function g(a,b){function c(a,b){a.save(),a.fillStyle=b,a.fillRect(0,0,j.width,j.height),a.restore()}function d(a,b,c,d){a.drawImage(b,c,d)}function g(a){return a.toDataURL("png")}function i(){return e(s).then(function(a){return d(l,a,t,t),k.revokeObjectURL(s),g(j)})}var j=document.createElement("canvas"),l=j.getContext("2d"),m=b.getStyle("background").toString(),n=/url\((.+)\)/.exec(m),o=h.Color.parse(m),p=f(b),q=p.width,r=p.height,s=p.dataUrl,t=20;return j.width=q+2*t,j.height=r+2*t,n?e(n[1]).then(function(a){return c(l,l.createPattern(a,"repeat")),i()}):(c(l,o.toString()),i())}var h=b.r(38),i=b.r(33),j=b.r(45),k=window.URL||window.webkitURL||window;i.registerProtocol("png",d.exports={fileDescription:"PNG 图片",fileExtension:".png",mineType:"image/png",dataType:"png",encode:g})}},b[86]={value:function(a,c,d){var e=b.r(33);e.registerProtocol("svg",d.exports={fileDescription:"SVG 矢量图",fileExtension:".svg",mineType:"image/svg+xml",dataType:"svg",encode:function(a,b){var c,d,e,f=b.getPaper(),g=f.shapeNode.getAttribute("transform"),h=b.getRenderContainer(),i=h.getRenderBox(),j=(h.getTransform(),i.width),k=i.height,l=20;return f.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),c=f.container.innerHTML,f.shapeNode.setAttribute("transform",g),d=document.createElement("div"),d.innerHTML=c,e=d.querySelector("svg"),e.setAttribute("width",j+2*l|0),e.setAttribute("height",k+2*l|0),e.setAttribute("style",'font-family: Arial, "Microsoft Yahei",  "Heiti SC"; background: '+b.getStyle("background")),e.setAttribute("viewBox",[i.x-l|0,i.y-l|0,j+2*l|0,k+2*l|0].join(" ")),d=document.createElement("div"),d.appendChild(e),c=d.innerHTML,c=c.replace(/&nbsp;/g,"&#xa0;")}})}},b[87]={value:function(a,c,d){function e(a,b){for(var c="";b--;)c+=a;return c}function f(a,b){var c="";return b=b||0,c+=e(n,b),c+=a.data.text+l,a.children&&a.children.forEach(function(a){c+=f(a,b+1)}),c}function g(a){return!/\S/.test(a)}function h(a){for(var b=0;a.charAt(b)===n;)b++;return b}function i(a){return{data:{text:a.replace(new RegExp("^"+n+"*"),"")}}}function j(a){function b(a,b){var c=a.children||(a.children=[]);c.push(b)}for(var c,d,e,f,j={},k=a.split(m),l=0;l<k.length;l++)if(d=k[l],!g(d)){if(e=h(d),f=i(d),0===e){if(c)throw new Error("Invalid local format");c=f}else{if(!j[e-1])throw new Error("Invalid local format");b(j[e-1],f)}j[e]=f}return c}var k=b.r(33),l="\r",m=/\r\n|\r|\n/,n="	";k.registerProtocol("text",d.exports={fileDescription:"大纲文本",fileExtension:".txt",dataType:"text",mineType:"text/plain",encode:function(a){return f(a,0)},decode:function(a){return j(a)}})}},b[88]={value:function(){var a=b.r(51);a.register("default",{getLayout:function(a){if(a.getData("layout"))return a.getData("layout");var b=a.getLevel();return 0===b?"mind":1===b?a.getLayoutPointPreview().x>0?"right":"left":a.parent.getLayout()},getConnect:function(a){return 1==a.getLevel()?"arc":"under"}})}},b[89]={value:function(){var a=b.r(51);a.register("filetree",{getLayout:function(a){return a.getData("layout")?a.getData("layout"):a.isRoot()?"bottom":"filetree-down"},getConnect:function(a){return 1==a.getLevel()?"poly":"l"}})}},b[90]={value:function(){var a=b.r(51);a.register("fish-bone",{getLayout:function(a){if(a.getData("layout"))return a.getData("layout");var b=a.getLevel();return 0===b?"fish-bone-master":1===b?"fish-bone-slave":a.getLayoutPointPreview().y>0?"filetree-up":"filetree-down"},getConnect:function(a){switch(a.getLevel()){case 1:return"fish-bone-master";case 2:return"line";default:return"l"}}})}},b[91]={value:function(){var a=b.r(51);a.register("right",{getLayout:function(a){return a.getData("layout")||"right"},getConnect:function(a){return 1==a.getLevel()?"arc":"bezier"}})}},b[92]={value:function(){var a=b.r(51);a.register("structure",{getLayout:function(a){return a.getData("layout")||"bottom"},getConnect:function(){return"poly"}})}},b[93]={value:function(){var a=b.r(52);["classic","classic-compact"].forEach(function(b){var c="classic-compact"==b;a.register(b,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":c?[10,25]:[15,25],"root-margin":c?[15,25]:[30,100],"root-radius":30,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":c?[5,15]:[6,20],"main-margin":c?[5,10]:20,"main-radius":10,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"white","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":[5,10],"sub-margin":c?[5,10]:[15,20],"sub-tree-margin":30,"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})})}},b[94]={value:function(){var a=b.r(52);a.register("fish",{background:"#3A4144 url(ui/theme/default/images/grid.png) repeat","root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":[35,35],"root-margin":30,"root-radius":100,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":[6,20],"main-margin":[20,20],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":[10],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":3,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)",
"selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}},b[95]={value:function(){function a(a,b,c){return e.Color.createHSL(a,b,c)}function c(b,c){return{background:"#fbfbfb","root-color":"white","root-background":a(b,37,60),"root-stroke":a(b,37,60),"root-font-size":16,"root-padding":c?[6,12]:[12,24],"root-margin":c?10:[30,100],"root-radius":5,"root-space":10,"main-color":"black","main-background":a(b,33,95),"main-stroke":a(b,37,60),"main-stroke-width":1,"main-font-size":14,"main-padding":[6,20],"main-margin":c?8:20,"main-radius":3,"main-space":5,"sub-color":"black","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":c?[3,5]:[5,10],"sub-margin":c?[4,8]:[15,20],"sub-radius":5,"sub-space":5,"connect-color":a(b,37,60),"connect-width":1,"connect-radius":5,"selected-stroke":a(b,26,30),"selected-stroke-width":"3","blur-selected-stroke":a(b,10,60),"marquee-background":a(b,100,80).set("a",.1),"marquee-stroke":a(b,37,60),"drop-hint-color":a(b,26,35),"drop-hint-width":5,"order-hint-area-color":a(b,100,30).set("a",.5),"order-hint-path-color":a(b,100,25),"order-hint-path-width":1,"text-selection-color":a(b,100,20),"line-height":1.5}}var d,e=b.r(38),f=b.r(52),g={red:0,soil:25,green:122,blue:204,purple:246,pink:334};for(d in g)f.register("fresh-"+d,c(g[d])),f.register("fresh-"+d+"-compat",c(g[d],!0))}},b[96]={value:function(){var a=b.r(52);["snow","snow-compact"].forEach(function(b){var c="snow-compact"==b;a.register(b,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":c?[5,10]:[15,25],"root-margin":c?15:30,"root-radius":5,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":c?[4,10]:[6,20],"main-margin":c?[5,10]:[20,40],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":c?[5,10]:[10,20],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})})}},b[97]={value:function(){var a=b.r(52);a.register("wire",{background:"black",color:"#999",stroke:"none",padding:10,margin:20,"font-size":14,"connect-color":"#999","connect-width":1,"selected-background":"#999","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}};var c={"expose-editor":1};a("expose-editor")}();
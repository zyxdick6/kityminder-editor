/*!
 * ====================================================
 * km-editor - v0.0.1 - 2015-05-19
 * https://github.com/fex-team/kityminder-editor
 * GitHub: https://github.com/fex-team/kityminder-editor 
 * Copyright (c) 2015 ; Licensed 
 * ====================================================
 */

!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(a,c,d){function e(a){g.push(a)}function f(a,b){this.selector=a,this.option=b;for(var c=0;c<g.length;c++)"function"==typeof g[c]&&g[c].call(this,this)}var g=[];return f.assemble=e,e(b.r(5)),e(b.r(10)),e(b.r(6)),e(b.r(12)),e(b.r(7)),e(b.r(11)),e(b.r(9)),e(b.r(13)),d.exports=f}},b[1]={value:function(a,c,d){var e=window.kityminder=b.r(60);return d.exports=e.Editor=b.r(0)}},b[2]={value:function(a,c,d){var e=b.r(20);return d.exports=e}},b[3]={value:function(a,b,c){}},b[4]={value:function(a,c,d){return d.exports=b.r(60).Minder}},b[5]={value:function(a,b,c){function d(){var a=document.querySelector(this.selector);if(!a)throw new Error("Invalid selector: "+this.selector);a.classList.add("km-editor"),this.container=a}return c.exports=d}},b[6]={value:function(a,c,d){function e(a,b,c,d){if(a.when!=b)return!1;if("*"!=a.enter&&a.enter!=d)return!1;if("*"==a.exit||a.exit==c)return!0}function f(a,b){var c=a,d=a,f=" - ",g=" -> ",h=[];this.jump=function(a,f){if(!f)throw new Error("Please tell fsm the reason to jump");var g,j,k=c,l=[k,a].concat([].slice.call(arguments,1));for(g=0;g<h.length;g++)if(j=h[g],e(j.condition,"before",k,a)&&j.apply(null,l))return;for(d=c,c=a,b.setStatus(c),i.log("[{0}] {1} -> {2}",f,k,a),g=0;g<h.length;g++)j=h[g],e(j.condition,"after",k,a)&&j.apply(null,l);return c},this.state=function(){return c=b.getStatus()},this.preState=function(){return d},this.when=function(a,b){1==arguments.length&&(b=a,a="* -> *");var c,d,e,i;if(d=a.split(f),2==d.length?c="before":(d=a.split(g),2==d.length&&(c="after")),!c)throw new Error("Illegal fsm condition: "+a);e=d[0],i=d[1],b.condition={when:c,exit:e,enter:i},h.push(b)}}function g(){this.fsm=new f("normal",this.minder)}var h=b.r(14),i=new h("fsm");return d.exports=g}},b[7]={value:function(a,c,d){function e(){var a=this.fsm,b=this.minder,c=(this.receiver,this.container),d=new f(c);a.when("normal -> hotbox",function(a,c,e){var f,g=b.getSelectedNode();if(g){var h=g.getRenderBox();f={x:h.cx,y:h.cy}}d.active("main",f),b.setStatus("hotbox")}),a.when("inputready -> hotbox",function(a,c,e){var f,g=b.getSelectedNode();if(g){var h=g.getRenderBox();f={x:h.cx,y:h.cy}}d.active("main",f),b.setStatus("hotbox")}),a.when("normal -> normal",function(a,c,e,f){if("shortcut-handle"==e){var g=d.dispatch(f);g?f.preventDefault():b.dispatchKeyEvent(f)}}),this.hotbox=d}var f=b.r(2);return d.exports=e}},b[8]={value:function(a,c,d){function e(){function a(){j.when("* -> input",e),j.when("input -> *",function(a,b,c){switch(c){case"input-commit":return f();case"input-cancel":return h()}}),k.on("beforemousedown",function(){"input"==j.state()&&j.jump("normal","input-commit")})}function b(){g.flaged&&n.classList.add("debug"),n.onmousedown=function(a){a.stopPropagation()},k.on("layoutallfinish viewchange viewchanged selectionchange",function(a){("viewchange"!=a.type||"input"==j.state())&&i()}),i()}function c(){l.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return-1!=k.queryCommandState("text")},action:d})}function d(){n.innerText=k.queryCommandValue("text"),j.jump("input","input-request"),m.selectAll()}function e(){var a=k.getSelectedNode();if(a){var b=a.getData("font-size")||a.getStyle("font-size");n.style.fontSize=b+"px",n.style.minWidth=0,n.style.minWidth=n.clientWidth+"px",n.classList.add("input"),n.focus()}}function f(){var a=n.innerText;k.execCommand("text",a.replace(/^\n*|\n*$/g,"")),h()}function h(){n.classList.remove("input"),m.selectAll()}function i(){var a=i,b=k.getSelectedNode();b&&(a.timer||(a.timer=setTimeout(function(){var c=b.getRenderBox("TextRenderer");n.style.left=Math.round(c.x)+"px",n.style.top=Math.round(g.flaged?c.bottom+30:c.y)+"px",n.focus(),a.timer=0})))}var j=this.fsm,k=this.minder,l=this.hotbox,m=this.receiver,n=m.element;b(),a(),c(),this.editText=d}b.r(17);var f=b.r(14),g=new f("input");return d.exports=e}},b[9]={value:function(a,c,d){function e(){var a=this.fsm,b=this.minder,c=this.receiver,d=this.container,e=(c.element,this.hotbox);c.listen("normal",function(b){return"keydown"==b.type&&b.is("Space")?(b.preventDefault(),a.jump("hotbox","space-trigger")):void 0}),c.listen("inputready",function(b){return"keydown"==b.type&&b.is("Space")?(b.preventDefault(),a.jump("hotbox","space-trigger")):void 0}),c.listen("hotbox",function(b){b.preventDefault();var c=e.dispatch(b);return"back"==c&&e.state()==f.STATE_IDLE?a.jump("normal","hotbox-idle"):void 0});var g,h,i=2;d.addEventListener("mousedown",function(b){"hotbox"==a.state()?(e.active(f.STATE_IDLE),a.jump("normal","blur")):("normal"==a.state()||"inputready"==a.state())&&(b.button==i&&(g=b.clientX,h=b.clientY),e.state()!=f.STATE_IDLE&&(e.active(f.STATE_IDLE),a.jump("normal","blur")))},!1),d.addEventListener("mouseup",function(c){("normal"==a.state()||"inputready"==a.state())&&c.button==i&&c.clientX==g&&c.clientY==h&&b.getSelectedNode()&&a.jump("hotbox","content-menu")},!1),e.$element.addEventListener("mousedown",function(a){a.stopPropagation()}),e.$element.addEventListener("contextmenu",function(a){a.preventDefault()})}var f=b.r(2);return d.exports=e}},b[10]={value:function(a,c,d){function e(){var a={minder:{enableKeyReceiver:!1,enableAnimation:!0}},b=$.extend(!0,a,this.option.minder),c=new f(b);c.renderTo(this.selector),c.setTheme(null),c.setTemplate(b.defaultTemplate),c.select(c.getRoot(),!0),c.execCommand("text",this.option.defaultText||"中心主题"),this.minder=c}var f=b.r(4);return d.exports=e}},b[11]={value:function(a,c,d){function e(){function a(b,c){if(b.hasOwnProperty("addBtn")){var d=b.addBtn;for(var e in d){var f=d[e].button;if(c.hasOwnProperty(e)||(c[e]={button:[]}),c[e].button=c[e].button.concat(f),d[e].hasOwnProperty("subMenu")){var h=d[e].subMenu;for(var i in h)c[e].subMenu.hasOwnProperty(i)||(c[e].subMenu[i]={}),a(h[i],c[e].subMenu[i])}}}b.hasOwnProperty("showBtn")&&(g=b.showBtn||g)}function b(a,f){var h=d.state(f);for(var i in a)if(a[i].button.forEach(function(a){var b=a.split(":"),d=b.shift(),j=!0;if(-1==g.indexOf(d)&&"main"==f&&(j=!1),j){var k=b.shift(),l=b.shift().split("|"),m={position:i,label:d,enable:function(){return-1!=c.queryCommandState(l[0])}};""!=k&&(m.key=k),l.length>1?"next"==l[0]?m.next=l[1]:m.action=function(){c.execCommand(l[0],l[1]),e.jump(e.preState(),"command-executed")}:m.action=function(){c.execCommand(l[0]),e.jump(e.preState(),"command-executed")},h.button(m)}}),a[i].hasOwnProperty("subMenu")){var j=a[i].subMenu;for(var k in j)b(j[k],k)}}var c=this.minder,d=this.hotbox,e=this.fsm,f={center:{button:["编辑:F2:Editnode"]},ring:{button:["前移:Alt+Up:ArrangeUp","下级:Tab:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","归纳:Shift+Tab|Shift+Insert:AppendParentNode","整理:Ctrl+R:ResetLayout"]},top:{button:["超链接:H:input|hyperLink","图片:I:input|image","备注:N:input|note","优先级:P:next|priority","进度:G:next|progress","资源:R:input|resource"],subMenu:{priority:{ring:{button:["1级:1:priority|1","2级:2:priority|2","3级:3:priority|3","4级:4:priority|4","5级:5:priority|5","6级:6:priority|6","7级:7:priority|7","8级:8:priority|8","9级:9:priority|9"]},center:{button:["移除:Del:priority"]},top:{button:["返回:Esc:next|back"]}},progress:{ring:{button:["未开始:0:progress|1","1/8:1:progress|2","2/8:2:progress|3","3/8:3:progress|4","4/8:4:progress|5","5/8:5:progress|6","6/8:6:progress|7","7/8:7:progress|8","8/8:8:progress|9"]},center:{button:["移除:Del:progress"]},top:{button:["返回:Esc:next|back"]}}}},bottom:{button:["模板:T:next|theme","布局:L:next|template","样式:S:next|style","展开:/:Expand","放大:+|=:zoomin","缩小:-:zoomout"],subMenu:{theme:{bottom:{button:["紧凑经典::theme|classic-compact","紧凑天盘::theme|tianpan-compact","紧凑冷光::theme|snow-compact","紧凑蓝::theme|fresh-blue-compat","紧凑绿::theme|fresh-green-compat","紧凑粉::theme|fresh-pink-compat","紧凑紫::theme|fresh-purple-compat","紧凑红::theme|fresh-red-compat","紧凑黄::theme|fresh-soil-compat","线框::theme|wire"]},center:{button:["返回:Esc:next|back"]},top:{button:["脑图经典::theme|classic","经典天盘::theme|tianpan","温柔冷光::theme|snow","天空蓝::theme|fresh-blue","文艺绿::theme|fresh-green","脑残粉::theme|fresh-pink","浪漫紫::theme|fresh-purple","清新红::theme|fresh-red","泥土黄::theme|fresh-soil","鱼骨图::theme|fish"]}},template:{top:{button:["思维导图:S:template|default","组织结构图:O:template|structure","目录组织图:M:template|filetree"]},center:{button:["返回:Esc:next|back"]},bottom:{button:["逻辑结构图:L:template|right","鱼骨图:F:template|fish-bone","天盘图:T:template|tianpan"]}}}}},g="前移|下级|同级|后移|删除|归纳|整理";a(this.option.hotbox,f),b(f,"main")}var f=b.r(14);new f("node"),new f("hotbox");return d.exports=e}},b[12]={value:function(a,c,d){function e(){function a(a){a.is=function(a){for(var b=a.split("|"),c=0;c<b.length;c++)if(f.is(this,b[c]))return!0;return!1};for(var c,d=0;d<g.length;d++)if(c=g[d],("*"==c.notifyState||c.notifyState==b.state())&&c.call(null,a))return}var b=this.fsm,c=this.minder,d=$(".km_receiver")[0];d.contentEditable=!0,d.onkeydown=d.onkeypress=d.onkeyup=a;var e={element:d,selectAll:function(){d.innerHTML||(d.innerHTML="&nbsp;");var a=document.createRange(),b=window.getSelection();a.selectNodeContents(d),b.removeAllRanges(),b.addRange(a),d.focus()}};e.selectAll(),c.on("beforemousedown",e.selectAll);var g=[];e.listen=function(a,b){1==arguments.length&&(b=a,a="*"),b.notifyState=a,g.push(b)},this.receiver=e}var f=b.r(18);return d.exports=e}},b[13]={value:function(a,c,d){function e(){var a=b.r(16);this.tools=a}return d.exports=e}},b[14]={value:function(a,c,d){function e(){}function f(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b}function g(a){var b=this.flaged=-1!=window.location.search.indexOf(a);if(b){var c=f(a)%360,d=h("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",c),g="background: none; color: black;";this.log=function(){var b=h.apply(null,arguments);console.log(h("%c{0}%c{1}",a,b),d,g)}}else this.log=e}var h=b.r(15);return d.exports=g}},b[15]={value:function(a,b,c){function d(a,b){return"object"!=typeof b&&(b=[].slice.call(arguments,1)),String(a).replace(/\{(\w+)\}/gi,function(a,c){return b[c]||c})}return c.exports=d}},b[16]={value:function(a,b,c){var d={createViewNavigator:function(){function a(){f.on("layout layoutallfinish",d),f.on("viewchange",e)}function b(){f.off("layout layoutallfinish",d),f.off("viewchange",e)}function c(){function a(a,b){var c=m;a.x=-a.x,a.y=-a.y;var d=f.getPaper().getViewPortMatrix();c=d.transformBox(c);var e=a.offset(c.width/2,c.height/2);f.getViewDragger().moveTo(e,b)}var b=!1;h.on("mousedown",function(c){b=!0,a(c.getPosition("top"),200),g.addClass("grab")}),h.on("mousemove",function(c){b&&a(c.getPosition("top"))}),$(window).on("mouseup",function(){b=!1,g.removeClass("grab")})}function d(){var a=f.getRenderContainer().getBoundaryBox();l=a;var b=30;h.setViewBox(a.x-b-.5,a.y-b-.5,a.width+2*b+1,a.height+2*b+1);var c=[],d=[];f.getRoot().traverse(function(a){var b=a.getLayoutBox();c.push("M",b.x,b.y,"h",b.width,"v",b.height,"h",-b.width,"z"),a.getConnection()&&a.parent&&a.parent.isExpanded()&&d.push(a.getConnection().getPathData())}),h.setStyle("background",f.getStyle("background")),c.length?i.fill(f.getStyle("root-background")).setPathData(c):i.setPathData(null),d.length?j.stroke(f.getStyle("connect-color"),"0.5%").setPathData(d):j.setPathData(null),e()}function e(){m=f.getViewDragger().getView(),k.setBox(m.intersect(l))}var f=editor.minder,g=$("<div>").addClass("preview-navigator").appendTo("#minder-editor"),h=new kity.Paper(g[0]),i=h.put(new kity.Path),j=h.put(new kity.Path),k=h.put(new kity.Rect(100,100).stroke("red","1%")),l=new kity.Box,m=new kity.Box;return c(),g.show=function(){$.fn.show.call(this),a(),d(),e()},g.hide=function(){$.fn.hide.call(this),b()},window.u=d,g}};return c.exports=d}},b[17]={value:function(a,b,c){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var a,b,c=window.getSelection(),d=[];for(b=0;b<c.rangeCount;b++)d[b]=c.getRangeAt(b);for(c.removeAllRanges(),c.selectAllChildren(this),a=c.toString(),c.removeAllRanges(),b=0;b<d.length;b++)c.addRange(d[b]);return a}),HTMLElement.prototype.__defineSetter__("innerText",function(a){this.innerHTML=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},b[18]={value:function(a,c,d){return d.exports=b.r(21)}},b[19]={value:function(a,c,d){d.exports=window.HotBox=b.r(20)}},b[20]={value:function(a,c,d){function e(a){return document.createElement(a)}function f(a,b){a.classList.add(b)}function g(a,b){a.classList.remove(b)}function h(a,b){a.appendChild(b)}function i(a,b){return"object"!=typeof b&&(b=[].slice.apply(arguments,1)),String(a).replace(/\{(\w+)\}/g,function(a,c){return b[c]||a})}function j(a){function b(a){return j?void j.active():(a=a||m,j=new a(t),j.active(),i.onmousedown=function(a){a.stopPropagation(),a.preventDefault()},t)}function c(b){var c=b.type.toLowerCase();if(b.keyHash=l.hash(b),b.isKey=function(a){if(!a)return!1;for(var c=a.split(/\s*\|\s*/);c.length;)if(b.keyHash==l.hash(c.shift()))return!0;return!1},b[c]=!0,b.keydown&&t.activeKey&&b.isKey(t.activeKey)&&r==n&&q)return void g("main",{x:a.clientWidth/2,y:a.clientHeight/2});var d=r==n?q:r;if(d){var e=d.handleKeyEvent(b);return"function"==typeof t.onkeyevent&&(b.handleResult=e,t.onkeyevent(b,e)),e}return null}function d(a){if(!a)return r;if(a==n)throw new Error("Can not define or use the `idle` state.");return p[a]=p[a]||new k(this,a),"main"==a&&(q=p[a]),p[a]}function g(a,b){if(a==n)r!=n&&(s.shift().deactive(),s=[]),r=n;else if("back"==a)r!=n&&(r.deactive(),s.shift(),r=s[0],r?r.active(this.prePosition):r="idle");else{r!=n&&r.deactive();var c=p[a];s.unshift(c),"function"==typeof t.position&&(b=t.position(b)),b=b||this.prePosition,this.prePosition=b,c.active(b),r=c}}if("string"==typeof a&&(a=document.querySelector(a)),!(a&&a instanceof HTMLElement))throw new Error("No container or not invalid container for hot box");var i=e(o);f(i,"hotbox"),h(a,i),this.$element=i,this.$container=a;var j,p={},q=null,r=n,s=[],t=this;this.control=b,this.state=d,this.active=g,this.dispatch=c,this.activeKey="space",this.actionKey="space",this.prePosition=!1,this.states=p}function k(a,b){function c(){function a(){return B.ring.length>0?15*B.ring.length:B.center?45:0==B.top.length||0==B.bottom.length?0:15}function b(a){var b=B.ring,c=2*Math.PI/b.length;B.center&&(B.center.indexedPosition=[0,0]),b.length>0?(y.style.marginLeft=y.style.marginTop=-a+"px",y.style.width=y.style.height=a+a+"px"):y.style.display="none";for(var d,e,f,g,h=0;h<b.length;h++)d=b[h].$button,e=c*h-Math.PI/2,f=a*Math.cos(e),g=a*Math.sin(e),b[h].indexedPosition=[f,g],d.style.left=f+"px",d.style.top=g+"px"}function c(a){var b=-z.clientWidth/2,c=2*-a-z.clientHeight/2;z.style.marginLeft=b+"px",z.style.marginTop=c+"px",B.top.forEach(function(a){var d=a.$button;a.indexedPosition=[b+d.offsetLeft+d.clientWidth/2,c]})}function d(a){var b=-A.clientWidth/2,c=2*a-A.clientHeight/2;A.style.marginLeft=b+"px",A.style.marginTop=c+"px",B.bottom.forEach(function(a){var d=a.$button;a.indexedPosition=[b+d.offsetLeft+d.clientWidth/2,c]})}function e(){function a(a){var c,d,e,f,g,h,i={},j=0,k={},l=a.indexedPosition,m=Math.abs;b.forEach(function(b){if(a!=b)for(c=b.indexedPosition,g=[],d=c[0]-l[0],e=c[1]-l[1],f=Math.sqrt(d*d+e*e),m(d)>2&&(g.push(d>0?"right":"left"),g.push(f+m(e))),m(e)>2&&(g.push(e>0?"down":"up"),g.push(f+m(d)));g.length;)h=g.shift(),j=g.shift(),(!i[h]||j<k[h])&&(i[h]=b,k[h]=j)}),a.neighbor=i}var b=C.filter(function(a){return a.indexedPosition});b.forEach(a)}var f=a();b(f),c(f),d(f),e(),G=!1}function d(){return!0}function j(a){var b=e(o);f(b,"button");var c=a.render||k;switch(b.innerHTML=c(i,a),a.position){case"center":h(w,b);break;case"ring":h(x,b);break;case"top":h(z,b);break;case"bottom":h(A,b)}return{action:a.action,enable:a.enable||d,key:a.key,next:a.next,label:a.label,data:a.data||null,$button:b}}function k(a,b){var c;return c=b.key?'<span class="label">{label}</span><span class="key">{key}</span>':'<span class="label">{label}</span>',a(c,{label:b.label,key:b.key&&b.key.split("|")[0]})}function l(b){b=b||{x:a.$container.clientWidth/2,y:a.$container.clientHeight/2},b&&(v.style.left=b.x+"px",v.style.top=b.y+"px"),C.forEach(function(a){var b=a.$button;b&&b.classList[a.enable()?"add":"remove"]("enabled")}),f(v,u),G&&c(),D||q(B.center||B.ring[0]||B.top[0]||B.bottom[0]),F=!0}function m(){g(v,u),q(null),F=!1}function p(a){E&&E.$button&&g(E.$button,t),E=a,E&&E.$button&&f(E.$button,t)}function q(a){D&&D.$button&&D.$button&&g(D.$button,s),D=a,D&&D.$button&&f(D.$button,s)}function r(b){b&&((!b.enable||b.enable())&&(b.action&&b.action(b),a.active(b.next||n)),p(null),q(null))}var s="selected",t="pressed",u="active",v=e(o),w=e(o),x=e(o),y=e("div"),z=e(o),A=e(o);f(v,"state"),f(v,b),f(w,"center"),f(x,"ring"),f(y,"ring-shape"),f(z,"top"),f(A,"bottom"),h(a.$element,v),h(v,y),h(v,w),h(v,x),h(v,z),h(v,A),this.name=b;var B={center:null,ring:[],top:[],bottom:[],behind:[]},C=[],D=null,E=null,F=!1,G=!0;this.button=function(a){var b=j(a);"center"==a.position?B.center=b:B[a.position]&&B[a.position].push(b),C.push(b),G=!0},this.active=l,this.deactive=m,v.onmouseup=function(a){if(!a.button)for(var b=a.target;b&&b!=v;)b.classList.contains("button")&&C.forEach(function(a){a.$button==b&&r(a)}),b=b.parentNode},this.handleKeyEvent=function(c){var d=null;if(c.keydown){if(C.forEach(function(e){c.isKey(e.key)&&(F||a.hintDeactiveMainState?(q(e),p(e),d="buttonpress"):(r(e),d="execute"),c.preventDefault(),c.stopPropagation(),!F&&a.hintDeactiveMainState&&a.active(b))}),F){if(c.isKey("esc"))return E?c.isKey(E.key)||p(null):a.active("back"),"back";["up","down","left","right"].forEach(function(a){if(c.isKey(a)){if(!D)return void q(B.center||B.ring[0]||B.top[0]||B.bottom[0]);for(var b=D.neighbor[a];b&&!b.enable();)b=b.neighbor[a];b&&q(b),d="navigate"}}),c.isKey("space")&&D?(p(D),d="buttonpress"):E&&E!=D&&(p(null),d="selectcancel")}}else!c.keyup||!F&&a.hintDeactiveMainState||E&&(c.isKey("space")&&D==E||c.isKey(E.key))&&(r(E),c.preventDefault(),c.stopPropagation(),d="execute");return d}}var l=b.r(21),m=b.r(22),n=j.STATE_IDLE="idle",o="div";d.exports=j}},b[21]={value:function(a,c,d){function e(a){return"string"==typeof a?h(a):g(a)}function f(a,b){return a&&b&&e(a)==e(b)}function g(a){var b=0;return(a.ctrlKey||a.metaKey)&&(b|=j),a.altKey&&(b|=k),a.shiftKey&&(b|=l),-1==[16,17,18,91].indexOf(a.keyCode)&&(b|=a.keyCode),b}function h(a){var b=0;return a.toLowerCase().split(/\s*\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":b|=j;break;case"alt":b|=k;break;case"shift":b|=l;break;default:b|=i[a]}}),b}var i=b.r(23),j=4096,k=8192,l=16384;c.hash=e,c.is=f}},b[22]={value:function(a,c,d){function e(a){function b(){j=document.createElement("input"),j.classList.add(g),m.appendChild(j),l=!0}function c(){j.onkeyup=e,j.onkeypress=e,j.onkeydown=e,j.onfocus=h,j.onblur=i,l&&(j.oninput=function(a){j.value=null})}function d(){m.onmousedown=function(a){h(),a.preventDefault()}}function e(b){k&&a.dispatch(b)}function h(){j.select(),j.focus(),k=!0,m.classList.add(f)}function i(){j.blur(),k=!1,m.classList.remove(f)}var j,k=!0,l=!1,m=a.$container;b(),c(),d(),h(),this.handle=e,this.active=h,this.deactive=i}var f=(b.r(21),"hotbox-focus"),g="hotbox-key-receiver";d.exports=e}},b[23]={value:function(a,b,c){var d={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}},b[24]={value:function(a,c,d){var e=b.r(42),f=b.r(36),g=(new e.Marker).pipe(function(){var a=7,b=new e.Circle(a-1);this.addShape(b),this.setRef(a-1,0).setViewBox(-a,-a,a+a,a+a).setWidth(a).setHeight(a),this.dot=b,this.node.setAttribute("markerUnits","userSpaceOnUse")});f.register("arc",function(a,b,c,d,f){var h,i,j,k=a.getLayoutBox(),l=b.getLayoutBox(),m=Math.abs,n=[],o=k.x>l.x?"right":"left";a.getMinder().getPaper().addResource(g),h=new e.Point(l.cx,l.cy),i="left"==o?new e.Point(k.right+2,k.cy):new e.Point(k.left-2,k.cy),j=e.Vector.fromPoints(h,i),n.push("M",h),n.push("A",m(j.x),m(j.y),0,0,j.x*j.y>0?0:1,i),c.setMarker(g),g.dot.fill(f),c.setPathData(n)})}},b[25]={value:function(a,c,d){var e=b.r(42),f=b.r(36),g=(new e.Marker).pipe(function(){var a=7,b=new e.Circle(a-1);this.addShape(b),this.setRef(a-1,0).setViewBox(-a,-a,a+a,a+a).setWidth(a).setHeight(a),this.dot=b,this.node.setAttribute("markerUnits","userSpaceOnUse")});f.register("arc_tp",function(a,b,c,d,f){var h=a.getLayoutBox(),i=b.getLayoutBox();if(a.getIndex()>0){var j=a.getIndex();i=b.getChildren()[j-1].getLayoutBox()}var k,l,m,n=(Math.abs,[]);h.x>i.x?"right":"left";a.getMinder().getPaper().addResource(g),k=new e.Point(i.cx,i.cy),l=new e.Point(h.cx,h.cy);var o=Math.sqrt(Math.abs(k.x-l.x)*Math.abs(k.x-l.x)+Math.abs(k.y-l.y)*Math.abs(k.y-l.y));o=0==a.getIndex()?.4*o:o,m=e.Vector.fromPoints(k,l),n.push("M",k),n.push("A",o,o,0,0,1,l),c.setMarker(g),g.dot.fill(f),c.setPathData(n)})}},b[26]={value:function(a,c,d){var e=(b.r(42),b.r(36));e.register("bezier",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=b.getLayoutVectorOut().normalize(),g=Math.round,h=Math.abs,i=[];if(i.push("M",g(d.x),g(d.y)),h(f.x)>h(f.y)){var j=(e.x+d.x)/2;i.push("C",j,d.y,j,e.y,e.x,e.y)}else{var k=(e.y+d.y)/2;i.push("C",d.x,k,e.x,k,e.x,e.y)}c.setMarker(null),c.setPathData(i)})}},b[27]={value:function(a,c,d){var e=(b.r(42),b.r(36));e.register("fish-bone-master",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=Math.abs,g=f(d.y-e.y),h=f(d.x-e.x),i=[];i.push("M",d.x,d.y),i.push("h",h-g),i.push("L",e.x,e.y),c.setMarker(null),c.setPathData(i)})}},b[28]={value:function(a,c,d){var e=(b.r(42),b.r(36));e.register("l",function(a,b,c){var d=b.getLayoutVertexOut(),e=a.getLayoutVertexIn(),f=b.getLayoutVectorOut(),g=[],h=Math.round,i=Math.abs;g.push("M",d.round()),i(f.x)>i(f.y)?g.push("H",h(e.x)):g.push("V",e.y),g.push("L",e),c.setPathData(g)})}},b[29]={value:function(a,c,d){var e=(b.r(42),b.r(36));e.register("poly",function(a,b,c,d){var e=b.getLayoutVertexOut(),f=a.getLayoutVertexIn(),g=b.getLayoutVectorOut().normalize(),h=Math.round,i=Math.abs,j=[];switch(j.push("M",h(e.x),h(e.y)),!0){case i(g.x)>i(g.y)&&g.x<0:j.push("h",-b.getStyle("margin-left")),j.push("v",f.y-e.y),j.push("H",f.x);break;case i(g.x)>i(g.y)&&g.x>=0:j.push("h",b.getStyle("margin-right")),j.push("v",f.y-e.y),j.push("H",f.x);break;case i(g.x)<=i(g.y)&&g.y<0:j.push("v",-b.getStyle("margin-top")),j.push("h",f.x-e.x),j.push("V",f.y);break;case i(g.x)<=i(g.y)&&g.y>=0:j.push("v",b.getStyle("margin-bottom")),j.push("h",f.x-e.x),j.push("V",f.y)}c.setMarker(null),c.setPathData(j)})}},b[30]={value:function(a,c,d){var e=b.r(42),f=b.r(36);f.register("under",function(a,b,c,d,f){var g,h,i,j,k=a.getLayoutBox(),l=b.getLayoutBox(),m=(Math.abs,[]),n=k.x>l.x?"right":"left",o=(a.getStyle("connect-radius"),k.bottom+3),p="sub"==b.getType()?l.bottom+3:l.cy;"right"==n?(g=new e.Point(l.right,p),h=new e.Point(k.left-10,o),i=new e.Point(k.right,o)):(g=new e.Point(l.left,p),h=new e.Point(k.right+10,o),i=new e.Point(k.left,o)),j=(g.x+h.x)/2,m.push("M",g),m.push("C",j,g.y,j,h.y,h),m.push("L",i),c.setMarker(null),c.setPathData(m)})}},b[31]={value:function(a,c,d){var e=b.r(42),f=b.r(44);if(-1!=location.href.indexOf("boxv")){var g;Object.defineProperty(e.Box.prototype,"visualization",{get:function(){return g?g.setBox(this):null}}),f.registerInitHook(function(){this.on("paperrender",function(){g=new e.Rect,g.fill("rgba(200, 200, 200, .5)"),g.stroke("orange"),this.getRenderContainer().addShape(g)})})}}},b[32]={value:function(a,c,d){var e=b.r(44),f={enableAnimation:!0,layoutAnimationDuration:300,viewAnimationDuration:100,zoomAnimationDuration:300},g={};e.registerInitHook(function(){this.setDefaultOptions(f),this.getOption("enableAnimation")||this.disableAnimation()}),e.prototype.enableAnimation=function(){for(var a in f)f.hasOwnProperty(a)&&this.setOption(g[a])},e.prototype.disableAnimation=function(){for(var a in f)f.hasOwnProperty(a)&&(g[a]=this.getOption(a),this.setOption(a,0))}}},b[33]={value:function(a,b,c){var d=function(){var a=navigator.userAgent.toLowerCase(),b=window.opera,c={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(a),opera:!!b&&b.version,webkit:a.indexOf(" applewebkit/")>-1,mac:a.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode,ipad:a.indexOf("ipad")>-1};c.gecko="Gecko"==navigator.product&&!c.webkit&&!c.opera&&!c.ie;var d=0;if(c.ie){var e=a.match(/(?:msie\s([\w.]+))/),f=a.match(/(?:trident.*rv:([\w.]+))/);d=e&&f&&e[1]&&f[1]?Math.max(1*e[1],1*f[1]):e&&e[1]?1*e[1]:f&&f[1]?1*f[1]:0,c.ie11Compat=11==document.documentMode,c.ie9Compat=9==document.documentMode,c.ie8=!!document.documentMode,c.ie8Compat=8==document.documentMode,c.ie7Compat=7==d&&!document.documentMode||7==document.documentMode,c.ie6Compat=7>d||c.quirks,c.ie9above=d>8,c.ie9below=9>d}if(c.gecko){var g=a.match(/rv:([\d\.]+)/);g&&(g=g[1].split("."),d=1e4*g[0]+100*(g[1]||0)+1*(g[2]||0))}return/chrome\/(\d+\.\d)/i.test(a)&&(c.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome/i.test(a)&&(c.safari=+(RegExp.$1||RegExp.$2)),c.opera&&(d=parseFloat(b.version())),c.webkit&&(d=parseFloat(a.match(/ applewebkit\/(\d+)/)[1])),c.version=d,c.isCompatible=!c.mobile&&(c.ie&&d>=6||c.gecko&&d>=10801||c.opera&&d>=9.5||c.air&&d>=1||c.webkit&&d>=522||!1),c}();d.ie,d.webkit,d.gecko,d.opera;c.exports=d}},b[34]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44)),g=(b.r(46),b.r(38)),h=0,i=-1,j=1,k=e.createClass("Command",{constructor:function(){this._isContentChange=!0,this._isSelectionChange=!1},execute:function(a,b){throw new Error("Not Implement: Command.execute()")},setContentChanged:function(a){this._isContentChange=!!a},isContentChanged:function(){return this._isContentChange},setSelectionChanged:function(a){this._isSelectionChange=!!a},isSelectionChanged:function(){return this._isContentChange},queryState:function(a){return h},queryValue:function(a){return 0},isNeedUndo:function(){return!0}});k.STATE_NORMAL=h,k.STATE_ACTIVE=j,k.STATE_DISABLED=i,e.extendClass(f,{_getCommand:function(a){return this._commands[a.toLowerCase()]},_queryCommand:function(a,b,c){var d=this._getCommand(a);if(d){var e=d["query"+b];if(e)return e.apply(d,[this].concat(c))}return 0},queryCommandState:function(a){return this._queryCommand(a,"State",[].slice.call(arguments,1))},queryCommandValue:function(a){return this._queryCommand(a,"Value",[].slice.call(arguments,1))},execCommand:function(a){if(!a)return null;a=a.toLowerCase();var b,c,d,e,f=[].slice.call(arguments,1),h=this;return b=this._getCommand(a),e={command:b,commandName:a.toLowerCase(),commandArgs:f},b&&~this.queryCommandState(a)?(this._hasEnterExecCommand?(d=b.execute.apply(b,[h].concat(f)),this._hasEnterExecCommand||this._interactChange()):(this._hasEnterExecCommand=!0,c=this._fire(new g("beforeExecCommand",e,!0)),c||(this._fire(new g("preExecCommand",e,!1)),d=b.execute.apply(b,[h].concat(f)),this._fire(new g("execCommand",e,!1)),b.isContentChanged()&&this._firePharse(new g("contentchange")),this._interactChange()),this._hasEnterExecCommand=!1),void 0===d?null:d):!1}}),d.exports=k}},b[35]={value:function(a,c,d){function e(a){var b=a.version||(a.root?"1.4.0":"1.1.3");switch(b){case"1.1.3":h(a);case"1.2.0":case"1.2.1":g(a);case"1.3.0":case"1.3.1":case"1.3.2":case"1.3.3":case"1.3.4":case"1.3.5":i(a)}return a}function f(a,b){b(a),a.children&&a.children.forEach(function(a){f(a,b)})}function g(a){f(a,function(a){var b=a.data;delete b.layout_bottom_offset,delete b.layout_default_offset,delete b.layout_filetree_offset})}function h(a){var b=a.data.currentstyle;delete a.data.currentstyle,"bottom"==b?(a.template="structure",a.theme="snow"):"default"==b&&(a.template="default",a.theme="classic"),f(a,function(a){var b=a.data;"PriorityIcon"in b&&(b.priority=b.PriorityIcon,delete b.PriorityIcon),"ProgressIcon"in b&&(b.progress=1+(b.ProgressIcon-1<<1),delete b.ProgressIcon),delete b.point,delete b.layout})}function i(a){a.root={data:a.data,children:a.children},delete a.data,delete a.children}b.r(58);return e}},b[36]={value:function(a,c,d){function e(a,b){k[a]=b}var f=b.r(42),g=b.r(58),h=b.r(45),i=b.r(44),j=b.r(46),k={};e("default",function(a,b,c){c.setPathData(["M",b.getLayoutVertexOut(),"L",a.getLayoutVertexIn()])}),f.extendClass(j,{getConnect:function(){return this.data.connect||"default"},getConnectProvider:function(){return k[this.getConnect()]||k["default"]},getConnection:function(){return this._connection||null}}),f.extendClass(i,{getConnectContainer:function(){return this._connectContainer},createConnect:function(a){if(!a.isRoot()){var b=new f.Path;a._connection=b,this._connectContainer.addShape(b),this.updateConnect(a)}},removeConnect:function(a){var b=this;a.traverse(function(a){b._connectContainer.removeShape(a._connection),a._connection=null})},updateConnect:function(a){var b=a._connection,c=a.parent;if(c&&b){if(c.isCollapsed())return void b.setVisible(!1);b.setVisible(!0);var d=a.getConnectProvider(),e=a.getStyle("connect-color")||"white",f=a.getStyle("connect-width")||2;b.stroke(e,f),d(a,c,b,f,e),f%2===0?b.setTranslate(.5,.5):b.setTranslate(0,0)}}}),h.register("Connect",{init:function(){this._connectContainer=(new f.Group).setId(g.uuid("minder_connect_group")),this.getRenderContainer().prependShape(this._connectContainer)},events:{nodeattach:function(a){this.createConnect(a.node)},nodedetach:function(a){this.removeConnect(a.node)},"layoutapply layoutfinish noderender":function(a){this.updateConnect(a.node)}}}),c.register=e}},b[37]={value:function(a,c,d){function e(a,b){k[a]=b}var f=b.r(42),g=(b.r(58),b.r(44)),h=(b.r(46),b.r(38)),i=b.r(35),j=b.r(50),k={};c.registerProtocol=e,f.extendClass(g,{setup:function(a){if("string"==typeof a&&(a=document.querySelector(a)),a){var b=a.getAttribute("minder-data-type");if(b in k){var c=a.textContent;a.textContent=null,this.renderTo(a),this.importData(b,c)}return this}},exportJson:function(){function a(b){var c={};c.data=b.getData();var d=b.getChildren();c.children=[];for(var e=0;e<d.length;e++)c.children.push(a(d[e]));return c}var b=a(this.getRoot());return b.template=this.getTemplate(),b.theme=this.getTheme(),b.version=g.version,JSON.parse(JSON.stringify(b))},importJson:function(a){function b(a,c,d){var e=c.data;a.data={};for(var f in e)a.setData(f,e[f]);for(var g=c.children||[],h=0;h<g.length;h++){var i=d.createNode(null,a);b(i,g[h],d)}return a}if(a){for(this._fire(new h("preimport",null,!1));this._root.getChildren().length;)this.removeNode(this._root.getChildren()[0]);return a=i(a),b(this._root,a,this),this.setTemplate(a.template||"default"),this.setTheme(a.theme||null),this.refresh(),this.fire("import"),this._firePharse({type:"contentchange"}),this._interactChange(),this}},exportData:function(a,b){var c,d;return c=this.exportJson(),!a||(d=k[a],d&&d.encode)?(this._fire(new h("beforeexport",{json:c,protocolName:a,protocol:d})),j.resolve(d.encode(c,this,b))):j.reject(new Error("Not supported protocol:"+a))},importData:function(a,b,c){var d,e=this;if(a&&(d=k[a],!d||!d.decode))return j.reject(new Error("Not supported protocol:"+a));var f={local:b,protocolName:a,protocol:d};return this._fire(new h("beforeimport",f)),j.resolve(d.decode(b,this,c)).then(function(a){return e.importJson(a),a})}})}},b[38]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44),h=e.createClass("MindEvent",{
constructor:function(a,b,c){b=b||{},b.getType&&"ShapeEvent"==b.getType()?(this.kityEvent=b,this.originEvent=b.originEvent,this.getPosition=b.getPosition.bind(b)):b.target&&b.preventDefault?this.originEvent=b:e.Utils.extend(this,b),this.type=a,this._canstop=c||!1},getTargetNode:function(){var a=this.kityEvent&&this.kityEvent.targetShape;if(!a)return null;for(;!a.minderNode&&a.container;)a=a.container;var b=a.minderNode;return b&&a.getOpacity()<1?null:b||null},stopPropagation:function(){this._stoped=!0},stopPropagationImmediately:function(){this._immediatelyStoped=!0,this._stoped=!0},shouldStopPropagation:function(){return this._canstop&&this._stoped},shouldStopPropagationImmediately:function(){return this._canstop&&this._immediatelyStoped},preventDefault:function(){this.originEvent.preventDefault()},isRightMB:function(){var a=!1;return this.originEvent?("which"in this.originEvent?a=3==this.originEvent.which:"button"in this.originEvent&&(a=2==this.originEvent.button),a):!1},getKeyCode:function(){var a=this.originEvent;return a.keyCode||a.which}});g.registerInitHook(function(a){this._initEvents()}),e.extendClass(g,{_initEvents:function(){this._eventCallbacks={}},_resetEvents:function(){this._initEvents(),this._bindEvents()},_bindEvents:function(){this._bindPaperEvents(),this._bindKeyboardEvents()},dispatchKeyEvent:function(a){this._firePharse(a)},_bindPaperEvents:function(){this._paper.on("click dblclick mousedown contextmenu mouseup mousemove mouseover mousewheel DOMMouseScroll touchstart touchmove touchend dragenter dragleave drop",this._firePharse.bind(this)),window&&(window.addEventListener("resize",this._firePharse.bind(this)),window.addEventListener("blur",this._firePharse.bind(this)))},_bindKeyboardEvents:function(){-1==navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPod")&&-1==navigator.userAgent.indexOf("iPad")&&f.listen(document.body,"keydown keyup keypress paste",this._firePharse.bind(this))},_firePharse:function(a){var b,c,d;"DOMMouseScroll"==a.type&&(a.type="mousewheel",a.wheelDelta=a.originEvent.wheelDelta=-10*a.originEvent.detail,a.wheelDeltaX=a.originEvent.mozMovementX,a.wheelDeltaY=a.originEvent.mozMovementY),b=new h("before"+a.type,a,!0),this._fire(b)||(c=new h("pre"+a.type,a,!0),d=new h(a.type,a,!0),(this._fire(c)||this._fire(d))&&this._fire(new h("after"+a.type,a,!1)))},_interactChange:function(a){var b=this;b._interactScheduled||(setTimeout(function(){b._fire(new h("interactchange")),b._interactScheduled=!1},100),b._interactScheduled=!0)},_listen:function(a,b){var c=this._eventCallbacks[a]||(this._eventCallbacks[a]=[]);c.push(b)},_fire:function(a){var b=this.getStatus(),c=this._eventCallbacks[a.type.toLowerCase()]||[];if(b&&(c=c.concat(this._eventCallbacks[b+"."+a.type.toLowerCase()]||[])),0!==c.length){for(var d=(this.getStatus(),0);d<c.length&&(c[d].call(this,a),!a.shouldStopPropagationImmediately());d++);return a.shouldStopPropagation()}},on:function(a,b){var c=this;return f.each(a.split(/\s+/),function(a,d){c._listen(d.toLowerCase(),b)}),this},off:function(a,b){var c,d,e,f,g=a.split(/\s+/);for(c=0;c<g.length;c++)if(e=this._eventCallbacks[g[c].toLowerCase()]){for(f=null,d=0;d<e.length;d++)e[d]==b&&(f=d);null!==f&&e.splice(f,1)}},fire:function(a,b){var c=new h(a,b);return this._fire(c),this}}),d.exports=h}},b[39]={value:function(a,c,d){var e=b.r(42),f=b.r(44);f.registerInitHook(function(){this.on("beforemousedown",function(a){this.focus(),a.preventDefault()}),this.on("paperrender",function(){this.focus()})}),e.extendClass(f,{focus:function(){if(!this.isFocused()){var a=this._renderTarget;a.classList.add("focus"),this.renderNodeBatch(this.getSelectedNodes())}return this.fire("focus"),this},blur:function(){if(this.isFocused()){var a=this._renderTarget;a.classList.remove("focus"),this.renderNodeBatch(this.getSelectedNodes())}return this.fire("blur"),this},isFocused:function(){var a=this._renderTarget;return a&&a.classList.contains("focus")}})}},b[40]={value:function(a,b,c){var d={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190,controlKeys:{16:1,17:1,18:1,20:1,91:1,224:1},notContentChange:{13:1,9:1,33:1,34:1,35:1,36:1,16:1,17:1,18:1,20:1,91:1,37:1,38:1,39:1,40:1,113:1,114:1,115:1,144:1,27:1},isSelectedNodeKey:{37:1,38:1,39:1,40:1,13:1,9:1}};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}},b[41]={value:function(a,c,d){function e(a,b,c){b.split(" ").forEach(function(b){a.addEventListener(b,c,!1)})}var f=b.r(42),g=(b.r(58),b.r(44));g.registerInitHook(function(a){this.setDefaultOptions({enableKeyReceiver:!0}),this.getOption("enableKeyReceiver")&&this.on("paperrender",function(){this._initKeyReceiver()})}),f.extendClass(g,{_initKeyReceiver:function(){if(!this._keyReceiver){var a=this._keyReceiver=document.createElement("input");a.classList.add("km-receiver");var b=this._renderTarget;b.appendChild(a);var c=this;e(a,"keydown keyup keypress copy paste blur focus input",function(b){switch(b.type){case"blur":c.blur();break;case"focus":c.focus();break;case"input":a.value=null}c._firePharse(b),b.preventDefault()}),this.on("focus",function(){a.select(),a.focus()}),this.on("blur",function(){a.blur()}),this.isFocused()&&(a.select(),a.focus())}}})}},b[42]={value:function(a,b,c){c.exports=window.kity}},b[43]={value:function(a,c,d){function e(a,b){k[a]=b,f=f||a}var f,g=b.r(42),h=b.r(58),i=b.r(44),j=b.r(46),k=(b.r(38),b.r(34),{}),l=g.createClass("Layout",{doLayout:function(a,b){throw new Error("Not Implement: Layout.doLayout()")},align:function(a,b,c){var d=this;c=c||0,a.forEach(function(a){var e=d.getTreeBox([a]),f=a.getLayoutTransform();switch(b){case"left":return f.translate(c-e.left,0);case"right":return f.translate(c-e.right,0);case"top":return f.translate(0,c-e.top);case"bottom":return f.translate(0,c-e.bottom)}})},stack:function(a,b,c){var d=this,e=0;return c=c||function(a,b,c){return a.getStyle({x:"margin-right",y:"margin-bottom"}[c])+b.getStyle({x:"margin-left",y:"margin-top"}[c])},a.forEach(function(a,f,g){var h=d.getTreeBox([a]),i={x:h.width,y:h.height}[b],j={x:h.left,y:h.top}[b],k=a.getLayoutTransform();"x"==b?k.translate(e-j,0):k.translate(0,e-j),e+=i,g[f+1]&&(e+=c(a,g[f+1],b))}),e},move:function(a,b,c){a.forEach(function(a){a.getLayoutTransform().translate(b,c)})},getBranchBox:function(a){var b,c,d,e,f=new g.Box;for(b=0;b<a.length;b++)c=a[b],d=c.getLayoutTransform(),e=c.getContentBox(),f=f.merge(d.transformBox(e));return f},getTreeBox:function(a){var b,c,d,e,f=new g.Box;for(a instanceof Array||(a=[a]),b=0;b<a.length;b++)c=a[b],d=c.getLayoutTransform(),e=c.getContentBox(),c.isExpanded()&&c.children.length&&(e=e.merge(this.getTreeBox(c.children))),f=f.merge(d.transformBox(e));return f},getOrderHint:function(a){return[]}});l.register=e,i.registerInitHook(function(a){this.refresh()}),h.extend(i,{getLayoutList:function(){return k},getLayoutInstance:function(a){var b=k[a];if(!b)throw new Error("Missing Layout: "+a);var c=new b;return c}}),g.extendClass(j,{getLayout:function(){var a=this.getData("layout");return a=a||(this.isRoot()?f:this.parent.getLayout())},setLayout:function(a){return a&&("inherit"==a?this.setData("layout"):this.setData("layout",a)),this},layout:function(a){return this.setLayout(a).getMinder().layout(),this},getLayoutInstance:function(){return i.getLayoutInstance(this.getLayout())},getOrderHint:function(a){return this.parent.getLayoutInstance().getOrderHint(this)},getLayoutTransform:function(){return this._layoutTransform||new g.Matrix},getGlobalLayoutTransformPreview:function(){var a=this.parent?this.parent.getLayoutTransform():new g.Matrix,b=this.getLayoutTransform(),c=this.getLayoutOffset();return c&&(b=b.clone().translate(c.x,c.y)),a.merge(b)},getLayoutPointPreview:function(){return this.getGlobalLayoutTransformPreview().transformPoint(new g.Point)},getGlobalLayoutTransform:function(){return this._globalLayoutTransform?this._globalLayoutTransform:this.parent?this.parent.getGlobalLayoutTransform():new g.Matrix},setLayoutTransform:function(a){return this._layoutTransform=a,this},setGlobalLayoutTransform:function(a){return this.getRenderContainer().setMatrix(this._globalLayoutTransform=a),this},setVertexIn:function(a){this._vertexIn=a},setVertexOut:function(a){this._vertexOut=a},getVertexIn:function(){return this._vertexIn||new g.Point},getVertexOut:function(){return this._vertexOut||new g.Point},getLayoutVertexIn:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexIn())},getLayoutVertexOut:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexOut())},setLayoutVectorIn:function(a){return this._layoutVectorIn=a,this},setLayoutVectorOut:function(a){return this._layoutVectorOut=a,this},getLayoutVectorIn:function(){return this._layoutVectorIn||new g.Vector},getLayoutVectorOut:function(){return this._layoutVectorOut||new g.Vector},getLayoutBox:function(){var a=this.getGlobalLayoutTransform();return a.transformBox(this.getContentBox())},getLayoutPoint:function(){var a=this.getGlobalLayoutTransform();return a.transformPoint(new g.Point)},getLayoutOffset:function(){if(!this.parent)return new g.Point;var a=this.getData("layout_"+this.parent.getLayout()+"_offset");return a?new g.Point(a.x,a.y):new g.Point},setLayoutOffset:function(a){return this.parent?(this.setData("layout_"+this.parent.getLayout()+"_offset",a?{x:a.x,y:a.y}:void 0),this):this},hasLayoutOffset:function(){return!!this.getData("layout_"+this.parent.getLayout()+"_offset")},resetLayoutOffset:function(){return this.setLayoutOffset(null)},getLayoutRoot:function(){return this.isLayoutRoot()?this:this.parent.getLayoutRoot()},isLayoutRoot:function(){return this.getData("layout")||this.isRoot()}}),g.extendClass(i,{layout:function(){function a(b,c){b.isExpanded(),0||b.children.forEach(function(b){a(b,c)});var d=b.getLayoutInstance();b.getChildren().filter(function(a){return!a.hasLayoutOffset()});d.doLayout(b,b.getChildren(),c)}var b=this.getOption("layoutAnimationDuration");this.getRoot().traverse(function(a){a.setLayoutTransform(null)}),a(this.getRoot(),1),a(this.getRoot(),2);var c=this;return this.applyLayoutResult(this.getRoot(),b,function(){c.fire("layoutallfinish")}),this.fire("layout")},refresh:function(){return this.getRoot().renderTree(),this.layout().fire("contentchange")._interactChange(),this},applyLayoutResult:function(a,b,c){function d(){--i||c&&c()}function e(a,b){a.setGlobalLayoutTransform(b),h.fire("layoutapply",{node:a,matrix:b})}function f(a,c){var i=a.getLayoutTransform().merge(c.clone()),j=a.getGlobalLayoutTransform()||new g.Matrix,k=a.getLayoutOffset();i.translate(k.x,k.y),i.m.e=Math.round(i.m.e),i.m.f=Math.round(i.m.f),a._layoutTimeline&&(a._layoutTimeline.stop(),a._layoutTimeline=null),b?a._layoutTimeline=new g.Animator(j,i,e).start(a,b,"ease").on("finish",function(){setTimeout(function(){e(a,i),h.fire("layoutfinish",{node:a,matrix:i}),d()},150)}):(e(a,i),h.fire("layoutfinish",{node:a,matrix:i}),d());for(var l=0;l<a.children.length;l++)f(a.children[l],i)}a=a||this.getRoot();var h=this,i=a.getComplex();return i>200&&(b=0),f(a,a.parent?a.parent.getGlobalLayoutTransform():new g.Matrix),this}}),d.exports=l}},b[44]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=[],h=e.createClass("Minder",{constructor:function(a){this._options=f.extend({},a);for(var b,c=g.slice();c.length;)b=c.shift(),"function"==typeof b&&b.call(this,this._options);this.fire("ready")}});h.version="1.4.1",h.registerInitHook=function(a){g.push(a)},d.exports=h}},b[45]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44),h={};c.register=function(a,b){h[a]=b},g.registerInitHook(function(){this._initModules()}),e.extendClass(g,{_initModules:function(){var a=h,b=this._options.modules||f.keys(a);this._commands={},this._query={},this._modules={},this._rendererClasses={};var c,d,e,g,i,j,k,l=this;for(c=0;c<b.length;c++)if(d=b[c],a[d]&&(g="function"==typeof a[d]?a[d].call(l):a[d],this._modules[d]=g,g)){g.defaultOptions&&l.setDefaultOptions(g.defaultOptions),g.init&&g.init.call(l,this._options),i=g.commands;for(d in i)this._commands[d.toLowerCase()]=new i[d];if(j=g.events)for(e in j)l.on(e,j[e]);if(k=g.renderers)for(e in k)this._rendererClasses[e]=this._rendererClasses[e]||[],f.isArray(k[e])?this._rendererClasses[e]=this._rendererClasses[e].concat(k[e]):this._rendererClasses[e].push(k[e]);g.commandShortcutKeys&&this.addCommandShortcutKeys(g.commandShortcutKeys)}},_garbage:function(){for(this.clearSelect();this._root.getChildren().length;)this._root.removeChild(0)},destroy:function(){var a=this._modules;this._resetEvents(),this._garbage();for(var b in a)a[b].destroy&&a[b].destroy.call(this)},reset:function(){var a=this._modules;this._garbage();for(var b in a)a[b].reset&&a[b].reset.call(this)}})}},b[46]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44),h=e.createClass("MinderNode",{constructor:function(a){this.parent=null,this.root=this,this.children=[],this.data={id:f.guid(),created:+new Date},this.initContainers(),f.isString(a)?this.setText(a):f.isObject(a)&&f.extend(this.data,a)},initContainers:function(){this.rc=(new e.Group).setId(f.uuid("minder_node")),this.rc.minderNode=this},isRoot:function(){return this.root===this},isLeaf:function(){return 0===this.children.length},getRoot:function(){return this.root||this},getParent:function(){return this.parent},getSiblings:function(){var a=this.parent.children,b=[],c=this;return a.forEach(function(a){a!=c&&b.push(a)}),b},getLevel:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},getComplex:function(){var a=0;return this.traverse(function(){a++}),a},getType:function(a){return this.type=["root","main","sub"][Math.min(this.getLevel(),2)],this.type},isAncestorOf:function(a){for(var b=a.parent;b;){if(b==this)return!0;b=b.parent}return!1},getData:function(a){return a?this.data[a]:this.data},setData:function(a,b){if("object"==typeof a){var c=a;for(a in c)c.hasOwnProperty(a)&&(this.data[a]=c[a])}else this.data[a]=b;return this},setText:function(a){return this.data.text=a},getText:function(){return this.data.text||null},preTraverse:function(a,b){var c=this.getChildren();b||a(this);for(var d=0;d<c.length;d++)c[d].preTraverse(a)},postTraverse:function(a,b){for(var c=this.getChildren(),d=0;d<c.length;d++)c[d].postTraverse(a);b||a(this)},traverse:function(a,b){return this.postTraverse(a,b)},getChildren:function(){return this.children},getIndex:function(){return this.parent?this.parent.children.indexOf(this):-1},insertChild:function(a,b){void 0===b&&(b=this.children.length),a.parent&&a.parent.removeChild(a),a.parent=this,a.root=this.root,this.children.splice(b,0,a)},appendChild:function(a){return this.insertChild(a)},prependChild:function(a){return this.insertChild(a,0)},removeChild:function(a){var b,c=a;a instanceof h&&(c=this.children.indexOf(a)),c>=0&&(b=this.children.splice(c,1)[0],b.parent=null,b.root=b)},clearChildren:function(){this.children=[]},getChild:function(a){return this.children[a]},getRenderContainer:function(){return this.rc},getCommonAncestor:function(a){return h.getNodeCommonAncestor(this,a)},contains:function(a){return this==a||this.isAncestorOf(a)},clone:function(){var a=new h;return a.data=f.clone(this.data),this.children.forEach(function(b){a.appendChild(b.clone())}),a},equals:function(a,b){function c(){e&&d.setSelectedFlag(),g&&a.setSelectedFlag()}var d=this;if(b){var e=!1,g=!1;d.isSelected()&&(e=!0,d.clearSelectedFlag()),a.isSelected()&&(g=!0,a.clearSelectedFlag())}if(a.children.length!=this.children.length)return c(),!1;if(f.compareObject(a.getData(),d.getData())===!1)return c(),!1;if(f.compareObject(a.getTmpData(),d.getTmpData())===!1)return c(),!1;for(var h,i=0;h=d.children[i];i++)if(h.equals(a.children[i],b)===!1)return c(),!1;return c(),!0},compareTo:function(a){if(!f.comparePlainObject(this.data,a.data))return!1;if(!f.comparePlainObject(this.temp,a.temp))return!1;if(this.children.length!=a.children.length)return!1;for(var b=0;this.children[b];){if(!this.children[b].compareTo(a.children[b]))return!1;b++}return!0},setTmpData:function(a,b){var c=this;f.isObject(a)&&f.each(a,function(a,b){c.setTmpData(a,b)}),void 0===b||null===b||""===b?delete this.tmpData[a]:this.tmpData[a]=b},getTmpData:function(a){return void 0===a?this.tmpData:this.tmpData[a]},getMinder:function(){return this.getRoot().minder}});h.getCommonAncestor=function(a,b){if(a instanceof Array)return h.getCommonAncestor.apply(this,a);switch(arguments.length){case 1:return a.parent||a;case 2:if(a.isAncestorOf(b))return a;if(b.isAncestorOf(a))return b;for(var c=a.parent;c&&!c.isAncestorOf(b);)c=c.parent;return c;default:return Array.prototype.reduce.call(arguments,function(a,b){return h.getCommonAncestor(a,b)},a)}},e.extendClass(g,{getRoot:function(){return this._root},setRoot:function(a){this._root=a,a.minder=this},getAllNode:function(){var a=[];return this.getRoot().traverse(function(b){a.push(b)}),a},getNodeById:function(a){return this.getNodesById([a])[0]},getNodesById:function(a){var b=this.getAllNode(),c=[];return b.forEach(function(b){-1!=a.indexOf(b.getData("id"))&&c.push(b)}),c},createNode:function(a,b,c){var d=new h(a);return this.fire("nodecreate",{node:d,parent:b,index:c}),this.appendNode(d,b,c),d},appendNode:function(a,b,c){return b&&b.insertChild(a,c),this.attachNode(a),this},removeNode:function(a){a.parent&&(a.parent.removeChild(a),this.detachNode(a),this.fire("noderemove",{node:a}))},attachNode:function(a){var b=this.getRenderContainer();a.traverse(function(a){a.attached=!0,b.addShape(a.getRenderContainer())}),b.addShape(a.getRenderContainer()),this.fire("nodeattach",{node:a})},detachNode:function(a){var b=this.getRenderContainer();a.traverse(function(a){a.attached=!1,b.removeShape(a.getRenderContainer())}),this.fire("nodedetach",{node:a})},getMinderTitle:function(){return this.getRoot().getText()}}),d.exports=h}},b[47]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44);g.registerInitHook(function(a){this._defaultOptions={}}),e.extendClass(g,{setDefaultOptions:function(a){return f.extend(this._defaultOptions,a),this},getOption:function(a){return a?a in this._options?this._options[a]:this._defaultOptions[a]:f.extend({},this._defaultOptions,this._options)},setOption:function(a,b){this._options[a]=b}})}},b[48]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44);g.registerInitHook(function(){this._initPaper()}),e.extendClass(g,{_initPaper:function(){this._paper=new e.Paper,this._paper._minder=this,this._paper.getNode().ondragstart=function(a){a.preventDefault()},this._paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),this._addRenderContainer(),this.setRoot(this.createNode()),this._options.renderTo&&this.renderTo(this._options.renderTo)},_addRenderContainer:function(){this._rc=(new e.Group).setId(f.uuid("minder")),this._paper.addShape(this._rc)},renderTo:function(a){if("string"==typeof a&&(a=document.querySelector(a)),a){if("script"==a.tagName.toLowerCase()){var b=document.createElement("div");b.id=a.id,b["class"]=a["class"],a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a),a=b}a.classList.add("km-view"),this._paper.renderTo(this._renderTarget=a),this._bindEvents(),this.fire("paperrender")}return this},getRenderContainer:function(){return this._rc},getPaper:function(){return this._paper},getRenderTarget:function(){return this._renderTarget}})}},b[49]={value:function(a,c,d){function e(a,b,c,d){return c=a.createNode(b.data,c,d),b.children.forEach(function(b,d){e(a,b,c,d)}),c}function f(a,b){var c=b.path.split("/");c.shift();var d,f=c.shift();if("root"==f){var g=c.indexOf("data");if(g>-1){f="data";var h=c.splice(g+1);b.dataPath=h}else f="node";d=a.getRoot();for(var i,j;i=c.shift();)"children"!=i&&("undefined"!=typeof j&&(d=d.getChild(j)),j=+i);b.index=j,b.node=d}var k=b.express=[f,b.op].join(".");switch(k){case"theme.replace":a.useTheme(b.value);break;case"template.replace":a.useTemplate(b.value);break;case"node.add":e(a,b.value,b.node,b.index).renderTree(),a.layout();break;case"node.remove":a.removeNode(b.node.getChild(b.index)),a.layout();break;case"data.add":case"data.replace":case"data.remove":var l,m=b.node.data;for(c=b.dataPath.slice();m&&c.length>1;)l=c.shift(),l in m?m=m[l]:"remove"!=b.op&&(m=m[l]={});m&&(l=c.shift(),m[l]=b.value),"expandState"==l?d.renderTree():d.render(),a.layout()}a.fire("patch",{patch:b})}var g=b.r(42),h=b.r(44);g.extendClass(h,{applyPatches:function(a){for(var b=0;b<a.length;b++)f(this,a[b]);return this.fire("contentchange"),this}})}},b[50]={value:function(a,b,c){var d=0,e=1,f=2,g=function(a){return this instanceof g?(this.id="Thenable/1.0.7",this.state=d,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],void("function"==typeof a&&a.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new g(a)};g.prototype={fulfill:function(a){return h(this,e,"fulfillValue",a)},reject:function(a){return h(this,f,"rejectReason",a)},then:function(a,b){var c=this,d=new g;return c.onFulfilled.push(k(a,d,"fulfill")),c.onRejected.push(k(b,d,"reject")),i(c),d}};var h=function(a,b,c,e){return a.state===d&&(a.state=b,a[c]=e,i(a)),a},i=function(a){a.state===e?j(a,"onFulfilled",a.fulfillValue):a.state===f&&j(a,"onRejected",a.rejectReason)},j=function(a,b,c){if(0!==a[b].length){var d=a[b];a[b]=[];var e=function(){for(var a=0;a<d.length;a++)d[a](c)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(e):"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}},k=function(a,b,c){return function(d){if("function"!=typeof a)b[c].call(b,d);else{var e;try{e=d instanceof g?d.then(a):a(d)}catch(f){return void b.reject(f)}l(b,e)}}},l=function(a,b){if(a===b)return void a.reject(new TypeError("cannot resolve promise with itself"));var c;if("object"==typeof b&&null!==b||"function"==typeof b)try{c=b.then}catch(d){return void a.reject(d)}if("function"!=typeof c)a.fulfill(b);else{var e=!1;try{c.call(b,function(c){e||(e=!0,c===b?a.reject(new TypeError("circular thenable chain")):l(a,c))},function(b){e||(e=!0,a.reject(b))})}catch(d){e||a.reject(d)}}};g.resolve=function(a){return new g(function(b){b(a)})},g.reject=function(a){return new g(function(b,c){c(a)})},c.exports=g}},b[51]={value:function(a,c,d){var e=b.r(42),f=b.r(44);f.registerInitHook(function(a){a.readOnly&&this.setDisabled()}),e.extendClass(f,{disable:function(){var a=this;a.bkqueryCommandState=a.queryCommandState,a.bkqueryCommandValue=a.queryCommandValue,a.queryCommandState=function(b){var c=this._getCommand(b);return c&&c.enableReadOnly?a.bkqueryCommandState.apply(a,arguments):-1},a.queryCommandValue=function(b){var c=this._getCommand(b);return c&&c.enableReadOnly?a.bkqueryCommandValue.apply(a,arguments):null},this.setStatus("readonly"),a._interactChange()},enable:function(){var a=this;a.bkqueryCommandState&&(a.queryCommandState=a.bkqueryCommandState,delete a.bkqueryCommandState),a.bkqueryCommandValue&&(a.queryCommandValue=a.bkqueryCommandValue,delete a.bkqueryCommandValue),this.setStatus("normal"),a._interactChange()}})}},b[52]={value:function(a,c,d){function e(){function a(a,b){var c=[];["center","left","right","top","bottom","outline","outside"].forEach(function(a){var d="before"+a,e="after"+a;b[d]&&(c=c.concat(b[d])),b[a]&&(c=c.concat(b[a])),b[e]&&(c=c.concat(b[e]))}),a._renderers=c.map(function(b){return new b(a)})}return{renderNodeBatch:function(b){var c,d,e,g,h=this._rendererClasses,i=[],j=0;if(b.length){for(d=0;d<b.length;d++)g=b[d],g._renderers||a(g,h),g._contentBox=new f.Box,this.fire("beforerender",{node:g});for(j=b[0]._renderers.length,c=0;j>c;c++){for(d=0;d<b.length;d++)"function"==typeof i[d]&&(i[d]=i[d]()),i[d]instanceof f.Box||(i[d]=new f.Box(i[d]));for(d=0;d<b.length;d++)g=b[d],e=g._renderers[c],i[d]&&(g._contentBox=g._contentBox.merge(i[d]),e.contentBox=i[d]),e.shouldRender(g)?(e.getRenderShape()||(e.setRenderShape(e.create(g)),e.bringToBack?g.getRenderContainer().prependShape(e.getRenderShape()):g.getRenderContainer().appendShape(e.getRenderShape())),e.getRenderShape().setVisible(!0),i[d]=e.update(e.getRenderShape(),g,g._contentBox)):e.getRenderShape()&&(e.getRenderShape().setVisible(!1),i[d]=null)}for(d=0;d<b.length;d++)this.fire("noderender",{node:b[d]})}},renderNode:function(b){var c,d=this._rendererClasses;b._renderers||a(b,d),this.fire("beforerender",{node:b}),b._contentBox=new f.Box,b._renderers.forEach(function(a){a.shouldRender(b)?(a.getRenderShape()||(a.setRenderShape(a.create(b)),a.bringToBack?b.getRenderContainer().prependShape(a.getRenderShape()):b.getRenderContainer().appendShape(a.getRenderShape())),a.getRenderShape().setVisible(!0),c=a.update(a.getRenderShape(),b,b._contentBox),"function"==typeof c&&(c=c()),c&&(b._contentBox=b._contentBox.merge(c),a.contentBox=c)):a.getRenderShape()&&a.getRenderShape().setVisible(!1)}),this.fire("noderender",{node:b})}}}var f=b.r(42),g=b.r(44),h=b.r(46),i=f.createClass("Renderer",{constructor:function(a){this.node=a},create:function(a){throw new Error("Not implement: Renderer.create()")},shouldRender:function(a){return!0},watchChange:function(a){var b;b=void 0===this.watchingData?!0:this.watchingData!=a?!0:!1,this.watchingData=a},shouldDraw:function(a){return!0},update:function(a,b,c){return this.shouldDraw()&&this.draw(a,b),this.place(a,b,c)},draw:function(a,b){throw new Error("Not implement: Renderer.draw()")},place:function(a,b,c){throw new Error("Not implement: Renderer.place()")},getRenderShape:function(){return this._renderShape||null},setRenderShape:function(a){this._renderShape=a}});f.extendClass(g,e()),f.extendClass(h,{render:function(){return this.attached?(this.getMinder().renderNode(this),this):void 0},renderTree:function(){if(this.attached){var a=[];return this.traverse(function(b){a.push(b)}),this.getMinder().renderNodeBatch(a),this}},getRenderer:function(a){var b=this._renderers;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].getType()==a)return b[c];return null},getContentBox:function(){return this.parent&&this.parent.isCollapsed()?new f.Box:this._contentBox||new f.Box},getRenderBox:function(a,b){var c=a&&this.getRenderer(a),d=c?c.contentBox:this.getContentBox(),e=f.Matrix.getCTM(this.getRenderContainer(),b||"paper");return e.transformBox(d)}}),d.exports=i}},b[53]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44),h=b.r(46);g.registerInitHook(function(){this._initSelection()}),e.extendClass(g,{_initSelection:function(){this._selectedNodes=[]},renderChangedSelection:function(a){var b=this.getSelectedNodes(),c=[];for(b.forEach(function(b){-1==a.indexOf(b)&&c.push(b)}),a.forEach(function(a){-1==b.indexOf(a)&&c.push(a)}),c.length&&(this._interactChange(),this.fire("selectionchange"));c.length;)c.shift().render()},getSelectedNodes:function(){return this._selectedNodes},getSelectedNode:function(){return this.getSelectedNodes()[0]||null},removeAllSelectedNodes:function(){var a=this._selectedNodes.splice(0);return this._selectedNodes=[],this.renderChangedSelection(a),this.fire("selectionclear")},removeSelectedNodes:function(a){var b=this,c=this._selectedNodes.slice(0);return a=f.isArray(a)?a:[a],a.forEach(function(a){var c;-1!==(c=b._selectedNodes.indexOf(a))&&b._selectedNodes.splice(c,1)}),this.renderChangedSelection(c),this},select:function(a,b){var c=this.getSelectedNodes().slice(0);b&&(this._selectedNodes=[]);var d=this;return a=f.isArray(a)?a:[a],a.forEach(function(a){-1===d._selectedNodes.indexOf(a)&&d._selectedNodes.unshift(a)}),this.renderChangedSelection(c),this},selectById:function(a,b){a=f.isArray(a)?a:[a];var c=this.getNodesById(a);return this.select(c,b)},toggleSelect:function(a){return f.isArray(a)?a.forEach(this.toggleSelect.bind(this)):a.isSelected()?this.removeSelectedNodes(a):this.select(a),this},isSingleSelect:function(){return 1==this._selectedNodes.length},getSelectedAncestors:function(a){function b(a,b){for(var c=a.length-1;c>=0;--c)if(a[c].isAncestorOf(b))return!0;return!1}var c,d=this.getSelectedNodes().slice(0),e=[],f=d.indexOf(this.getRoot());for(~f&&!a&&d.splice(f,1),d.sort(function(a,b){return a.getLevel()-b.getLevel()});c=d.pop();)b(d,c)||e.push(c);return e}}),e.extendClass(h,{isSelected:function(){var a=this.getMinder();return a&&-1!=a.getSelectedNodes().indexOf(this)}})}},b[54]={value:function(a,c,d){function e(a){var b=4096,c=8192,d=16384,e=0;return"string"==typeof a?a.toLowerCase().split(/\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":e|=b;break;case"alt":e|=c;break;case"shift":e|=d;break;default:e|=h[a]}}):((a.ctrlKey||a.metaKey)&&(e|=b),a.altKey&&(e|=c),a.shiftKey&&(e|=d),e|=a.keyCode),e}var f=b.r(42),g=b.r(58),h=b.r(40),i=b.r(44),j=b.r(38);f.extendClass(j,{isShortcutKey:function(a){var b=this.originEvent;return b?e(a)==e(b):!1}}),i.registerInitHook(function(){this._initShortcutKey()}),f.extendClass(i,{_initShortcutKey:function(){this._bindShortcutKeys()},_bindShortcutKeys:function(){var a=this._shortcutKeys={},b="hasOwnProperty";this.on("keydown",function(c){for(var d in a)if(a[b](d)&&c.isShortcutKey(d)){var e=a[d];if(e.__statusCondition&&e.__statusCondition!=this.getStatus())return;e(),c.preventDefault()}})},addShortcut:function(a,b){var c=this._shortcutKeys;a.split(/\|\s*/).forEach(function(a){var d,e=a.split("::");e.length>1&&(a=e[1],d=e[0],b.__statusCondition=d),c[a]=b})},addCommandShortcutKeys:function(a,b){var c=this._commandShortcutKeys||(this._commandShortcutKeys={}),d={};b?d[a]=b:d=a;var e=this;g.each(d,function(a,b){c[a]=b,e.addShortcut(b,function(){0===e.queryCommandState(a)&&e.execCommand(a)})})},getCommandShortcutKey:function(a){var b=this._commandShortcutKeys;return b&&b[a]||null}})}},b[55]={value:function(a,c,d){var e=b.r(42),f=b.r(44),g=~window.location.href.indexOf("status"),h=~window.location.href.indexOf("trace");f.registerInitHook(function(){this._initStatus()}),e.extendClass(f,{_initStatus:function(){this._status="normal",this._rollbackStatus="normal"},setStatus:function(a,b){return"readonly"!=this._status||b?(a!=this._status&&(this._rollbackStatus=this._status,this._status=a,this.fire("statuschange",{lastStatus:this._rollbackStatus,currentStatus:this._status}),g&&(console.log(window.event.type,this._rollbackStatus,"->",this._status),h&&console.trace())),this):this},rollbackStatus:function(){this.setStatus(this._rollbackStatus)},getRollbackStatus:function(){return this._rollbackStatus},getStatus:function(){return this._status}})}},b[56]={value:function(a,c,d){function e(a,b){l[a]=b}var f=b.r(42),g=b.r(58),h=b.r(44),i=b.r(34),j=b.r(46),k=b.r(45),l={};c.register=e,g.extend(h,{getTemplateList:function(){return l}}),f.extendClass(h,function(){var a=h.prototype.getTheme;return{useTemplate:function(a,b){this.setTemplate(a),this.refresh(b||800)},getTemplate:function(){return this._template||"default"},setTemplate:function(a){this._template=a||null},getTemplateSupport:function(a){var b=l[this.getTemplate()];return b&&b[a]},getTheme:function(b){var c=this.getTemplateSupport("getTheme")||a;return c.call(this,b)}}}()),f.extendClass(j,function(){var a=j.prototype.getLayout,b=j.prototype.getConnect;return{getLayout:function(){var b=this.getMinder().getTemplateSupport("getLayout")||a;return b.call(this,this)},getConnect:function(){var a=this.getMinder().getTemplateSupport("getConnect")||b;return a.call(this,this)}}}()),k.register("TemplateModule",{commands:{template:f.createClass("TemplateCommand",{base:i,execute:function(a,b){a.useTemplate(b),a.execCommand("camera")},queryValue:function(a){return a.getTemplate()||"default"}})}})}},b[57]={value:function(a,c,d){function e(a,b){m[a]=b}var f=b.r(42),g=b.r(58),h=b.r(44),i=b.r(46),j=b.r(45),k=b.r(34),l={left:function(a){return 3 in a&&a[3]||1 in a&&a[1]||a[0]},right:function(a){
return 1 in a&&a[1]||a[0]},top:function(a){return a[0]},bottom:function(a){return 2 in a&&a[2]||a[0]}},m={};c.register=e,g.extend(h,{getThemeList:function(){return m}}),f.extendClass(h,{useTheme:function(a){return this.setTheme(a),this.refresh(800),!0},setTheme:function(a){if(a&&!m[a])throw new Error("Theme "+a+" not exists!");var b=this._theme;this._theme=a||null;var c=this.getRenderTarget();return c&&(c.classList.remove("km-theme-"+b),a&&c.classList.add("km-theme-"+a),c.style.background=this.getStyle("background")),this.fire("themechange",{theme:a}),this},getTheme:function(a){return this._theme||this.getOption("defaultTheme")||"fresh-blue"},getThemeItems:function(a){this.getTheme(a);return m[this.getTheme(a)]},getStyle:function(a,b){var c,d,e,f,h=this.getThemeItems(b);if(a in h)return h[a];if(c=a.split("-"),c.length<2)return null;if(d=c.pop(),a=c.join("-"),a in h){if(e=h[a],g.isArray(e)&&(f=l[d]))return f(e);if(!isNaN(e))return e}return null},getNodeStyle:function(a,b){var c=this.getStyle(a.getType()+"-"+b,a);return null!==c?c:this.getStyle(b,a)}}),f.extendClass(i,{getStyle:function(a){return this.getMinder().getNodeStyle(this,a)}}),j.register("Theme",{defaultOptions:{defaultTheme:"fresh-blue"},commands:{theme:f.createClass("ThemeCommand",{base:k,execute:function(a,b){return a.useTheme(b)},queryValue:function(a){return a.getTheme()||"default"}})}}),h.registerInitHook(function(){this.setTheme()})}},b[58]={value:function(a,c){var d=b.r(42),e={};c.extend=d.Utils.extend.bind(d.Utils),c.listen=function(a,b,d){var e=c.isArray(b)?b:c.trim(b).split(/\s+/),f=e.length;if(f)for(;f--;)if(b=e[f],a.addEventListener)a.addEventListener(b,d,!1);else{d._d||(d._d={els:[]});var g=b+d.toString(),h=c.indexOf(d._d.els,a);d._d[g]&&-1!=h||(-1==h&&d._d.els.push(a),d._d[g]||(d._d[g]=function(a){return d.call(a.srcElement,a||window.event)}),a.attachEvent("on"+b,d._d[g]))}a=null},c.uuid=function(a){return e[a]=e[a]?e[a]+1:1,a+e[a]},c.guid=function(){return(1e6*+new Date+Math.floor(1e6*Math.random())).toString(36)},c.trim=function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},c.each=function(a,b,c){if(null!=a)if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,d,a[d],a)===!1)return!1}else for(var f in a)if(a.hasOwnProperty(f)&&b.call(c,f,a[f],a)===!1)return!1},c.addCssRule=function(a,b,c){var d;return void 0===b||b&&b.nodeType&&9==b.nodeType?(c=b&&b.nodeType&&9==b.nodeType?b:c||document,d=c.getElementById(a),d?d.innerHTML:void 0):(c=c||document,d=c.getElementById(a),""===b?d?(d.parentNode.removeChild(d),!0):!1:void(d?d.innerHTML=b:(d=c.createElement("style"),d.id=a,d.innerHTML=b,c.getElementsByTagName("head")[0].appendChild(d))))},c.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},c.proxy=function(a,b){return function(){return a.apply(b,arguments)}},c.indexOf=function(a,b,c){var d=-1;return c=this.isNumber(c)?c:0,this.each(a,function(a,e){return e>=c&&a===b?(d=e,!1):void 0}),d},c.argsToArray=function(a,b){return Array.prototype.slice.call(a,b||0)},c.clonePlainObject=function(a,b){var d;b=b||{};for(var e in a)a.hasOwnProperty(e)&&(d=a[e],c.isObject(d)||c.isArray(d)?(b[e]=c.isArray(d)?[]:{},c.clonePlainObject(a[e],b[e])):b[e]=d);return b},c.compareObject=function(a,b){var c;if(this.isEmptyObject(a)!==this.isEmptyObject(b))return!1;if(this.getObjectLength(a)!=this.getObjectLength(b))return!1;for(var d in a)if(a.hasOwnProperty(d)){if(c=a[d],void 0===b[d])return!1;if(this.isObject(c)||this.isArray(c)){if(this.isObject(b[d])!==this.isObject(c))return!1;if(this.isArray(c)!==this.isArray(b[d]))return!1;if(this.compareObject(c,b[d])===!1)return!1}else if(c!=b[d])return!1}return!0},c.getObjectLength=function(a){if(this.isArray(a)||this.isString(a))return a.length;var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},c.isEmptyObject=function(a){if(null==a)return!0;if(this.isArray(a)||this.isString(a))return 0===a.length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},c.loadFile=function(){function a(a,c){try{for(var d,e=0;d=b[e++];)if(d.doc===a&&d.url==(c.src||c.href))return d}catch(f){return null}}var b=[];return function(c,d,e){var f=a(c,d);if(f)return void(f.ready?e&&e():f.funs.push(e));if(b.push({doc:c,url:d.src||d.href,funs:[e]}),!c.body){var g=[];for(var h in d)"tag"!=h&&g.push(h+'="'+d[h]+'"');return void c.write("<"+d.tag+" "+g.join(" ")+" ></"+d.tag+">")}if(!d.id||!c.getElementById(d.id)){var i=c.createElement(d.tag);delete d.tag;for(var h in d)i.setAttribute(h,d[h]);i.onload=i.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(f=a(c,d),f.funs.length>0){f.ready=1;for(var b;b=f.funs.pop();)b()}i.onload=i.onreadystatechange=null}},c.getElementsByTagName("head")[0].appendChild(i)}}}(),c.clone=function(a){return JSON.parse(JSON.stringify(a))},c.comparePlainObject=function(a,b){return JSON.stringify(a)==JSON.stringify(b)},c.encodeHtml=function(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},c.unhtml=function(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},c.cloneArr=function(a){return[].concat(a)},c.clearWhiteSpace=function(a){return a.replace(/[\u200b\t\r\n]/g,"")},c.getValueByIndex=function(a,b){var d=0,e=0;return c.each(a,function(a,c){if(d+c.length>=b){if(b-d==c.length){if(1==c.length&&0===c[0].width)return void d++;e={x:c[c.length-1].x+c[c.length-1].width,y:c[c.length-1].y}}else e=c[b-d];return!1}d+=c.length+(1==c.length&&0===c[0].width?0:1)}),e},c.getNodeIndex=function(a,b){for(var c=a,d=0;c=c.previousSibling;)b&&3==c.nodeType?c.nodeType!=c.nextSibling.nodeType&&d++:d++;return d},c.each(["String","Function","Array","Number","RegExp","Object"],function(a,b){c["is"+b]=function(a){return Object.prototype.toString.apply(a)=="[object "+b+"]"}})}},b[59]={value:function(a,c,d){d.exports=window.kityminder=b.r(60)}},b[60]={value:function(a,c,d){var e={version:b.r(44).version};b.r(58),e.Minder=b.r(44),e.Command=b.r(34),e.Node=b.r(46),b.r(47),b.r(32),e.Event=b.r(38),e.data=b.r(37),b.r(35),e.KeyMap=b.r(40),b.r(54),b.r(55),b.r(48),b.r(53),b.r(39),e.Module=b.r(45),b.r(51),e.Render=b.r(52),e.Connect=b.r(36),e.Layout=b.r(43),e.Theme=b.r(57),e.Template=b.r(56),e.Promise=b.r(50),b.r(31),b.r(49),b.r(49),b.r(67),b.r(68),b.r(69),b.r(70),b.r(71),b.r(72),b.r(73),b.r(74),b.r(75),b.r(76),b.r(77),b.r(78),b.r(79),b.r(80),b.r(81),b.r(82),b.r(83),b.r(84),b.r(85),b.r(86),b.r(87),b.r(88),b.r(89),b.r(90),b.r(91),b.r(92),b.r(93),b.r(94),b.r(95),b.r(99),b.r(96),b.r(98),b.r(97),b.r(65),b.r(61),b.r(62),b.r(63),b.r(64),b.r(66),b.r(106),b.r(109),b.r(108),b.r(107),b.r(109),b.r(111),b.r(110),b.r(24),b.r(25),b.r(26),b.r(27),b.r(28),b.r(29),b.r(30),b.r(100),b.r(104),b.r(101),b.r(103),b.r(102),b.r(105),d.exports=e}},b[61]={value:function(a,c,d){function e(a){function b(a){var b=[],d=a.getLayoutBox(),e=5;return"x"==c?(b.push({type:"up",node:a,area:new f.Box({x:d.x,y:d.top-a.getStyle("margin-top")-e,width:d.width,height:a.getStyle("margin-top")}),path:["M",d.x,d.top-e,"L",d.right,d.top-e]}),b.push({type:"down",node:a,area:new f.Box({x:d.x,y:d.bottom+e,width:d.width,height:a.getStyle("margin-bottom")}),path:["M",d.x,d.bottom+e,"L",d.right,d.bottom+e]})):(b.push({type:"up",node:a,area:new f.Box({x:d.left-a.getStyle("margin-left")-e,y:d.top,width:a.getStyle("margin-left"),height:d.height}),path:["M",d.left-e,d.top,"L",d.left-e,d.bottom]}),b.push({type:"down",node:a,area:new f.Box({x:d.right+e,y:d.top,width:a.getStyle("margin-right"),height:d.height}),path:["M",d.right+e,d.top,"L",d.right+e,d.bottom]})),b}var c="left"==a||"right"==a?"x":"y",d="left"==a||"top"==a?-1:1,e={left:"right",right:"left",top:"bottom",bottom:"top",x:"y",y:"x"};g.register(a,f.createClass({base:g,doLayout:function(b,g){var h=b.getContentBox();if("x"==c?(b.setVertexOut(new f.Point(h[a],h.cy)),b.setLayoutVectorOut(new f.Vector(d,0))):(b.setVertexOut(new f.Point(h.cx,h[a])),b.setLayoutVectorOut(new f.Vector(0,d))),!g.length)return!1;g.forEach(function(b){var g=b.getContentBox();b.setLayoutTransform(new f.Matrix),"x"==c?(b.setVertexIn(new f.Point(g[e[a]],g.cy)),b.setLayoutVectorIn(new f.Vector(d,0))):(b.setVertexIn(new f.Point(g.cx,g[e[a]])),b.setLayoutVectorIn(new f.Vector(0,d)))}),this.align(g,e[a]),this.stack(g,e[c]);var i=this.getBranchBox(g),j=0,k=0;"x"==c?(j=h[a],j+=d*b.getStyle("margin-"+a),j+=d*g[0].getStyle("margin-"+e[a]),k=h.bottom,k-=h.height/2,k-=i.height/2,k-=i.y):(j=h.right,j-=h.width/2,j-=i.width/2,j-=i.x,k=h[a],k+=d*b.getStyle("margin-"+a),k+=d*g[0].getStyle("margin-"+e[a])),this.move(g,j,k)},getOrderHint:b}))}var f=b.r(42),g=b.r(43);["left","right","top","bottom"].forEach(e)}},b[62]={value:function(a,c,d){function e(a){var b="filetree-"+(a>0?"down":"up");g.register(b,f.createClass({base:g,doLayout:function(b,c,d){var e=b.getContentBox(),g=20;if(b.setVertexOut(new f.Point(e.left+g,a>0?e.bottom:e.top)),b.setLayoutVectorOut(new f.Vector(0,a)),c.length){c.forEach(function(a){var b=a.getContentBox();a.setLayoutTransform(new f.Matrix),a.setVertexIn(new f.Point(b.left,b.cy)),a.setLayoutVectorIn(new f.Vector(1,0))}),this.align(c,"left"),this.stack(c,"y");var h=0;h+=e.left,h+=g,h+=c[0].getStyle("margin-left");var i=0;a>0?(i+=e.bottom,i+=b.getStyle("margin-bottom"),i+=c[0].getStyle("margin-top")):(i-=this.getTreeBox(c).bottom,i+=e.top,i-=b.getStyle("margin-top"),i-=c[0].getStyle("margin-bottom")),this.move(c,h,i)}},getOrderHint:function(a){var b=[],c=a.getLayoutBox(),d=a.getLevel()>1?3:5;return b.push({type:"up",node:a,area:new f.Box({x:c.x,y:c.top-a.getStyle("margin-top")-d,width:c.width,height:a.getStyle("margin-top")}),path:["M",c.x,c.top-d,"L",c.right,c.top-d]}),b.push({type:"down",node:a,area:new f.Box({x:c.x,y:c.bottom+d,width:c.width,height:a.getStyle("margin-bottom")}),path:["M",c.x,c.bottom+d,"L",c.right,c.bottom+d]}),b}}))}var f=b.r(42),g=b.r(43);[-1,1].forEach(e)}},b[63]={value:function(a,c,d){var e=b.r(42),f=b.r(43);f.register("fish-bone-master",e.createClass("FishBoneMasterLayout",{base:f,doLayout:function(a,b,c){var d=[],f=[],g=b[0],h=a.getContentBox();if(a.setVertexOut(new e.Point(h.right,h.cy)),a.setLayoutVectorOut(new e.Vector(1,0)),g){var i=(g.getContentBox(),a.getStyle("margin-right")),j=g.getStyle("margin-left"),k=g.getStyle("margin-top"),l=g.getStyle("margin-bottom");b.forEach(function(a,b){a.setLayoutTransform(new e.Matrix);var c=a.getContentBox();b%2?(f.push(a),a.setVertexIn(new e.Point(c.left,c.top)),a.setLayoutVectorIn(new e.Vector(1,1))):(d.push(a),a.setVertexIn(new e.Point(c.left,c.bottom)),a.setLayoutVectorIn(new e.Vector(1,-1)))}),this.stack(d,"x"),this.stack(f,"x"),this.align(d,"bottom"),this.align(f,"top");var m=h.right+i+j,n=h.cy-l-a.getStyle("margin-top"),o=h.cy+k+a.getStyle("margin-bottom");this.move(d,m,n),this.move(f,m+j,o)}}}))}},b[64]={value:function(a,c,d){var e=b.r(42),f=b.r(43);f.register("fish-bone-slave",e.createClass("FishBoneSlaveLayout",{base:f,doLayout:function(a,b,c){var d=this,f=Math.abs,g=.382,h=a.getContentBox(),i=a.getLayoutVectorIn();a.setLayoutVectorOut(i);var j=h.left+h.width*g,k=new e.Point(j,i.y>0?h.bottom:h.top);a.setVertexOut(k);var l=b[0];if(l){var m=l.getContentBox();b.forEach(function(a,b){a.setLayoutTransform(new e.Matrix),a.setLayoutVectorIn(new e.Vector(1,0)),a.setVertexIn(new e.Point(m.left,m.cy))}),this.stack(b,"y"),this.align(b,"left");var n=0,o=0;n+=k.x,a.getLayoutVectorOut().y<0?(o-=this.getTreeBox(b).bottom,o+=a.getContentBox().top,o-=a.getStyle("margin-top"),o-=l.getStyle("margin-bottom")):(o+=a.getContentBox().bottom,o+=a.getStyle("margin-bottom"),o+=l.getStyle("margin-top")),this.move(b,n,o),2==c&&b.forEach(function(a){var b=a.getLayoutTransform(),c=a.getContentBox(),g=b.transformPoint(new e.Point(c.left,0));d.move([a],f(g.y-k.y),0)})}}}))}},b[65]={value:function(a,c,d){var e=b.r(42),f=b.r(43),g=b.r(44);f.register("mind",e.createClass({base:f,doLayout:function(a,b){var c=Math.ceil(a.children.length/2),d=[],f=[];b.forEach(function(a){a.getIndex()<c?d.push(a):f.push(a)});var h=g.getLayoutInstance("left"),i=g.getLayoutInstance("right");h.doLayout(a,f),i.doLayout(a,d);var j=a.getContentBox();a.setVertexOut(new e.Point(j.cx,j.cy)),a.setLayoutVectorOut(new e.Vector(0,0))},getOrderHint:function(a){var b=[],c=a.getLayoutBox(),d=5;return b.push({type:"up",node:a,area:new e.Box({x:c.x,y:c.top-a.getStyle("margin-top")-d,width:c.width,height:a.getStyle("margin-top")}),path:["M",c.x,c.top-d,"L",c.right,c.top-d]}),b.push({type:"down",node:a,area:new e.Box({x:c.x,y:c.bottom+d,width:c.width,height:a.getStyle("margin-bottom")}),path:["M",c.x,c.bottom+d,"L",c.right,c.bottom+d]}),b}}))}},b[66]={value:function(a,c,d){var e=b.r(42),f=b.r(43);b.r(44);f.register("tianpan",e.createClass({base:f,doLayout:function(a,b){if(0!=b.length){var c,d,f,g=this,h=a.getContentBox(),i=5,j=Math.max(h.width,50);b.forEach(function(a,b){a.setLayoutTransform(new e.Matrix),f=g.getTreeBox(a),j=Math.max(Math.max(f.width,f.height),j)}),j=j/1.5/Math.PI,b.forEach(function(a,b){c=j*(Math.cos(i)+Math.sin(i)*i),d=j*(Math.sin(i)-Math.cos(i)*i),i+=.9-.02*b,a.setLayoutVectorIn(new e.Vector(1,0)),a.setVertexIn(new e.Point(h.cx,h.cy)),a.setLayoutTransform(new e.Matrix),g.move([a],c,d)})}},getOrderHint:function(a){var b=[],c=a.getLayoutBox(),d=5;return b.push({type:"up",node:a,area:{x:c.x,y:c.top-a.getStyle("margin-top")-d,width:c.width,height:a.getStyle("margin-top")},path:["M",c.x,c.top-d,"L",c.right,c.top-d]}),b.push({type:"down",node:a,area:{x:c.x,y:c.bottom+d,width:c.width,height:a.getStyle("margin-bottom")},path:["M",c.x,c.bottom+d,"L",c.right,c.bottom+d]}),b}}))}},b[67]={value:function(a,c,d){function e(a,b){return a.getIndex()-b.getIndex()}function f(a,b){return-e(a,b)}var g=b.r(42),h=b.r(46),i=b.r(34),j=b.r(45);g.extendClass(h,{arrange:function(a){var b=this.parent;if(b){var c=b.children;if(!(0>a||a>=c.length))return c.splice(this.getIndex(),1),c.splice(a,0,this),this}}});var k=g.createClass("ArrangeUpCommand",{base:i,execute:function(a){var b=a.getSelectedNodes();b.sort(e);var c=b.map(function(a){return a.getIndex()});b.forEach(function(a,b){a.arrange(c[b]-1)}),a.layout(300)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),l=g.createClass("ArrangeUpCommand",{base:i,execute:function(a){var b=a.getSelectedNodes();b.sort(f);var c=b.map(function(a){return a.getIndex()});b.forEach(function(a,b){a.arrange(c[b]+1)}),a.layout(300)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),m=g.createClass("ArrangeCommand",{base:i,execute:function(a,b){var c=a.getSelectedNodes().slice();if(c.length){var d=h.getCommonAncestor(c);if(d==c[0].parent){var e=c.map(function(a){return{index:a.getIndex(),node:a}}),f=Math.min.apply(Math,e.map(function(a){return a.index}))>=b;e.sort(function(a,b){return f?b.index-a.index:a.index-b.index}),e.forEach(function(a){a.node.arrange(b)}),a.layout(300)}}},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}});j.register("ArrangeModule",{commands:{arrangeup:k,arrangedown:l,arrange:m},contextmenu:[{command:"arrangeup"},{command:"arrangedown"},{divider:!0}],commandShortcutKeys:{arrangeup:"normal::alt+Up",arrangedown:"normal::alt+Down"}})}},b[68]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45),h=b.r(92);g.register("basestylemodule",function(){function a(a,b){return a.getData(b)||a.getStyle(b)}var b=this;return h.registerStyleHook(function(b,c){var d=a(b,"font-weight"),e=a(b,"font-style");[d,e].join("/");c.eachItem(function(a,b){b.setFont({weight:d,style:e})})}),{commands:{bold:e.createClass("boldCommand",{base:f,execute:function(a){var b=a.getSelectedNodes();b.forEach(1==this.queryState("bold")?function(a){a.setData("font-weight").render()}:function(a){a.setData("font-weight","bold").render()}),a.layout()},queryState:function(){var a=b.getSelectedNodes(),c=0;return 0===a.length?-1:(a.forEach(function(a){return a&&a.getData("font-weight")?(c=1,!1):void 0}),c)}}),italic:e.createClass("italicCommand",{base:f,execute:function(a){var b=a.getSelectedNodes();b.forEach(1==this.queryState("italic")?function(a){a.setData("font-style").render()}:function(a){a.setData("font-style","italic").render()}),a.layout()},queryState:function(){var a=b.getSelectedNodes(),c=0;return 0===a.length?-1:(a.forEach(function(a){return a&&a.getData("font-style")?(c=1,!1):void 0}),c)}})},commandShortcutKeys:{bold:"ctrl+b",italic:"ctrl+i"}}})}},b[69]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(46)),g=b.r(34),h=b.r(45);h.register("ClipboardModule",function(){function a(b,d){h.push(d),c.appendNode(d,b),d.render(),d.setLayoutOffset(null);for(var e,f=d.children.map(function(a){return a.clone()}),g=0;e=f[g];g++)a(d,e)}function b(a){a.length&&(a.sort(function(a,b){return a.getIndex()-b.getIndex()}),d=a.map(function(a){return a.clone()}))}var c=this,d=[],h=[],i=e.createClass("CopyCommand",{base:g,execute:function(a){b(a.getSelectedAncestors(!0)),this.setContentChanged(!1)}}),j=e.createClass("CutCommand",{base:g,execute:function(a){var c=a.getSelectedAncestors();0!==c.length&&(b(c),a.select(f.getCommonAncestor(c),!0),c.slice().forEach(function(b){a.removeNode(b)}),a.layout(300))}}),k=e.createClass("PasteCommand",{base:g,execute:function(b){if(d.length){var c=b.getSelectedNode();if(!c)return;for(var e,f=0;e=d[f];f++)a(c,e.clone());b.select(h,!0),h=[],b.layout(300)}},queryState:function(a){return a.getSelectedNode()?0:-1}});return{commands:{copy:i,cut:j,paste:k},commandShortcutKeys:{copy:"normal::ctrl+c|",cut:"normal::ctrl+x",paste:"normal::ctrl+v"}}})}},b[70]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(46)),g=b.r(34),h=b.r(45),i=e.createClass("MoveToParentCommand",{base:g,execute:function(a,b,c){for(var d,e=b.length-1;e>=0;e--)d=b[e],d.parent&&(d.parent.removeChild(d),c.appendChild(d),d.render());c.expand(),a.select(b,!0)}}),j=e.createClass("DropHinter",{base:e.Group,constructor:function(){this.callBase(),this.rect=new e.Rect,this.addShape(this.rect)},render:function(a){this.setVisible(!!a),a&&(this.rect.setBox(a.getLayoutBox()).setRadius(a.getStyle("radius")||0).stroke(a.getStyle("drop-hint-color")||"yellow",a.getStyle("drop-hint-width")||2),this.bringTop())}}),k=e.createClass("OrderHinter",{base:e.Group,constructor:function(){this.callBase(),this.area=new e.Rect,this.path=new e.Path,this.addShapes([this.area,this.path])},render:function(a){this.setVisible(!!a),a&&(this.area.setBox(a.area),this.area.fill(a.node.getStyle("order-hint-area-color")||"rgba(0, 255, 0, .5)"),this.path.setPathData(a.path),this.path.stroke(a.node.getStyle("order-hint-path-color")||"#0f0",a.node.getStyle("order-hint-path-width")||1))}}),l=e.createClass("TreeDragger",{constructor:function(a){this._minder=a,this._dropHinter=new j,this._orderHinter=new k,a.getRenderContainer().addShapes([this._dropHinter,this._orderHinter])},dragStart:function(a){this._startPosition=a},dragMove:function(a){var b=10;if(this._startPosition){var c=e.Vector.fromPoints(this._dragPosition||this._startPosition,a),d=this._minder;if(this._dragPosition=a,!this._dragMode){if(e.Vector.fromPoints(this._dragPosition,this._startPosition).length()<b)return;if(!this._enterDragMode())return}for(var f=0;f<this._dragSources.length;f++)this._dragSources[f].setLayoutOffset(this._dragSources[f].getLayoutOffset().offset(c)),d.applyLayoutResult(this._dragSources[f]);this._dropTest()?this._renderOrderHint(this._orderSucceedHint=null):this._orderTest()}},dragEnd:function(){if(this._startPosition=null,this._dragPosition=null,this._dragMode){if(this._fadeDragSources(1),this._dropSucceedTarget)this._dragSources.forEach(function(a){a.setLayoutOffset(null)}),this._minder.layout(-1),this._minder.execCommand("movetoparent",this._dragSources,this._dropSucceedTarget);else if(this._orderSucceedHint){var a=this._orderSucceedHint,b=a.node.getIndex(),c=this._dragSources.map(function(a){return a.setLayoutOffset(null),a.getIndex()}),d=Math.max.apply(Math,c),e=Math.min.apply(Math,c);e>b&&"down"==a.type&&b++,b>d&&"up"==a.type&&b--,a.node.setLayoutOffset(null),this._minder.execCommand("arrange",b),this._renderOrderHint(null)}else this._minder.fire("savescene");this._minder.layout(300),this._leaveDragMode(),this._minder.fire("contentchange")}},_enterDragMode:function(){return this._calcDragSources(),this._dragSources.length?(this._fadeDragSources(.5),this._calcDropTargets(),this._calcOrderHints(),this._dragMode=!0,this._minder.setStatus("dragtree"),!0):(this._startPosition=null,!1)},_calcDragSources:function(){this._dragSources=this._minder.getSelectedAncestors()},_fadeDragSources:function(a){var b=this._minder;this._dragSources.forEach(function(c){c.getRenderContainer().setOpacity(a,200),c.traverse(function(c){1>a?b.detachNode(c):b.attachNode(c)},!0)})},_calcDropTargets:function(){function a(b,c){var d,e=[];return e.push(c),c.getChildren().forEach(function(c){for(d=0;d<b.length;d++)if(b[d]==c)return;e=e.concat(a(b,c))}),e}this._dropTargets=a(this._dragSources,this._minder.getRoot()),this._dropTargetBoxes=this._dropTargets.map(function(a){return a.getLayoutBox()})},_calcOrderHints:function(){var a=this._dragSources,b=f.getCommonAncestor(a);if(b==a[0]&&(b=a[0].parent),0===a.length||b!=a[0].parent)return void(this._orderHints=[]);var c=b.children;this._orderHints=c.reduce(function(b,c){return-1==a.indexOf(c)&&(b=b.concat(c.getOrderHint())),b},[])},_leaveDragMode:function(){this._dragMode=!1,this._dropSucceedTarget=null,this._orderSucceedHint=null,this._renderDropHint(null),this._renderOrderHint(null),this._minder.rollbackStatus()},_drawForDragMode:function(){this._text.setContent(this._dragSources.length+" items"),this._text.setPosition(this._startPosition.x,this._startPosition.y+5),this._minder.getRenderContainer().addShape(this)},_boxTest:function(a,b,c){var d,e,f,g,h,i=this._dragSources.map(function(a){return a.getLayoutBox()});for(c=c||function(a,b,c){return a&&!a.isEmpty()},d=0;d<a.length;d++)for(f=a[d],h=b.call(this,f,d),e=0;e<i.length;e++){g=i[e];var j=g.intersect(h);if(c(j,g,h))return f}return null},_dropTest:function(){return this._dropSucceedTarget=this._boxTest(this._dropTargets,function(a,b){return this._dropTargetBoxes[b]},function(a,b,c){function d(a){return a.width*a.height}return a?d(a)>.5*Math.min(d(b),d(c))?!0:a.width+1>=Math.min(b.width,c.width)?!0:a.height+1>=Math.min(b.height,c.height)?!0:!1:!1}),this._renderDropHint(this._dropSucceedTarget),!!this._dropSucceedTarget},_orderTest:function(){return this._orderSucceedHint=this._boxTest(this._orderHints,function(a){return a.area}),this._renderOrderHint(this._orderSucceedHint),!!this._orderSucceedHint},_renderDropHint:function(a){this._dropHinter.render(a)},_renderOrderHint:function(a){this._orderHinter.render(a)},preventDragMove:function(){this._startPosition=null}});h.register("DragTree",function(){var a;return{init:function(){a=new l(this),window.addEventListener("mouseup",function(){a.dragEnd()})},events:{"normal.mousedown inputready.mousedown":function(b){b.originEvent.button||b.getTargetNode()&&b.getTargetNode()!=this.getRoot()&&a.dragStart(b.getPosition())},"normal.mousemove dragtree.mousemove":function(b){a.dragMove(b.getPosition())},"normal.mouseup dragtree.beforemouseup":function(b){a.dragEnd(),b.preventDefault()},statuschange:function(b){"textedit"==b.lastStatus&&"normal"==b.currentStatus&&a.preventDragMove()}},commands:{movetoparent:i}}})}},b[71]={value:function(a,c,d){var e=(b.r(42),b.r(45)),f=b.r(33),g=b.r(40),h=b.r(44);e.register("TextEditModule",function(){function a(a){if(a&&b.isSingleSelect()&&a.isSelected()){a.getTextGroup().setStyle("cursor","default");var g=a.getStyle("text-selection-color");if(e.updateByMinderNode(a),c.setHide().setStartOffset(0).setEndOffset(e.getTxtOfContainer().length).setColor(g),e.updateContainerRangeBySel(),f.ie)var h=setInterval(function(){var a=d.nativeSel.getRangeAt(0);!a||a.collapsed?d.select():clearInterval(h)});b.setStatus("inputready")}}var b=this,c=new h.Selection,d=new h.Range,e=new h.Receiver(this,c,d);new h.keyboarder(e);this.receiver=e;var i,j,k,l,m=!1,n=!1,o=!1;return b.textEditNode=function(c){a(c),b.setStatus("textedit"),e.updateSelection()},{events:{ready:function(){document.body.appendChild(e.container)},"normal.beforemousedown textedit.beforemousedown inputready.beforemousedown":function(a){if(a.isRightMB())return void(a.getTargetNode()||this.setStatus("normal"));m=!0,o=c.isShow(),c.setHide();var f=a.getTargetNode();if(!f){var g=a.kityEvent.targetShape;g&&"Selection"==g.getType()&&(f=e.getMinderNode(),a.stopPropagationImmediately())}if(f&&this.isSingleSelect()&&f.isSelected()){l=f,i=f;var h=f.getTextGroup();return c.collapse(!0),c.setColor(f.getStyle("text-selection-color")),e.updateByMinderNode(f).updateIndexByMouse(a.getPosition(f.getRenderContainer())).setRange(d).setReady(),void(o&&(c.setShowStatus(),clearTimeout(k),k=setTimeout(function(){return n?void(n=!1):(c.collapse(!0).updatePosition(e.getOffsetByIndex()).setShow(),void h.setStyle("cursor","text"))},200),b.setStatus("textedit")))}e.clearReady(),e.clear(),l&&l.getTextGroup().setStyle("cursor","default")},"inputready.keyup":function(){c.isHide()&&a(this.getSelectedNode())},"normal.keyup":function(b){var d=this.getSelectedNode(),e=b.getKeyCode();if(d&&this.isSingleSelect()&&d.isSelected()&&!c.isShow()){var f=b.originEvent;!g.isSelectedNodeKey[e]||f.ctrlKey||f.metaKey||f.shiftKey||f.altKey||a(d)}},"normal.mouseup textedit.mouseup inputready.mouseup":function(d){m=!1;var g=d.getTargetNode();return i=null,g&&!o&&e.isReady()?(c.collapse(!0),c.setColor(g.getStyle("text-selection-color")),f.ipad&&e.focus(),clearTimeout(j),j=setTimeout(function(){return n?void(n=!1):(c.collapse(!0).updatePosition(e.getOffsetByIndex()).setShow(),void g.getTextGroup().setStyle("cursor","text"))},200),void b.setStatus("textedit")):void(c.isHide()?a(d.getTargetNode()):c.collapsed||e.updateContainerRangeBySel())},"textedit.beforemousemove inputready.beforemousemove":function(a){if(!f.ipad)if(m&&e.isReady()&&o){if(a.stopPropagationImmediately(),i){var c=a.getPosition(i.getRenderContainer());e.updateSelectionByMousePosition(c).updateSelection(c),setTimeout(function(){e.updateContainerRangeBySel()})}}else m&&!o&&(b.setStatus("normal"),e.clearReady())},"normal.dblclick textedit.dblclick inputready.dblclick":function(c){var d=c.getTargetNode();n=!0,d&&(a(d),b.setStatus("textedit"),e.updateSelection())},restoreScene:function(){e.clear(),a(this.getSelectedNode())},stopTextEdit:function(){e.clear(),b.setStatus("normal")},resize:function(a){c.setHide()},execCommand:function(d){var f={appendchildnode:1,appendsiblingnode:1,editnode:1};return f[d.commandName]?(a(b.getSelectedNode()),void e.updateSelection()):void(c.isShow()&&e.updateTextOffsetData().updateSelection())},layoutfinish:function(a){a.node!==e.minderNode||"textedit"!=this.getStatus()&&"inputready"!=this.getStatus()||e.setContainerStyle()},selectionclear:function(){var c=b.getSelectedNode();c?a(c):(b.setStatus("normal"),e.clear())},blur:function(){!/\?debug#?/.test(location.href)&&e.clear()},"textedit.import":function(){b.setStatus("normal"),e.clear()},"inputready.mousewheel textedit.mousewheel":function(){e.setContainerStyle()},statuschange:function(a){"textedit"==a.lastStatus&&this.fire("contentchange")}}}})}},b[72]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(33),h=b.r(40),i=b.r(44);i.keyboarder=e.createClass("keyboarder",function(){return{constructor:function(a){this.re=a,this.container=a.container,this.selection=a.selection,this.range=a.range,this.km=a.km,this.lastMinderNode=null,this.isTypeText=!1,this._initEvent(),this.isShortcutCopyKey=!1},_initEvent:function(){var a=this;g.ipad&&f.listen(this.container,"keydown keypress keyup input",function(b){a._handleEvents.call(a,new MinderEvent("keyup"==b.type?"beforekeyup":b.type,b)),"keyup"==b.type&&"normal"==a.km.getStatus()&&a.km.fire("keyup",b)}),this.km.on("inputready.beforekeyup inputready.beforekeydown textedit.beforekeyup normal.keydown normal.keyup textedit.beforekeydown textedit.keypress textedit.paste",f.proxy(this._handleEvents,this))},_handleEvents:function(a){switch(a.type){case"input":this._input(a);break;case"beforekeydown":this._beforeKeydown(a);break;case"beforekeyup":this._beforeKeyup(a);break;case"keyup":this._keyup(a)}},_setTextToContainer:function(a,b){var c=this;if(c.minderNode=c.re.minderNode,clearTimeout(c.timer),c.range.hasNativeRange()&&(!h.controlKeys[a]||b)){c.lastMinderNode===c.minderNode||h.notContentChange[a]||(c.km.fire("saveScene",{inputStatus:!0}),c.lastMinderNode=c.minderNode);var d=c.re.getTxtOfContainer();c.minderNode.setText(d),c.re.setContainerStyle(),c.minderNode.getRenderContainer().bringTop(),c.minderNode.render(),h.notContentChange[a]||(clearTimeout(c.inputTextTimer),c.inputTextTimer=setTimeout(function(){c.km.layout(300)},300)),c.re.updateTextOffsetData().updateRange().updateSelectionByRange(),c.selection.updateOffsetByTextData(c.re.textData).updatePosition(),"inputready"!=c.km.getStatus()&&c.selection.setHoldShow(),c.timer=setTimeout(function(){c.selection.isShow()&&c.selection.setShow()},200),c.km.setStatus("textedit")}},_input:function(){var a=this;g.ipad&&setTimeout(function(){a._setTextToContainer()})},_beforeKeydown:function(a){var b=this,c=a.originEvent,d=c.keyCode;switch(this.isTypeText=229==d||0===d,d){case h.Enter:if(a.originEvent.shiftKey&&b.selection.isShow())return b._handlerEnterkey(),a.preventDefault(),!1;case h.Tab:case h.Insert:return void(this.selection.isShow()?(this.re.clear(),this.km.setStatus("inputready"),clearTimeout(b.inputTextTimer),a.preventDefault()):(this.km.setStatus("normal"),this.km.fire("contentchange")));case h.left:case h.right:case h.up:case h.down:case h.Backspace:case h.Del:case h["/"]:case h.F2:case h.Insert:if(this.selection.isHide())return void this.km.setStatus("normal");break;case h.Control:case h.Alt:case h.Cmd:if(this.selection.isHide()&&"textedit"!=this.km.getStatus()&&"inputready"!=this.km.getStatus())return void this.km.setStatus("normal")}if(a.originEvent.ctrlKey||a.originEvent.metaKey){if(this.selection.isHide()&&{86:1,88:1,67:1}[d])return this.isShortcutCopyKey=!0,void this.km.setStatus("normal");if(d==h.v)return void setTimeout(function(){b.range.updateNativeRange().insertNode($("<span>$_kityminder_bookmark_$</span>")[0]);var a=[];f.each(b.container.getElementsByTagName("br"),function(b,c){a.push(c)}),f.each(a,function(a,b){var c=document.createTextNode("\n");b.parentNode.insertBefore(c,b),b.parentNode.removeChild(b)});var c=b.container.textContent.replace(/[\u200b\t\r]/g,""),e=c.indexOf("$_kityminder_bookmark_$");b.re.setContainerTxt(c.replace("$_kityminder_bookmark_$","")),b.range.setStartOffset(e).collapse(!0).select(),b._setTextToContainer(d)},50);if(d==h.x)return void setTimeout(function(){b._setTextToContainer(d)},50)}this.isShortcutCopyKey=!1,b._setTextToContainer(d)},_beforeKeyup:function(a){var b=this,c=a.originEvent,d=c.keyCode;switch(d){case h.Enter:case h.Tab:case h.Insert:case h.F2:return g.ipad?void(this.selection.isShow()?(this.re.clear(),this.km.setStatus("inputready"),clearTimeout(b.inputTextTimer),a.preventDefault()):(this.km.setStatus("normal"),this.km.fire("contentchange"))):(h.Enter==d&&(this.isTypeText||g.mac&&g.gecko)&&b._setTextToContainer(d,!0),this.re.keydownNode===this.re.minderNode&&(this.km.rollbackStatus(),this.re.clear()),void a.preventDefault());case h.Del:case h.Backspace:case h.Spacebar:return g.ipad&&this.selection.isHide()?void this.km.setStatus("normal"):void b._setTextToContainer(d,!0)}return this.isTypeText?void b._setTextToContainer(d,!0):g.mac&&g.gecko?void b._setTextToContainer(d,!0):(b._setTextToContainer(d,!0),!0)},_keyup:function(a){var b,c=this,d=this.km.getSelectedNode();if("normal"==this.km.getStatus()&&d&&this.selection.isHide()){if(this.isShortcutCopyKey)return;d&&this.km.isSingleSelect()&&d.isSelected()&&(this.re.updateByMinderNode(d),this.selection.setHide().setStartOffset(0).setEndOffset(this.re.getTxtOfContainer().length).setColor(d.getStyle("text-selection-color")),
setTimeout(function(){c.re.updateContainerRangeBySel()}),g.ie&&(b=setInterval(function(){var a=c.range.nativeSel.getRangeAt(0);!a||a.collapsed?c.range.select():clearInterval(b)})),this.km.setStatus("inputready"))}},_handlerEnterkey:function(){function a(a){a&&3==a.nodeType&&0===a.nodeValue.length&&a.parentNode.removeChild(a)}var b=this.range,c=document.createElement("br"),d=this;b.collapsed||b.deleteContents(),b.insertNode(c),a(c.previousSibling),a(c.nextSibling),b.setStartAfter(c),b.collapse(!0);var e=b.startContainer.childNodes[b.startOffset];e||(c=c.cloneNode(!1),b.startContainer.appendChild(c),b.setStartBefore(c),b.collapse(!0)),b.select(),d._setTextToContainer(h.Enter)}}}())}},b[73]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44);g.Range=e.createClass("Range",function(){function a(a,b){var c=a[b+"Container"],d=a[b+"Offset"],e=0;return 1==c.nodeType&&(c=c.childNodes[d],!c&&a.startContainer&&"DIV"==a.startContainer.nodeName?(a.startContainer.innerHTML="<p></p>",d=0):3==c.nodeType&&(d=0)),f.each(a.container.childNodes,function(a,b){return b===c?1==b.nodeType?!1:(e+=d,!1):void(e+=1==b.nodeType?1:f.clearWhiteSpace(b.nodeValue).length)}),e}function b(a,b,c){var d=0,e=a.container;f.each(e.childNodes,function(g,h){if(1==h.nodeType)return d==b?(a["set"+c](e,g),!1):void d++;var i=f.clearWhiteSpace(h.nodeValue).length;return d+i>=b?(a["set"+c](h,b-d),!1):void(d+=i)})}return{constructor:function(a){this.nativeRange=document.createRange(),this.nativeSel=window.getSelection(),this.startContainer=this.endContainer=this.startOffset=this.endOffset=null,this.collapsed=!1,this.container=a||null},hasNativeRange:function(){return 0!==this.nativeSel.rangeCount},deleteContents:function(){return this.nativeRange.deleteContents(),this._updateBoundary()},select:function(){var a=this.nativeRange.startContainer;if(1==a.nodeType&&0===a.childNodes.length){var b=document.createTextNode("​");a.appendChild(b),this.nativeRange.setStart(b,1),this.nativeRange.collapse(!0)}else this.collapsed&&1==a.nodeType&&(a=a.childNodes[this.startOffset],a&&3==a.nodeType&&0===a.nodeValue.length&&(this.nativeRange.setStart(a,1),this.nativeRange.collapse(!0)));try{this.nativeSel.removeAllRanges()}catch(c){}return this.nativeSel.addRange(this.nativeRange),this},_updateBoundary:function(){var a=this.nativeRange;return this.startContainer=a.startContainer,this.startContainer=a.startContainer,this.endContainer=a.endContainer,this.startOffset=a.startOffset,this.endOffset=a.endOffset,this.collapsed=a.collapsed,this},setStartOffset:function(a){return b(this,a,"Start"),this},setEndOffset:function(a){return b(this,a,"End"),this},setStart:function(a,b){return this.nativeRange.setStart(a,b),this._updateBoundary(),this},setStartAfter:function(a){return this.setStart(a.parentNode,f.getNodeIndex(a)+1)},setStartBefore:function(a){return this.setStart(a.parentNode,f.getNodeIndex(a))},setEnd:function(a,b){return this.nativeRange.setEnd(a,b),this._updateBoundary(),this},update:function(){return this.updateNativeRange()._updateBoundary(),this},getStart:function(){return this.update(),{startContainer:this.startContainer,startOffset:this.startOffset}},getStartOffset:function(){return a(this,"start")},getEndOffset:function(){return a(this,"end")},collapse:function(a){return this.nativeRange.collapse(a===!0),this._updateBoundary(),this},isCollapsed:function(){return this._updateBoundary(),this.collapsed},insertNode:function(a){return this.nativeRange.insertNode(a),this._updateBoundary()},updateNativeRange:function(){return this.nativeRange=this.nativeSel.getRangeAt(0),this},clear:function(){return this.nativeSel.removeAllRanges(),this}}}())}},b[74]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(33),h=b.r(44);h.Receiver=e.createClass("Receiver",{clear:function(){return this.container.innerHTML="",this.selection&&this.selection.setHide(),this.range&&this.range.clear(),this.index=0,this},constructor:function(a,b,c){this.setKityMinder(a);var d=document.createElement("div");d.setAttribute("contenteditable",!0),d.className="km_receiver",this.container=d,f.addCssRule("km_receiver_css"," .km_receiver{white-space:nowrap;position:absolute;padding:0;margin:0;word-wrap:break-word;"+(/\?debug#?/.test(location.href)?"":"clip:rect(1em 1em 1em 1em);")),this.index=0,this.selection=b,this.range=c,this.range.container=d},setRange:function(a,b){this.index=b||this.index,this.range=a,a.setStartOffset(this.index),a.collapse(!0);var c=this;return setTimeout(function(){c.container.focus(),a.select()}),this},setTextGroup:function(a){return this.textGroup=a,this},setKityMinder:function(a){return this.km=a,this},updateByMinderNode:function(a){return this.setMinderNode(a),this._addSelection(),this.setTextGroup(a.getTextGroup()),this.setContainerStyle(),this.updateTextOffsetData(),this.setSelectionHeight(),this.setContainerTxt(),this},setMinderNode:function(a){return this.minderNode=a,this.selection.setMinderNode(a),this},_addSelection:function(){return this.selection.container&&this.selection.remove(),this.minderNode.getRenderContainer().addShape(this.selection),this},getMinderNode:function(){return this.minderNode},updateIndex:function(){return this.index=this.range.getStartOffset(),this},setSelection:function(a){return this.selection=a,this},updateSelection:function(a){return this.selection.update(this.textData,a),this},getOffsetByIndex:function(a){return f.getValueByIndex(this.textData,void 0!==a?a:this.index)},getBaseOffset:function(){var a=this.textGroup.getRenderBox("screen");return a},setContainerStyle:function(){var a=this.getBaseOffset();return this.container.style.cssText=";left:"+(g.ipad?"-":"")+a.x+"px;top:"+(a.y+(/\?debug#?/.test(location.href)?this.textGroup.getItems().length*this.getlineHeight():0))+"px;width:"+a.width+"px;height:"+a.height+"px;",this},updateTextOffsetData:function(){var a,b=this,c=this.minderNode.getData("font-size")||this.minderNode.getStyle("font-size"),d=this.minderNode.getStyle("line-height")*c,e=(b.textGroup.getShapes().length*d-(d-c))/2;return this.textData=[],b.textGroup.eachItem(function(c,f){b.textData[c]=[];for(var g=c*d+1,h=f.getContent(),i=0,j=h.length;j>i;i++){try{a=f.getExtentOfChar(i)}catch(k){console.log(k)}b.textData[c].push({x:a.x,y:g-e,width:a.width,height:a.height})}0===h.length&&b.textData[c].push({x:0,y:g-e,width:0,height:d})}),this},getlineHeight:function(){return this.minderNode.getStyle("line-height")*(this.minderNode.getData("font-size")||this.minderNode.getStyle("font-size"))},updateIndexByMouse:function(a){var b=this;b.updateTextOffsetData(),this.index=0;var c=this.getlineHeight();return f.each(this.textData,function(d,e){var g=e[0];return g.y<=a.y&&g.y+c>=a.y?(f.each(e,function(c,d){return 0===c&&a.x<=d.x?!1:a.x>=d.x&&a.x<=d.x+d.width?(a.x-d.x>d.width/2?b.index+=c+1:b.index+=c,!1):c==e.length-1&&a.x>=d.x?(b.index+=1==e.length&&0===e[0].width?0:e.length,!1):void 0}),!1):void(b.index+=e.length+(1==e.length&&0===e[0].width?0:1))}),this.selection.setStartOffset(this.index).collapse(!0),this},setSelectionHeight:function(){return this.selection.setHeight(1*(this.minderNode.getData("font-size")||this.minderNode.getStyle("font-size"))),this},updateSelectionByMousePosition:function(a){var b=this,c=0,d=this.getlineHeight();return f.each(this.textData,function(e,g){var h=g[0];return h.y<=a.y&&h.y+d>=a.y?(f.each(g,function(b,d){return 0===b&&a.x<=d.x?!1:a.x>=d.x&&a.x<=d.x+d.width?(c+=b,a.x-d.x>d.width/2&&(c+=1),!1):b==g.length-1&&a.x>=d.x?(c+=1==g.length&&0===g[0].width?0:g.length,!1):void 0}),!1):h.y>a.y&&0===e?(c=0,!1):e==b.textData.length-1&&h.y+d<a.y?(c+=g.length+1,!1):void(c+=g.length+(1==g.length&&0===g[0].width?0:1))}),c<b.index?(this.selection.setStartOffset(c),this.selection.setEndOffset(b.index)):c==b.index?this.selection.setStartOffset(c).collapse(!0):(this.selection.setStartOffset(b.index),this.selection.setEndOffset(c)),this},updateRange:function(){return this.range.update(),this},updateContainerRangeBySel:function(){var a=this;return this.range.setStartOffset(this.selection.startOffset),this.range.setEndOffset(this.selection.endOffset),g.gecko?(this.container.focus(),setTimeout(function(){a.range.select()})):this.range.select(),this},updateSelectionByRange:function(){return this.selection.setStartOffset(this.range.getStartOffset()),this.selection.setEndOffset(this.range.getEndOffset()),this},setIndex:function(a){return this.index=a,this},setContainerTxt:function(a){function b(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return a?(a=b(a),a=a.replace(/[\n]/g,"<br/>")):(a="",this.textGroup.eachItem(function(c,d){a+=b(d.getContent())+"<br/>"})),this.container.innerHTML=a,this},setReady:function(){this._ready=!0},clearReady:function(){this._ready=!1},isReady:function(){return this._ready},focus:function(){this.container.focus()},getTxtOfContainer:function(){var a="",b=this.container;return f.each(b.childNodes,function(c,d){3==d.nodeType?a+=d.nodeValue.replace(/[\u200b]/g,""):d!==b.lastChild&&(a+="\n")}),a}})}},b[75]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(44);g.Selection=e.createClass("Selection",{base:e.Path,constructor:function(a,b,c){this.callBase(),this.height=a||20,this.setAttr("id","_kity_selection"),this.width=2,this.fill("rgb(27,171,255)"),this.setHide(),this.timer=null,this.collapsed=!0,this.startOffset=this.endOffset=0,this.setOpacity(.5),this.setStyle("cursor","text"),this._show=!1,this.offset=[],this.setTranslate(-.5,-1.5)},setMinderNode:function(a){this.minderNode=a},setColor:function(a){this.fill(a)},updateOffsetByTextData:function(a,b){if(this.collapsed)return this.offset=f.getValueByIndex(a,this.startOffset),this;var c=[],d={},e=this.startOffset,g=this.endOffset,h=0;return f.each(a,function(a,b){return d={width:0,x:0,y:0},f.each(b,function(a,b){if(h>=e&&g>=h)if(0===a||h===e)d.x=b.x,d.y=b.y,d.width=b.width;else if(g>h)d.width+=b.width;else if(h===g)return!1;h++}),void 0!==d.x&&c.push(d),h===g?!1:void((1!=b.length||0!==b[0].width)&&h++)}),this.offset=c,this},updatePosition:function(a){var b=this,c=Math.round,d=function(a,b,d,e){return["M",c(a),c(b),"h",c(d),"v",c(e),"h",-c(d),"v",-c(e),"z"]};if(a=void 0!==a?a:this.offset,this.collapsed){if(isNaN(a.x)||isNaN(a.y))return console&&console.warn("editor.selection.js 不正确的偏移位置"),this;this.setPathData(d(a.x,a.y,this.width,this.height))}else this.setPathData(a.reduce(function(a,c){return a.concat(d(c.x,c.y,c.width,b.height))},[]));return this._show=!0,this},collapse:function(a){return this.setOpacity(1),this.collapsed=!0,a?this.endOffset=this.startOffset:this.startOffset=this.endOffset,this},setStartOffset:function(a){return this.startOffset=a,this.startOffset>=this.endOffset?(this.collapse(!0),this):(this.collapsed=!1,this.setOpacity(.5),this)},setEndOffset:function(a){return this.endOffset=a,this.endOffset<=this.startOffset?(this.startOffset=a,this.collapse(!0),this):(this.collapsed=!1,this.setOpacity(.5),this)},update:function(a,b){return a&&this.updateOffsetByTextData(a,b),this.updatePosition(),this.setShow(),this},setHeight:function(a){return this.height=Math.round(a)+2,this},setHide:function(){return clearInterval(this.timer),this.setStyle("display","none"),this._show=!1,this},setHoldShow:function(){return this.setStyle("display",""),clearInterval(this.timer),this},setShow:function(){this.bringTop(),clearInterval(this.timer);var a=this,b="";return a.setStyle("display",""),a._show=!0,this.collapsed&&(a.setOpacity(1),this.timer=setInterval(function(){a.setStyle("display",b),b=b?"":"none"},400)),this},setShowStatus:function(){return this._show=!0,this},isShow:function(){return this._show},isHide:function(){return!this._show}})}},b[76]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(40),h=b.r(46),i=b.r(34),j=b.r(45),k=b.r(52);j.register("Expand",function(){var a=this,b="expandState",c="expand",d="collapse";e.extendClass(h,{expand:function(){return this.setData(b,c),this},collapse:function(){return this.setData(b,d),this},isExpanded:function(){var a=this.getData(b)!==d;return a&&(this.isRoot()||this.parent.isExpanded())},isCollapsed:function(){return!this.isExpanded()}});var j=e.createClass("ExpandCommand",{base:i,execute:function(a,b){var c=a.getSelectedNode();if(c){for(b&&(c=c.parent);c.parent;)c.expand(),c=c.parent;c.renderTree(),a.layout(100)}},queryState:function(a){var b=a.getSelectedNode();return!b||b.isRoot()||b.isExpanded()?-1:0}}),l=e.createClass("ExpandToLevelCommand",{base:i,execute:function(a,b){a.getRoot().traverse(function(a){a.getLevel()<b&&a.expand(),a.getLevel()==b&&a.collapse()}),a.refresh(100)},enableReadOnly:!0}),m=e.createClass("CollapseCommand",{base:i,execute:function(a){var b=a.getSelectedNode();b&&(b.collapse(),b.renderTree(),a.layout())},queryState:function(a){var b=a.getSelectedNode();return b&&!b.isRoot()&&b.isExpanded()?0:-1}}),n=e.createClass("Expander",{base:e.Group,constructor:function(a){this.callBase(),this.radius=6,this.outline=new e.Circle(this.radius).stroke("gray").fill("white"),this.sign=(new e.Path).stroke("gray"),this.addShapes([this.outline,this.sign]),this.initEvent(a),this.setId(f.uuid("node_expander")),this.setStyle("cursor","pointer")},initEvent:function(a){this.on("mousedown",function(b){a.isExpanded()?a.collapse():a.expand(),a.renderTree().getMinder().layout(100),a.getMinder().fire("contentchange"),b.stopPropagation(),b.preventDefault()}),this.on("dblclick click mouseup",function(a){a.stopPropagation(),a.preventDefault()})},setState:function(a){if("hide"==a)return void this.setVisible(!1);this.setVisible(!0);var b=["M",1.5-this.radius,0,"L",this.radius-1.5,0];a==d&&b.push(["M",0,1.5-this.radius,"L",0,this.radius-1.5]),this.sign.setPathData(b)}}),o=e.createClass("ExpanderRenderer",{base:k,create:function(a){return a.isRoot()?void 0:(this.expander=new n(a),a.getRenderContainer().prependShape(this.expander),a.expanderRenderer=this,this.node=a,this.expander)},shouldRender:function(a){return!a.isRoot()},update:function(a,c,d){if(c.parent){var e=c.parent.isExpanded();a.setState(e&&c.children.length?c.getData(b):"hide");var f=c.getLayoutVectorIn().normalize(a.radius+c.getStyle("stroke-width")),g=c.getVertexIn().offset(f.reverse());this.expander.setTranslate(g)}}});return{commands:{expand:j,expandtolevel:l,collapse:m},events:{layoutapply:function(a){var b=a.node.getRenderer("ExpanderRenderer");b.getRenderShape()&&b.update(b.getRenderShape(),a.node)},beforerender:function(a){var b=a.node,c=!b.parent||b.parent.isExpanded();b.getRenderContainer().setVisible(c),c||a.stopPropagation()},"normal.keydown":function(a){if("textedit"!=this.getStatus()){if(a.originEvent.keyCode==g["/"]){var b=this.getSelectedNode();if(!b||b==this.getRoot())return;var c=b.isExpanded();this.getSelectedNodes().forEach(function(a){c?a.collapse():a.expand(),a.renderTree()}),this.layout(100),this.fire("contentchange"),a.preventDefault(),a.stopPropagationImmediately()}a.isShortcutKey("Alt+`")&&this.execCommand("expandtolevel",9999);for(var d=1;6>d;d++)a.isShortcutKey("Alt+"+d)&&this.execCommand("expandtolevel",d)}}},renderers:{outside:o},contextmenu:[{command:"expandtoleaf",query:function(){return!a.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",9999)}},{command:"expandtolevel1",query:function(){return!a.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",1)}},{command:"expandtolevel2",query:function(){return!a.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",2)}},{command:"expandtolevel3",query:function(){return!a.getSelectedNode()},fn:function(a){a.execCommand("expandtolevel",3)}},{divider:!0}]}})}},b[77]={value:function(a,c,d){function e(a,b){return a.getData(b)||a.getStyle(b)}var f=b.r(42),g=(b.r(58),b.r(44),b.r(46),b.r(34)),h=b.r(45),i=b.r(92);i.registerStyleHook(function(a,b){var c=a.getData("color"),d=a.getStyle("selected-color"),f=a.getStyle("color"),g=c||(a.isSelected()&&d?d:f),h=e(a,"font-family"),i=e(a,"font-size");b.fill(g),b.eachItem(function(a,b){b.setFont({family:h,size:i})})}),h.register("fontmodule",{commands:{forecolor:f.createClass("fontcolorCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.setData("color",b),a.render()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){return 1==a.getSelectedNodes().length?a.getSelectedNodes()[0].getData("color"):"mixed"}}),background:f.createClass("backgroudCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.setData("background",b),a.render()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){return 1==a.getSelectedNodes().length?a.getSelectedNodes()[0].getData("background"):"mixed"}}),fontfamily:f.createClass("fontfamilyCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(c){c.setData("font-family",b),c.render(),a.layout()})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("font-family"):null}}),fontsize:f.createClass("fontsizeCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(c){c.setData("font-size",b),c.render(),a.layout(300)})},queryState:function(a){return 0===a.getSelectedNodes().length?-1:0},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("font-size"):null}})}})}},b[78]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=b.r(34),h=b.r(45);h.register("HistoryModule",function(){var a=this,b=e.createClass("Scene",{constructor:function(a,b){this.data=a.clone(),this.inputStatus=b},getData:function(){return this.data},cloneData:function(){return this.getData().clone()},equals:function(a){return this.getData().equals(a.getData())},isInputStatus:function(){return this.inputStatus},setInputStatus:function(a){this.inputStatus=a}}),c=e.createClass("HistoryManager",{constructor:function(a){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.km=a},undo:function(){if(this.hasUndo){var a=this.list[this.index];if(a&&a.isInputStatus())return this.saveScene(),this.restore(--this.index),void a.setInputStatus(!1);if(1==this.list.length)return void this.restore(0);if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].equals(this.list[this.index-1]);)if(this.index--,0===this.index)return this.restore(0);this.restore(--this.index)}},redo:function(){if(this.hasRedo){for(;this.list[this.index].equals(this.list[this.index+1]);)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},partialRenewal:function(b){function c(a,b){return a.getText()!=b.getText()?!1:f.compareObject(a.getData(),b.getData())===!1?!1:f.compareObject(a.getTmpData(),b.getTmpData())===!1?!1:!0}function d(b,c){c.isSelected()&&g.push(c),a.appendNode(c,b),c.render();for(var e,h=f.cloneArr(c.children),i=0;e=h[i++];)d(c,e)}function e(b,f){c(b,f)===!1&&b.setValue(f),b.render(),b.isSelected()&&g.push(b);for(var h,i,j=0,k=0;h=b.children[j],i=f.children[k],h||i;j++,k++)h&&!i?(j--,a.removeNode(h)):!h&&i?(k--,d(b,i)):e(h,i)}var g=[];e(a.getRoot(),b),a.layout(200),a.select(g,!0),g=[]},restore:function(a){a=void 0===a?this.index:a;var b=this.list[a];this.partialRenewal(b.cloneData()),this.update(),this.km.fire("restoreScene"),this.km.fire("contentChange")},getScene:function(a){return new b(this.km.getRoot(),a)},saveScene:function(a){var b=this.getScene(a),c=this.list[this.index];return c&&c.equals(b)?void(a&&(c.setInputStatus(!0),this.update())):(this.list=this.list.slice(0,this.index+1),this.list.push(b),this.list.length>this.km.getOption("maxUndoCount")&&this.list.shift(),this.index=this.list.length-1,void this.update())},update:function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1];var a=this.list[this.index];a&&a.isInputStatus()&&(this.hasUndo=!0)},reset:function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1}});return this.historyManager=new c(this),{defaultOptions:{maxUndoCount:20,maxInputCount:20},commands:{undo:e.createClass("UndoCommand",{base:g,execute:function(a){a.historyManager.undo()},queryState:function(a){return a.historyManager.hasUndo?0:-1},isNeedUndo:function(){return!1}}),redo:e.createClass("RedoCommand",{base:g,execute:function(a){a.historyManager.redo()},queryState:function(a){return a.historyManager.hasRedo?0:-1},isNeedUndo:function(){return!1}})},commandShortcutKeys:{undo:"ctrl+z",redo:"ctrl+y"},events:{saveScene:function(a){this.historyManager.saveScene(a.inputStatus)},"import":function(){this.historyManager.reset()}}}})}},b[79]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45),h=b.r(52),i="M16.614,10.224h-1.278c-1.668,0-3.07-1.07-3.599-2.556h4.877c0.707,0,1.278-0.571,1.278-1.278V3.834 c0-0.707-0.571-1.278-1.278-1.278h-4.877C12.266,1.071,13.668,0,15.336,0h1.278c2.116,0,3.834,1.716,3.834,3.834V6.39 C20.448,8.508,18.73,10.224,16.614,10.224z M5.112,5.112c0-0.707,0.573-1.278,1.278-1.278h7.668c0.707,0,1.278,0.571,1.278,1.278 S14.765,6.39,14.058,6.39H6.39C5.685,6.39,5.112,5.819,5.112,5.112z M2.556,3.834V6.39c0,0.707,0.573,1.278,1.278,1.278h4.877 c-0.528,1.486-1.932,2.556-3.599,2.556H3.834C1.716,10.224,0,8.508,0,6.39V3.834C0,1.716,1.716,0,3.834,0h1.278 c1.667,0,3.071,1.071,3.599,2.556H3.834C3.129,2.556,2.556,3.127,2.556,3.834z";g.register("hyperlink",{commands:{hyperlink:e.createClass("hyperlink",{base:f,execute:function(a,b,c){var d=a.getSelectedNodes();d.forEach(function(a){a.setData("hyperlink",b),a.setData("hyperlinkTitle",b&&c),a.render()}),a.layout()},queryState:function(a){var b=a.getSelectedNodes(),c=0;return 0===b.length?-1:(b.forEach(function(a){return a&&a.getData("hyperlink")?(c=0,!1):void 0}),c)},queryValue:function(a){var b=a.getSelectedNode();return{url:b.getData("hyperlink"),title:b.getData("hyperlinkTitle")}}})},renderers:{right:e.createClass("hyperlinkrender",{base:h,create:function(){var a=new e.HyperLink,b=new e.Path,c=new e.Rect(24,22,-2,-6,4).fill("rgba(255, 255, 255, 0)");return b.setPathData(i).fill("#666"),a.addShape(c),a.addShape(b),a.setTarget("_blank"),a.setStyle("cursor","pointer"),a.on("mouseover",function(){c.fill("rgba(255, 255, 200, .8)")}).on("mouseout",function(){c.fill("rgba(255, 255, 255, 0)")}),a},shouldRender:function(a){return a.getData("hyperlink")},update:function(a,b,c){var d=b.getData("hyperlink");a.setHref(d);var f=b.getData("hyperlinkTitle");f=f?[f,"(",d,")"].join(""):d,a.node.setAttributeNS("http://www.w3.org/1999/xlink","title",f);var g=b.getStyle("space-right");return a.setTranslate(c.right+g+2,-5),new e.Box({x:c.right+g,y:-11,width:24,height:22})}})}})}},b[80]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45),h=b.r(52);g.register("image",function(){function a(a,b){var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.onerror=function(){b(null)},c.src=a}function b(a,b,c,d){var e=a/b,f=c/d;return a>c&&e>f?(a=c,b=a/e):b>d&&(b=d,a=b*e),{width:0|a,height:0|b}}var c=e.createClass("ImageCommand",{base:f,execute:function(c,d,e){var f=c.getSelectedNodes();a(d,function(a,g){f.forEach(function(f){var h=b(a,g,c.getOption("maxImageWidth"),c.getOption("maxImageHeight"));f.setData("image",d),f.setData("imageTitle",d&&e),f.setData("imageSize",d&&h),f.render()}),c.fire("saveScene"),c.layout(300)})},queryState:function(a){var b=a.getSelectedNodes(),c=0;return 0===b.length?-1:(b.forEach(function(a){return a&&a.getData("image")?(c=0,!1):void 0}),c)},queryValue:function(a){var b=a.getSelectedNode();return{url:b.getData("image"),title:b.getData("imageTitle")}}}),d=e.createClass("ImageRenderer",{base:h,create:function(a){return new e.Image(a.getData("image"))},shouldRender:function(a){return a.getData("image")},update:function(a,b,c){var d=b.getData("image"),f=b.getData("imageTitle"),g=b.getData("imageSize"),h=b.getStyle("space-top");if(g){f&&a.node.setAttributeNS("http://www.w3.org/1999/xlink","title",f);var i=c.cx-g.width/2,j=c.y-g.height-h;return a.setUrl(d).setX(0|i).setY(0|j).setWidth(0|g.width).setHeight(0|g.height),new e.Box(0|i,0|j,0|g.width,0|g.height)}}});return{defaultOptions:{maxImageWidth:200,maxImageHeight:200},commands:{image:c},renderers:{top:d}}})}},b[81]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(40)),g=b.r(33),h=(b.r(44),b.r(46),b.r(34)),i=b.r(45);b.r(52);i.register("KeyboardModule",function(){function a(a){var b,d=[];a.traverse(function(a){b=a.getLayoutBox(),b.width&&b.height&&d.push({left:b.x,top:b.y,right:b.x+b.width,bottom:b.y+b.height,width:b.width,height:b.height,node:a})});for(var e=0;e<d.length;e++)c(d,e)}function b(a,b){var c,d,e,f,g,h,l;c=i(a.left,b.left),d=j(a.right,b.right),e=i(a.top,b.top),f=j(a.bottom,b.bottom),g=d-c-a.width-b.width,h=f-e-a.height-b.height,l=0>g?h:0>h?g:k(g*g+h*h);var m=a.node,n=b.node;return m.parent==n.parent&&(l/=10),n.parent==m&&(l/=5),l}function c(a,c){for(var d,e,f=a[c],g={},h=0;h<a.length;h++)h!=c&&(d=a[h],e=b(d,f),d.right<f.left&&(!g.left||e<g.left.dist)&&(g.left={dist:e,node:d.node}),d.left>f.right&&(!g.right||e<g.right.dist)&&(g.right={dist:e,node:d.node}),d.bottom<f.top&&(!g.top||e<g.top.dist)&&(g.top={dist:e,node:d.node}),d.top>f.bottom&&(!g.down||e<g.down.dist)&&(g.down={dist:e,node:d.node}));f.node._nearestNodes={right:g.right&&g.right.node||null,top:g.top&&g.top.node||null,left:g.left&&g.left.node||null,down:g.down&&g.down.node||null}}function d(b,c){var d=b.getSelectedNode();if(!d)return b.select(b.getRoot()),void a(b.getRoot());d._nearestNodes||a(b.getRoot());var e=d._nearestNodes[c];e&&b.select(e,!0)}var i=Math.min,j=Math.max,k=(Math.abs,Math.sqrt),l=(Math.exp,e.createClass({base:h,execute:function(a){var b=a.getSelectedNode();b&&b.parent&&a.select(b.parent,!0),this.setContentChanged(!1)},queryState:function(a){return a.getSelectedNode()?0:-1},enableReadOnly:!0}));return{commands:{navparent:l},commandShortcutKeys:{navparent:"shift+tab"},events:{layoutallfinish:function(){var b=this.getRoot();a(b)},"normal.keydown readonly.keydown":function(a){var b=this;["left","right","up","down"].forEach(function(c){a.isShortcutKey(c)&&d(b,"up"==c?"top":c)})},"normal.keyup":function(a){if(g.ipad){var b=f,c=a.getTargetNode(),d=this.getLang();this.receiver&&(this.receiver.keydownNode=c);var e=a.originEvent;if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;switch(e.keyCode){case b.Enter:this.execCommand("AppendSiblingNode",d.topic),a.preventDefault();break;case b.Backspace:case b.Del:a.preventDefault(),this.execCommand("RemoveNode")}}}}}})}},b[82]={value:function(a,c,d){var e=b.r(42),f=b.r(34),g=b.r(45),h=e.createClass("LayoutCommand",{base:f,execute:function(a,b){var c=a.getSelectedNodes();c.forEach(function(a){a.layout(b)})},queryValue:function(a){var b=a.getSelectedNode();return b?b.getData("layout"):void 0},queryState:function(a){return a.getSelectedNode()?0:-1}}),i=e.createClass("ResetLayoutCommand",{base:f,execute:function(a){var b=a.getSelectedNodes();b.length||(b=[a.getRoot()]),b.forEach(function(a){a.traverse(function(a){a.resetLayoutOffset(),a.isRoot()||a.setData("layout",null)})}),a.layout(300)},enableReadOnly:!0});g.register("LayoutModule",{commands:{layout:h,resetlayout:i},contextmenu:[{command:"resetlayout"},{divider:!0}],commandShortcutKeys:{resetlayout:"Ctrl+Shift+L"}})}},b[83]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46)),g=b.r(34),h=b.r(45),i=(b.r(52),e.createClass("AppendChildCommand",{base:g,execute:function(a,b){var c=a.getSelectedNode();if(!c)return null;b=b||"分支主题",c.expand();var d=a.createNode(b,c);a.select(d,!0),d.render(),a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}})),j=e.createClass("AppendSiblingCommand",{base:g,execute:function(a,b){var c=a.getSelectedNode(),d=c.parent;if(!d)return a.execCommand("AppendChildNode",b);b=b||"分支主题";var e=a.createNode(b,d,c.getIndex()+1);e.setGlobalLayoutTransform(c.getGlobalLayoutTransform()),a.select(e,!0),e.render(),a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b?0:-1}}),k=e.createClass("RemoverNodeCommand",{base:g,execute:function(a){var b=a.getSelectedNodes(),c=f.getCommonAncestor.apply(null,b),d=b[0].getIndex();if(b.forEach(function(b){b.isRoot()||a.removeNode(b)}),1==b.length){var e=c.children[d-1]||c.children[d];a.select(e||c||a.getRoot(),!0)}else a.select(c||a.getRoot(),!0);a.layout(600)},queryState:function(a){var b=a.getSelectedNode();return b&&!b.isRoot()?0:-1}}),l=(e.createClass("AppendParentCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();c.sort(function(a,b){return a.getIndex()-b.getIndex()});var d=c[0].parent,e=a.createNode(b,d,c[0].getIndex());c.forEach(function(a){e.appendChild(a)}),e.setGlobalLayoutTransform(c[c.length>>1].getGlobalLayoutTransform()),a.select(e,!0),a.layout(600)},queryState:function(a){var b=a.getSelectedNodes();if(!b.length)return-1;var c=b[0].parent;if(!c)return-1;for(var d=1;d<b.length;d++)if(b[d].parent!=c)return-1;return 0}}),e.createClass("EditNodeCommand",{base:g,execute:function(a){var b=a.getSelectedNode();return b?(a.select(b,!0),void a.textEditNode(b)):null},queryState:function(a){var b=a.getSelectedNode();return b?0:-1},isNeedUndo:function(){return!1}}));h.register("NodeModule",function(){return{commands:{AppendChildNode:i,AppendSiblingNode:j,RemoveNode:k,EditNode:l},commandShortcutKeys:{appendsiblingnode:"normal::Enter",appendchildnode:"normal::Insert|Tab",appendparentnode:"normal::Shift+Tab|normal::Shift+Insert",editnode:"normal::F2",removenode:"normal::Del|Backspace"}}})}},b[84]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45),h=b.r(52);g.register("NoteModule",function(){var a="M9,9H3V8h6L9,9L9,9z M9,7H3V6h6V7z M9,5H3V4h6V5z M8.5,11H2V2h8v7.5 M9,12l2-2V1H1v11",b=e.createClass("NoteCommand",{base:f,execute:function(a,b){var c=a.getSelectedNode();c.setData("note",b),c.render(),c.getMinder().layout(300)},queryState:function(a){return 1===a.getSelectedNodes().length?0:-1},queryValue:function(a){var b=a.getSelectedNode();return b&&b.getData("note")}}),c=e.createClass("NoteIcon",{base:e.Group,constructor:function(){this.callBase(),this.width=16,this.height=17,this.rect=new e.Rect(16,17,.5,-8.5,2).fill("transparent"),this.path=(new e.Path).setPathData(a).setTranslate(2.5,-6.5),this.addShapes([this.rect,this.path]),this.on("mouseover",function(){this.rect.fill("rgba(255, 255, 200, .8)")}).on("mouseout",function(){this.rect.fill("transparent")}),this.setStyle("cursor","pointer")}}),d=e.createClass("NoteIconRenderer",{base:h,create:function(a){var b=new c;return b.on("mousedown",function(b){b.preventDefault(),a.getMinder().fire("editnoterequest")}),b.on("mouseover",function(){a.getMinder().fire("shownoterequest",{node:a,icon:b})}),b.on("mouseout",function(){a.getMinder().fire("hidenoterequest",{node:a,icon:b})}),b},shouldRender:function(a){return a.getData("note")},update:function(a,b,c){var d=c.right+b.getStyle("space-left"),f=c.cy;return a.path.fill(b.getStyle("color")),a.setTranslate(d,f),new e.Box(d,Math.round(f-a.height/2),a.width,a.height)}});return{renderers:{right:d},commands:{note:b}}})}},b[85]={value:function(a,c,d){function e(a,b,c){var d=b.getStyle("padding-left"),e=b.getStyle("padding-right"),g=b.getStyle("padding-top"),h=b.getStyle("padding-bottom"),i=Math.max(c.width,c.height),j={x:c.x-d,y:c.y-g,width:i+d+e,height:i+g+h},k=b.isSelected()?"selected-":"";return i=Math.max(j.width,j.height),a.setPosition(j.x,j.y).setSize(i,i).setRadius(i/2).fill(b.getData("background")||b.getStyle(k+"background")||b.getStyle("background")).stroke(b.getStyle(k+"stroke"||b.getStyle("stroke")),b.getStyle(k+"stroke-width")),new f.Box(j)}var f=b.r(42),g=b.r(58),h=(b.r(44),b.r(46),b.r(34),b.r(45)),i=b.r(52),j=f.createClass("OutlineRenderer",{base:i,create:function(a){var b=(new f.Rect).setId(g.uuid("node_outline"));return this.bringToBack=!0,b},update:function(a,b,c){var d=b.getStyle("shape");if(d&&"circle"==d)return e(a,b,c);var g=b.getStyle("padding-left"),h=b.getStyle("padding-right"),i=b.getStyle("padding-top"),j=b.getStyle("padding-bottom"),k={x:c.x-g,y:c.y-i,width:c.width+g+h,height:c.height+i+j
},l=b.isSelected()?b.getMinder().isFocused()?"selected-":"blur-selected-":"";return a.setPosition(k.x,k.y).setSize(k.width,k.height).setRadius(b.getStyle("radius")).fill(b.getData("background")||b.getStyle(l+"background")||b.getStyle("background")).stroke(b.getStyle(l+"stroke"||b.getStyle("stroke")),b.getStyle(l+"stroke-width")),new f.Box(k)}}),k=f.createClass("ShadowRenderer",{base:i,create:function(a){return this.bringToBack=!0,new f.Rect},shouldRender:function(a){return a.getStyle("shadow")},update:function(a,b,c){a.setPosition(c.x+4,c.y+5).fill(b.getStyle("shadow"));var d=b.getStyle("shape");if(d){if("circle"==d){var e=Math.max(c.width,c.height);a.setSize(e,e),a.setRadius(e/2)}}else a.setSize(c.width,c.height),a.setRadius(b.getStyle("radius"))}}),l=new f.Marker;l.setWidth(10),l.setHeight(12),l.setRef(0,0),l.setViewBox(-6,-4,8,10),l.addShape((new f.Path).setPathData("M-5-3l5,3,-5,3").stroke("#33ffff"));var m=/wire/.test(window.location.href),n=f.createClass("WireframeRenderer",{base:i,create:function(){var a=new f.Group,b=this.oxy=(new f.Path).stroke("#f6f").setPathData("M0,-50L0,50M-50,0L50,0"),c=this.wireframe=(new f.Rect).stroke("lightgreen"),d=this.vectorIn=(new f.Path).stroke("#66ffff"),e=this.vectorOut=(new f.Path).stroke("#66ffff");return d.setMarker(l,"end"),e.setMarker(l,"end"),a.addShapes([b,c,d,e])},shouldRender:function(){return m},update:function(a,b,c){this.wireframe.setPosition(c.x,c.y).setSize(c.width,c.height);var d=b.getVertexIn(),e=b.getVertexOut(),f=b.getLayoutVectorIn().normalize(30),g=b.getLayoutVectorOut().normalize(30);this.vectorIn.setPathData(["M",d.offset(f.reverse()),"L",d]),this.vectorOut.setPathData(["M",e,"l",g])}});h.register("OutlineModule",function(){return{events:m?{ready:function(){this.getPaper().addResource(l)},layoutallfinish:function(){this.getRoot().traverse(function(a){a.getRenderer("WireframeRenderer").update(null,a,a.getContentBox())})}}:null,renderers:{outline:j,outside:[k,n]}}})}},b[86]={value:function(a,c,d){var e=(b.r(42),b.r(58)),f=b.r(40),g=b.r(45);g.register("pasteModule",function(){function a(b,d){g.push(d),c.appendNode(d,b),d.render(),d.setLayoutOffset(null);for(var f,h=e.cloneArr(d.children),i=0;f=h[i++];)a(d,f)}function b(a,b){d=[];for(var e,f=0;e=a[f++];)d.push(e.clone()),b&&!e.isRoot()&&c.removeNode(e)}var c=this,d=[],g=[],h=!1,i=!1;return{events:{"normal.keydown":function(e){var j=f,k=e.originEvent;if(k.ctrlKey||k.metaKey)switch(k.keyCode){case j.c:b(c.getSelectedAncestors(!0)),h=!0;break;case j.x:b(c.getSelectedAncestors(),!0),c.layout(300),i=!0;break;case j.v:if(d.length){var l=c.getSelectedNode();if(l){c.fire("saveScene");for(var m,n=0;m=d[n++];)a(l,m.clone());c.layout(300),c.select(g,!0),g=[],c.fire("saveScene")}}}}}}})}},b[87]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=(b.r(44),b.r(46),b.r(34)),h=b.r(45),i=b.r(52);h.register("PriorityModule",function(){var a=[null,["#FF1200","#840023"],["#0074FF","#01467F"],["#00AF00","#006300"],["#FF962E","#B25000"],["#A464FF","#4720C4"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"],["#A3A3A3","#515151"]],b="M0,13c0,3.866,3.134,7,7,7h6c3.866,0,7-3.134,7-7V7H0V13z",c="M20,10c0,3.866-3.134,7-7,7H7c-3.866,0-7-3.134-7-7V7c0-3.866,3.134-7,7-7h6c3.866,0,7,3.134,7,7V10z",d="priority",h=e.createClass("PriorityIcon",{base:e.Group,constructor:function(){this.callBase(),this.setSize(20),this.create(),this.setId(f.uuid("node_priority"))},setSize:function(a){this.width=this.height=a},create:function(){var a,d,f,g;a=(new e.Path).setPathData(c).fill("white"),d=(new e.Path).setPathData(b).setTranslate(.5,.5),f=(new e.Path).setPathData(c).setOpacity(.8).setTranslate(.5,.5),g=(new e.Text).setX(this.width/2-.5).setY(this.height/2).setTextAnchor("middle").setVerticalAlign("middle").setFontItalic(!0).setFontSize(12).fill("white"),this.addShapes([d,f,g]),this.mask=f,this.back=d,this.number=g},setValue:function(b){var c=this.back,d=this.mask,e=this.number,f=a[b];f&&(c.fill(f[1]),d.fill(f[0])),e.setContent(b)}}),j=e.createClass("SetPriorityCommand",{base:g,execute:function(a,b){for(var c=a.getSelectedNodes(),e=0;e<c.length;e++)c[e].setData(d,b||null).render();a.layout()},queryValue:function(a){for(var b,c=a.getSelectedNodes(),e=0;e<c.length&&!(b=c[e].getData(d));e++);return b||null},queryState:function(a){return a.getSelectedNodes().length?0:-1}});return{commands:{priority:j},renderers:{left:e.createClass("PriorityRenderer",{base:i,create:function(a){return new h},shouldRender:function(a){return a.getData(d)},update:function(a,b,c){var f,g,h=b.getData(d),i=b.getStyle("space-left");return a.setValue(h),f=c.left-a.width-i,g=-a.height/2,a.setTranslate(f,g),new e.Box({x:f,y:g,width:a.width,height:a.height})}})}}})}},b[88]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=(b.r(44),b.r(46),b.r(34)),h=b.r(45),i=b.r(52);h.register("ProgressModule",function(){var a=this,b="progress",c="#FFED83",d="#43BC00",h="M10,3c4.418,0,8,3.582,8,8h1c0-5.523-3.477-10-9-10S1,5.477,1,11h1C2,6.582,5.582,3,10,3z",j="#8E8E8E",k="M10,0C4.477,0,0,4.477,0,10c0,5.523,4.477,10,10,10s10-4.477,10-10C20,4.477,15.523,0,10,0zM10,18c-4.418,0-8-3.582-8-8s3.582-8,8-8s8,3.582,8,8S14.418,18,10,18z",l=(new e.LinearGradient).pipe(function(a){a.setStartPosition(0,0),a.setEndPosition(0,1),a.addStop(0,"#fff"),a.addStop(1,"#ccc")}),m="M15.812,7.896l-6.75,6.75l-4.5-4.5L6.25,8.459l2.812,2.803l5.062-5.053L15.812,7.896z",n="#EEE";a.getPaper().addResource(l);var o=e.createClass("ProgressIcon",{base:e.Group,constructor:function(a){this.callBase(),this.setSize(20),this.create(),this.setValue(a),this.setId(f.uuid("node_progress")),this.translate(.5,.5)},setSize:function(a){this.width=this.height=a},create:function(){var a,b,f,g,i;a=new e.Circle(9).fill(c),b=new e.Pie(9,0).fill(d),f=(new e.Path).setPathData(h).setTranslate(-10,-10).fill(j),g=(new e.Path).setTranslate(-10,-10).setPathData(k).fill(l),i=(new e.Path).setTranslate(-10,-10).setPathData(m).fill(n),this.addShapes([a,b,f,i,g]),this.pie=b,this.check=i},setValue:function(a){this.pie.setAngle(-360*(a-1)/8),this.check.setVisible(9==a)}}),p=e.createClass("ProgressCommand",{base:g,execute:function(a,c){for(var d=a.getSelectedNodes(),e=0;e<d.length;e++)d[e].setData(b,c||null).render();a.layout()},queryValue:function(a){for(var c,d=a.getSelectedNodes(),e=0;e<d.length&&!(c=d[e].getData(b));e++);return c||null},queryState:function(a){return a.getSelectedNodes().length?0:-1}});return{commands:{progress:p},renderers:{left:e.createClass("ProgressRenderer",{base:i,create:function(a){return new o},shouldRender:function(a){return a.getData(b)},update:function(a,c,d){var f,g,h=c.getData(b),i=c.getStyle("space-left");return a.setValue(h),f=d.left-a.width-i,g=-a.height/2,a.setTranslate(f+a.width/2,g+a.height/2),new e.Box(f,g,a.width,a.height)}})}}})}},b[89]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44)),g=(b.r(46),b.r(34)),h=b.r(45),i=b.r(52);h.register("Resource",function(){var a=[51,303,75,200,157,0,26,254].map(function(a){return e.Color.createHSL(a,100,85)}),b=e.Color.createHSL(0,0,95);e.extendClass(f,{getResourceColor:function(c){var d,e=this._getResourceColorIndexMapping();return e.hasOwnProperty(c)||(d=this._getNextResourceColorIndex(),e[c]=d),a[e[c]]||b},getUsedResource:function(){var a,b=this._getResourceColorIndexMapping(),c=[];for(a in b)b.hasOwnProperty(a)&&c.push(a);return c},_getNextResourceColorIndex:function(){var b,c,d,e=this._getResourceColorIndexMapping();c=[];for(b in e)e.hasOwnProperty(b)&&c.push(e[b]);for(d=0;d<a.length;d++)if(!~c.indexOf(d))return d;return-1},_getResourceColorIndexMapping:function(){return this._resourceColorMapping||(this._resourceColorMapping={})}});var c=e.createClass("ResourceCommand",{base:g,execute:function(a,b){var c=a.getSelectedNodes();"string"==typeof b&&(b=[b]),c.forEach(function(a){a.setData("resource",b).render()}),a.layout(200)},queryValue:function(a){var b=a.getSelectedNodes(),c=[];return b.forEach(function(a){var b=a.getData("resource");b&&b.forEach(function(a){~c.indexOf(a)||c.push(a)})}),c},queryState:function(a){return a.getSelectedNode()?0:-1}}),d=e.createClass("ResourceOverlay",{base:e.Group,constructor:function(){this.callBase();var a,b;b=this.rect=(new e.Rect).setRadius(4),a=this.text=(new e.Text).setFontSize(12).setVerticalAlign("middle"),this.addShapes([b,a])},setValue:function(a,b){var c,d,e,f=8,g=4;c=this.text,a==this.lastResourceName?d=this.lastBox:(c.setContent(a),d=c.getBoundaryBox(),this.lastResourceName=a,this.lastBox=d),c.setX(f).fill(b.dec("l",70)),e=this.rect,e.setPosition(0,d.y-g),this.width=Math.round(d.width+2*f),this.height=Math.round(d.height+2*g),e.setSize(this.width,this.height),e.fill(b)}}),h=e.createClass("ResourceRenderer",{base:i,create:function(a){return this.overlays=[],new e.Group},shouldRender:function(a){return a.getData("resource")&&a.getData("resource").length},update:function(a,b,c){var f,g,h,i=b.getStyle("space-right"),j=this.overlays,k=b.getData("resource"),l=b.getMinder();for(h=0,f=0;f<k.length;f++)h+=i,g=j[f],g||(g=new d,j.push(g),a.addShape(g)),g.setVisible(!0),g.setValue(k[f],l.getResourceColor(k[f])),g.setTranslate(h,-1),h+=g.width;for(;g=j[f++];)g.setVisible(!1);return a.setTranslate(c.right,0),new e.Box({x:c.right,y:Math.round(-j[0].height/2),width:h,height:j[0].height})}});return{commands:{resource:c},renderers:{right:h}}})}},b[90]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34),b.r(45));b.r(52);f.register("Select",function(){var a=this,b=a.getRenderContainer(),c=function(){var c=null,d=new e.Path,f=!1,g=10;return{selectStart:function(a){return a.originEvent.button||a.originEvent.altKey?void 0:c?this.selectEnd():void(c=a.getPosition(b).round())},selectMove:function(h){if("textedit"!=a.getStatus()&&c){var i=c,j=h.getPosition(b);if(!f){if(e.Vector.fromPoints(i,j).length()<g)return;f=!0,b.addShape(d),d.fill(a.getStyle("marquee-background")).stroke(a.getStyle("marquee-stroke")).setOpacity(.8).getDrawer().clear()}var k=new e.Box(i.x,i.y,j.x-i.x,j.y-i.y),l=[];k.left=Math.round(k.left),k.top=Math.round(k.top),k.right=Math.round(k.right),k.bottom=Math.round(k.bottom),d.getDrawer().pipe(function(){this.clear(),this.moveTo(k.left,k.top),this.lineTo(k.right,k.top),this.lineTo(k.right,k.bottom),this.lineTo(k.left,k.bottom),this.close()}),a.getRoot().traverse(function(a){var b=a.getLayoutBox();b.intersect(k).isEmpty()||l.push(a)}),a.select(l,!0),window.getSelection().removeAllRanges()}},selectEnd:function(a){c&&(c=null),f&&(d.fadeOut(200,"ease",0,function(){d.remove&&d.remove()}),f=!1)}}}(),d=null,f=null;return{init:function(){window.addEventListener("mouseup",function(){c.selectEnd()})},events:{mousedown:function(a){var b=a.getTargetNode();b?a.isShortcutKey("Ctrl")?this.toggleSelect(b):b.isSelected()?this.isSingleSelect()||(d=b,f=a.getPosition()):this.select(b,!0):(this.removeAllSelectedNodes(),c.selectStart(a),this.setStatus("normal"))},mousemove:c.selectMove,mouseup:function(a){var b=a.getTargetNode();if(b&&b==d){var g=a.getPosition(),h=e.Vector.fromPoints(f,g);h.length()<1&&this.select(d,!0),d=null}c.selectEnd(a)},"normal.keydown inputready.keydown":function(a){if(a.isShortcutKey("ctrl+a")){var b=[];this.getRoot().traverse(function(a){b.push(a)}),this.select(b,!0),a.preventDefault()}}}}})}},b[91]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45);b.r(52);g.register("StyleModule",function(){function a(a){for(var c=a.getData(),d=0;d<b.length;d++)if(b[d]in c)return!0}var b=["font-size","font-family","font-weight","font-style","background","color"],c=null;return{commands:{copystyle:e.createClass("CopyStyleCommand",{base:f,execute:function(a){var d=a.getSelectedNode(),e=d.getData();return c={},b.forEach(function(a){a in e?c[a]=e[a]:(c[a]=null,delete c[a])}),c},queryState:function(b){var c=b.getSelectedNodes();return 1!==c.length?-1:a(c[0])?0:-1}}),pastestyle:e.createClass("PastStyleCommand",{base:f,execute:function(a){return a.getSelectedNodes().forEach(function(a){for(var b in c)c.hasOwnProperty(b)&&a.setData(b,c[b])}),a.renderNodeBatch(a.getSelectedNodes()),a.layout(300),c},queryState:function(a){return c&&a.getSelectedNodes().length?0:-1}}),clearstyle:e.createClass("ClearStyleCommand",{base:f,execute:function(a){return a.getSelectedNodes().forEach(function(a){b.forEach(function(b){a.setData(b)})}),a.renderNodeBatch(a.getSelectedNodes()),a.layout(300),c},queryState:function(b){var c=b.getSelectedNodes();if(!c.length)return-1;for(var d=0;d<c.length;d++)if(a(c[d]))return 0;return-1}})}}})}},b[92]={value:function(a,c,d){var e=b.r(42),f=b.r(58),g=(b.r(44),b.r(46)),h=b.r(34),i=b.r(45),j=b.r(52),k={"微软雅黑,Microsoft YaHei":-.15,"arial black,avant garde":-.17,"default":-.15},l=e.createClass("TextRenderer",{base:j,create:function(){return(new e.Group).setId(f.uuid("node_text"))},update:function(a,b){function c(a){return b.getData(a)||b.getStyle(a)}var d=b.getText(),f=d?d.split("\n"):[" "],g=b.getStyle("line-height"),h=c("font-size"),i=c("font-family")||"default",j=g*h*f.length-(g-1)*h,l=-j/2;if(e.Browser.ie){var m=k[i]||0;a.setTranslate(0,m*h)}var n=new e.Box,o=Math.round;this.setTextStyle(b,a);var p,q,r,s,t=f.length,u=a.getItems().length;if(u>t)for(p=t,q;q=a.getItem(p);)a.removeItem(p);else if(t>u)for(var v=t-u;v--;)r=(new e.Text).setAttr("text-rendering","inherit"),e.Browser.ie?r.setVerticalAlign("top"):r.setAttr("dominant-baseline","text-before-edge"),a.addItem(r);for(p=0,r;s=f[p],r=a.getItem(p);p++)r.setContent(s),e.Browser.ie&&r.fixPosition();this.setTextStyle(b,a);var w=b.getText()+["font-size","font-name","font-weight","font-style"].map(c).join("/");return b._currentTextHash==w&&b._currentTextGroupBox?b._currentTextGroupBox:(b._currentTextHash=w,function(){a.eachItem(function(a,b){var c=l+a*h*g;b.setY(c);var d=b.getBoundaryBox();n=n.merge(new e.Box(0,c,d.height&&d.width||1,h))});var c=0,d=b.getStyle("shape");d&&"circle"==d&&(c=Math.max(n.width,n.height)/2-n.height/2);var f=new e.Box(o(n.x),o(n.y-c),o(n.width),o(n.height));return b._currentTextGroupBox=f,f})},setTextStyle:function(a,b){var c=l._styleHooks;c.forEach(function(c){c(a,b)})}}),m=e.createClass({base:h,execute:function(a,b){var c=a.getSelectedNode();c&&(c.setText(b),c.render(),a.layout())},queryState:function(a){return 1==a.getSelectedNodes().length?0:-1},queryValue:function(a){var b=a.getSelectedNode();return b?b.getText():null}});f.extend(l,{_styleHooks:[],registerStyleHook:function(a){l._styleHooks.push(a)}}),e.extendClass(g,{getTextGroup:function(){return this.getRenderer("TextRenderer").getRenderShape()}}),i.register("text",{commands:{text:m},renderers:{center:l}}),d.exports=l}},b[93]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44),b.r(46),b.r(34)),g=b.r(45),h=(b.r(52),e.createClass("ViewDragger",{constructor:function(a){this._minder=a,this._enabled=!1,this._bind();var b=this;this._minder.getViewDragger=function(){return b},this.setEnabled(!1)},isEnabled:function(){return this._enabled},setEnabled:function(a){var b=this._minder.getPaper();b.setStyle("cursor",a?"pointer":"default"),b.setStyle("cursor",a?"-webkit-grab":"default"),this._enabled=a},move:function(a,b){var c=(this._minder,this.getMovement().offset(a));this.moveTo(c,b)},moveTo:function(a,b){if(b){var c=this;return this._moveTimeline&&this._moveTimeline.stop(),this._moveTimeline=this._minder.getRenderContainer().animate(new e.Animator(this.getMovement(),a,function(a,b){c.moveTo(b)}),b,"easeOutCubic"),this._moveTimeline.on("finish",function(){c._moveTimeline=null}),this}this._minder.getRenderContainer().setTranslate(a.round()),this._minder.fire("viewchange")},getMovement:function(){var a=this._minder.getRenderContainer().transform.translate;return a?a[0]:new e.Point},getView:function(){var a=this._minder,b=a._lastClientSize||{width:a.getRenderTarget().clientWidth,height:a.getRenderTarget().clientHeight},c=this.getMovement(),d=new e.Box(0,0,b.width,b.height),f=a.getPaper().getViewPortMatrix();return f.inverse().translate(-c.x,-c.y).transformBox(d)},_bind:function(){function a(a){if(d){d=null,a.stopPropagation(),c&&(b.setEnabled(!1),c=!1,"hand"==b._minder.getStatus()&&b._minder.rollbackStatus());var e=b._minder.getPaper();e.setStyle("cursor","hand"==b._minder.getStatus()?"-webkit-grab":"default"),b._minder.fire("viewchanged")}}var b=this,c=!1,d=null,f=null;this._minder.on("normal.mousedown normal.touchstart inputready.mousedown inputready.touchstart readonly.mousedown readonly.touchstart",function(a){2==a.originEvent.button&&a.originEvent.preventDefault(),(a.getTargetNode()==this.getRoot()||2==a.originEvent.button||a.originEvent.altKey)&&(d=a.getPosition("view"),c=!0)}).on("normal.mousemove normal.touchmove readonly.mousemove readonly.touchmove inputready.mousemove inputready.touchmove",function(a){if("touchmove"==a.type&&a.preventDefault(),c){var f=e.Vector.fromPoints(d,a.getPosition("view"));if(f.length()>10){this.setStatus("hand",!0);var g=b._minder.getPaper();g.setStyle("cursor","-webkit-grabbing")}}}).on("hand.beforemousedown hand.beforetouchstart",function(a){if(b.isEnabled()){d=a.getPosition("view"),a.stopPropagation();var c=b._minder.getPaper();c.setStyle("cursor","-webkit-grabbing")}}).on("hand.beforemousemove hand.beforetouchmove",function(a){if(d){f=a.getPosition("view");var c=e.Vector.fromPoints(d,f);b.move(c),a.stopPropagation(),a.preventDefault(),a.originEvent.preventDefault(),d=f}}).on("mouseup touchend",a),window.addEventListener("mouseup",a),this._minder.on("contextmenu",function(a){a.preventDefault()})}}));g.register("View",function(){var a=e.createClass("ToggleHandCommand",{base:f,execute:function(a){"hand"!=a.getStatus()?a.setStatus("hand",!0):a.rollbackStatus(),this.setContentChanged(!1)},queryState:function(a){return"hand"==a.getStatus()?1:0},enableReadOnly:!0}),b=e.createClass("CameraCommand",{base:f,execute:function(a,b){b=b||a.getRoot();var c=a.getPaper().getViewPort(),d=b.getRenderContainer().getRenderBox("view"),f=c.center.x-d.x-d.width/2,g=c.center.y-d.y,h=a._viewDragger,i=a.getOption("viewAnimationDuration");h.move(new e.Point(f,g),i),this.setContentChanged(!1)},enableReadOnly:!0}),c=e.createClass("MoveCommand",{base:f,execute:function(a,b){var c=a._viewDragger,d=a._lastClientSize,f=a.getOption("viewAnimationDuration");switch(b){case"up":c.move(new e.Point(0,d.height/2),f);break;case"down":c.move(new e.Point(0,-d.height/2),f);break;case"left":c.move(new e.Point(d.width/2,0),f);break;case"right":c.move(new e.Point(-d.width/2,0),f)}},enableReadOnly:!0});return{init:function(){this._viewDragger=new h(this)},commands:{hand:a,camera:b,move:c},events:{statuschange:function(a){this._viewDragger.setEnabled("hand"==a.currentStatus)},mousewheel:function(a){var b,c;if(a=a.originEvent,!a.ctrlKey&&!a.shiftKey){"wheelDeltaX"in a?(b=a.wheelDeltaX||0,c=a.wheelDeltaY||0):(b=0,c=a.wheelDelta),this._viewDragger.move({x:b/2.5,y:c/2.5});var d=this;clearTimeout(this._mousewheeltimer),this._mousewheeltimer=setTimeout(function(){d.fire("viewchanged")},100),a.preventDefault()}},"normal.dblclick readonly.dblclick":function(a){a.kityEvent.targetShape instanceof e.Paper&&this.execCommand("camera",this.getRoot(),800)},paperrender:function(){this.execCommand("camera",null,0),this._lastClientSize={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight}},resize:function(a){var b={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight},c=this._lastClientSize;this._viewDragger.move(new e.Point((b.width-c.width)/2|0,(b.height-c.height)/2|0)),this._lastClientSize=b},"selectionchange layoutallfinish":function(a){var b=this.getSelectedNode();if(b){var c=this._viewDragger,d=c.getView(),f=b.getLayoutBox(),g=150,h=150,i=0,j=0;f.right>d.right-h?i+=d.right-f.right-g:f.left<d.left+h&&(i+=d.left-f.left+g),f.bottom>d.bottom-h&&(j+=d.bottom-f.bottom-g),f.top<d.top+h&&(j+=d.top-f.top+g),(i||j)&&c.move(new e.Point(i,j))}}}}})}},b[94]={value:function(a,c,d){var e=b.r(42),f=(b.r(58),b.r(44)),g=(b.r(46),b.r(34)),h=b.r(45);b.r(52);h.register("Zoom",function(){function a(){var a=h._zoomValue>=100?"optimize-speed":"geometricPrecision";h.getRenderContainer().setAttr("text-rendering",a)}function b(a){var b=a.shapeNode,c=b.getCTM(),d=new e.Matrix(c.a,c.b,c.c,c.d,(0|c.e)+.5,(0|c.f)+.5);b.setAttribute("transform","matrix("+d.toString()+")")}function c(b,c){var f=b.getPaper();f.getViewPort();if(c){a();var g=b.getOption("zoomAnimationDuration");if(b.getRoot().getComplex()>200||!g)b._zoomValue=c,b.zoom(c),b.fire("viewchange");else{var h=new e.Animator({beginValue:b._zoomValue,finishValue:c,setter:function(a,b){a.zoom(b)}});b._zoomValue=c,d&&d.pause(),d=h.start(b,g,"easeInOutSine"),d.on("finish",function(){b.fire("viewchange")})}b.fire("zoom",{zoom:c})}}var d,h=this;e.extendClass(f,{zoom:function(a){var c=this.getPaper(),d=c.getViewPort();d.zoom=a/100,d.center={x:d.center.x,y:d.center.y},c.setViewPort(d),100==a&&b(c)},getZoomValue:function(){return this._zoomValue}});var i=e.createClass("Zoom",{base:g,execute:c,queryValue:function(a){return a._zoomValue}}),j=e.createClass("ZoomInCommand",{base:g,execute:function(a){c(a,this.nextValue(a))},queryState:function(a){return+!this.nextValue(a)},nextValue:function(a){var b,c=a.getOption("zoom");for(b=0;b<c.length;b++)if(c[b]>a._zoomValue)return c[b];return 0},enableReadOnly:!0}),k=e.createClass("ZoomOutCommand",{base:g,execute:function(a){c(a,this.nextValue(a))},queryState:function(a){return+!this.nextValue(a)},nextValue:function(a){var b,c=a.getOption("zoom");for(b=c.length-1;b>=0;b--)if(c[b]<a._zoomValue)return c[b];return 0},enableReadOnly:!0});return{init:function(){this._zoomValue=100,this.setDefaultOptions({zoom:[10,20,50,100,200]}),a()},commands:{zoomin:j,zoomout:k,zoom:i},events:{"normal.mousewheel readonly.mousewheel":function(a){if(a.originEvent.ctrlKey||a.originEvent.metaKey){var b=a.originEvent.wheelDelta,c=this;e.Browser.mac||(b=-b),Math.abs(b)>100&&(clearTimeout(this._wheelZoomTimeout),this._wheelZoomTimeout=setTimeout(function(){c.getPaper()._zoom||1;0>b?c.execCommand("zoom-in"):b>0&&c.execCommand("zoom-out")},100),a.originEvent.preventDefault())}}},commandShortcutKeys:{zoomin:"ctrl+=",zoomout:"ctrl+-"}}})}},b[95]={value:function(a,c,d){var e=b.r(37);e.registerProtocol("json",d.exports={fileDescription:"KityMinder 格式",fileExtension:".km",dataType:"json",mineType:"application/json",encode:function(a){return JSON.stringify(a)},decode:function(a){return JSON.parse(a)}})}},b[96]={value:function(a,c,d){function e(a){return f(a,1).join("\n")}function f(a,b){var c=[];b=b||1;var d=g(b);c.push(d+" "+a.data.text),c.push(o);var e=a.data.note;if(e){var h=/^#/.test(e);h&&(c.push(p),e=e.replace(/^#+/gm,function(a){return d+a})),c.push(e),h&&c.push(q),c.push(o)}return a.children&&a.children.forEach(function(a){c=c.concat(f(a,b+1))}),c}function g(a){for(var b="";a--;)b+="#";return b}function h(a){var b,c,d,e,f,g,h,m={};a=a.replace(/^(.+)\n={3,}/,function(a,b){return"# "+b}),b=a.split(n);for(var o=0;o<b.length;o++)c=b[o],d=k(c),d.noteClose?g=!1:d.noteStart?g=!0:(h=d.codeBlock?!h:h,g||h||!d.level||d.level>e+1?f&&j(f,c):(e=d.level,f=i(d.content,m[e-1]),m[e]=f));return l(m[1]),m[1]}function i(a,b){var c={data:{text:a,note:""}};return b&&(b.children?b.children.push(c):b.children=[c]),c}function j(a,b){a.data.note+=b+"\n"}function k(a){var b=/^(#+)?\s*(.*)$/.exec(a);return{level:b[1]&&b[1].length||null,content:b[2],noteStart:a==p,noteClose:a==q,codeBlock:/^\s*```/.test(a)}}function l(a){if(/\S/.test(a.data.note)){for(var b=a.data.note.split("\n");b.length&&!/\S/.test(b[0]);)b.shift();for(;b.length&&!/\S/.test(b[b.length-1]);)b.pop();a.data.note=b.join("\n")}else a.data.note=null,delete a.data.note;a.children&&a.children.forEach(l)}var m=b.r(37),n=/\r\n|\r|\n/,o="",p="<!--Note-->",q="<!--/Note-->";m.registerProtocol("markdown",d.exports={fileDescription:"Markdown/GFM 格式",fileExtension:".md",mineType:"text/markdown",dataType:"markdown",encode:function(a){return e(a)},decode:function(a){return h(a)}})}},b[97]={value:function(a,c,d){function e(a,b){return new j(function(b,c){var d=document.createElement("img");d.onload=function(){b(this)},d.onerror=function(a){c(a)},d.crossOrigin="",d.src=a})}function f(a){var b,c,d,e,f,g,h=a.getPaper(),i=(h.container,a.getRenderContainer()),j=i.getRenderBox(),l=j.width+1,m=j.height+1;return b=h.shapeNode.getAttribute("transform"),h.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),i.translate(-j.x,-j.y),c=h.container.innerHTML,i.translate(j.x,j.y),h.shapeNode.setAttribute("transform",b),d=document.createElement("div"),d.innerHTML=c,e=d.querySelector("svg"),e.setAttribute("width",j.width+1),e.setAttribute("height",j.height+1),e.setAttribute("style",'font-family: Arial, "Microsoft Yahei","Heiti SC";'),d=document.createElement("div"),d.appendChild(e),c=d.innerHTML,c=c.replace(' xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:ns1:xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:NS2="" NS2:xmlns:ns1=""',""),c=c.replace(/&nbsp;/g,"&#xa0;"),f=new Blob([c],{type:"image/svg+xml"}),g=k.createObjectURL(f),{width:l,height:m,dataUrl:g,xml:c}}function g(a,b){function c(a,b){a.save(),a.fillStyle=b,a.fillRect(0,0,j.width,j.height),a.restore()}function d(a,b,c,d){a.drawImage(b,c,d)}function g(a){return a.toDataURL("png")}function i(){return e(s).then(function(a){return d(l,a,t,t),k.revokeObjectURL(s),g(j)})}var j=document.createElement("canvas"),l=j.getContext("2d"),m=b.getStyle("background").toString(),n=/url\((.+)\)/.exec(m),o=h.Color.parse(m),p=f(b),q=p.width,r=p.height,s=p.dataUrl,t=20;return j.width=q+2*t,j.height=r+2*t,n?e(n[1]).then(function(a){return c(l,l.createPattern(a,"repeat")),i()}):(c(l,o.toString()),i())}var h=b.r(42),i=b.r(37),j=b.r(50),k=window.URL||window.webkitURL||window;i.registerProtocol("png",d.exports={fileDescription:"PNG 图片",fileExtension:".png",mineType:"image/png",dataType:"png",encode:g})}},b[98]={value:function(a,c,d){var e=b.r(37);e.registerProtocol("svg",d.exports={fileDescription:"SVG 矢量图",fileExtension:".svg",mineType:"image/svg+xml",dataType:"svg",encode:function(a,b){var c,d,e,f=b.getPaper(),g=f.shapeNode.getAttribute("transform"),h=b.getRenderContainer(),i=h.getRenderBox(),j=(h.getTransform(),i.width),k=i.height,l=20;return f.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),c=f.container.innerHTML,f.shapeNode.setAttribute("transform",g),d=document.createElement("div"),d.innerHTML=c,e=d.querySelector("svg"),e.setAttribute("width",j+2*l|0),e.setAttribute("height",k+2*l|0),e.setAttribute("style",'font-family: Arial, "Microsoft Yahei",  "Heiti SC"; background: '+b.getStyle("background")),e.setAttribute("viewBox",[i.x-l|0,i.y-l|0,j+2*l|0,k+2*l|0].join(" ")),d=document.createElement("div"),d.appendChild(e),c=d.innerHTML,c=c.replace(/&nbsp;/g,"&#xa0;")}})}},b[99]={value:function(a,c,d){function e(a,b){for(var c="";b--;)c+=a;return c}function f(a,b){var c="";return b=b||0,c+=e(n,b),c+=a.data.text+l,a.children&&a.children.forEach(function(a){c+=f(a,b+1)}),c}function g(a){return!/\S/.test(a)}function h(a){for(var b=0;a.charAt(b)===n;)b++;return b}function i(a){return{data:{text:a.replace(new RegExp("^"+n+"*"),"")}}}function j(a){function b(a,b){var c=a.children||(a.children=[]);c.push(b)}for(var c,d,e,f,j={},k=a.split(m),l=0;l<k.length;l++)if(d=k[l],!g(d)){if(e=h(d),f=i(d),0===e){if(c)throw new Error("Invalid local format");c=f}else{if(!j[e-1])throw new Error("Invalid local format");b(j[e-1],f)}j[e]=f}return c}var k=b.r(37),l="\r",m=/\r\n|\r|\n/,n="	";k.registerProtocol("text",d.exports={fileDescription:"大纲文本",fileExtension:".txt",dataType:"text",mineType:"text/plain",encode:function(a){return f(a,0)},decode:function(a){return j(a)}})}},b[100]={value:function(a,c,d){var e=b.r(56);e.register("default",{getLayout:function(a){if(a.getData("layout"))return a.getData("layout");var b=a.getLevel();return 0===b?"mind":1===b?a.getLayoutPointPreview().x>0?"right":"left":a.parent.getLayout()},getConnect:function(a){return 1==a.getLevel()?"arc":"under"}})}},b[101]={value:function(a,c,d){var e=b.r(56);e.register("filetree",{getLayout:function(a){return a.getData("layout")?a.getData("layout"):a.isRoot()?"bottom":"filetree-down"},getConnect:function(a){return 1==a.getLevel()?"poly":"l"}})}},b[102]={value:function(a,c,d){var e=b.r(56);e.register("fish-bone",{getLayout:function(a){if(a.getData("layout"))return a.getData("layout");var b=a.getLevel();return 0===b?"fish-bone-master":1===b?"fish-bone-slave":a.getLayoutPointPreview().y>0?"filetree-up":"filetree-down"},getConnect:function(a){switch(a.getLevel()){case 1:return"fish-bone-master";case 2:return"line";default:return"l"}}})}},b[103]={value:function(a,c,d){var e=b.r(56);e.register("right",{getLayout:function(a){return a.getData("layout")||"right"},getConnect:function(a){return 1==a.getLevel()?"arc":"bezier"}})}},b[104]={value:function(a,c,d){var e=b.r(56);e.register("structure",{getLayout:function(a){return a.getData("layout")||"bottom"},getConnect:function(a){return"poly"}})}},b[105]={value:function(a,c,d){var e=b.r(56);e.register("tianpan",{getLayout:function(a){if(a.getData("layout"))return a.getData("layout");var b=a.getLevel();return 0===b?"tianpan":a.parent.getLayout()},getConnect:function(a){return"arc_tp"}})}},b[106]={value:function(a,c,d){var e=b.r(57);["classic","classic-compact"].forEach(function(a){var b="classic-compact"==a;e.register(a,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":b?[10,25]:[15,25],"root-margin":b?[15,25]:[30,100],"root-radius":30,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":b?[5,15]:[6,20],"main-margin":b?[5,10]:20,"main-radius":10,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"white","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":[5,10],"sub-margin":b?[5,10]:[15,20],"sub-tree-margin":30,"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})})}},b[107]={value:function(a,c,d){var e=b.r(57);e.register("fish",{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',
"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":[35,35],"root-margin":30,"root-radius":100,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":[6,20],"main-margin":[20,20],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":[10],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":3,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}},b[108]={value:function(a,c,d){function e(a,b,c){return h.Color.createHSL(a,b,c)}function f(a,b){return{background:"#fbfbfb","root-color":"white","root-background":e(a,37,60),"root-stroke":e(a,37,60),"root-font-size":16,"root-padding":b?[6,12]:[12,24],"root-margin":b?10:[30,100],"root-radius":5,"root-space":10,"main-color":"black","main-background":e(a,33,95),"main-stroke":e(a,37,60),"main-stroke-width":1,"main-font-size":14,"main-padding":[6,20],"main-margin":b?8:20,"main-radius":3,"main-space":5,"sub-color":"black","sub-background":"transparent","sub-stroke":"none","sub-font-size":12,"sub-padding":b?[3,5]:[5,10],"sub-margin":b?[4,8]:[15,20],"sub-radius":5,"sub-space":5,"connect-color":e(a,37,60),"connect-width":1,"connect-radius":5,"selected-stroke":e(a,26,30),"selected-stroke-width":"3","blur-selected-stroke":e(a,10,60),"marquee-background":e(a,100,80).set("a",.1),"marquee-stroke":e(a,37,60),"drop-hint-color":e(a,26,35),"drop-hint-width":5,"order-hint-area-color":e(a,100,30).set("a",.5),"order-hint-path-color":e(a,100,25),"order-hint-path-width":1,"text-selection-color":e(a,100,20),"line-height":1.5}}var g,h=b.r(42),i=b.r(57),j={red:0,soil:25,green:122,blue:204,purple:246,pink:334};for(g in j)i.register("fresh-"+g,f(j[g])),i.register("fresh-"+g+"-compat",f(j[g],!0))}},b[109]={value:function(a,c,d){var e=b.r(57);["snow","snow-compact"].forEach(function(a){var b="snow-compact"==a;e.register(a,{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":24,"root-padding":b?[5,10]:[15,25],"root-margin":b?15:30,"root-radius":5,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":16,"main-padding":b?[4,10]:[6,20],"main-margin":b?[5,10]:[20,40],"main-radius":5,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","sub-color":"black","sub-background":"white","sub-stroke":"white","sub-font-size":12,"sub-padding":[5,10],"sub-margin":b?[5,10]:[10,20],"sub-radius":5,"sub-space":5,"connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})})}},b[110]={value:function(a,c,d){function e(a){var b="tianpan-compact"==a;return{background:'#3A4144 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQzg5QTQ0NDhENzgxMUUzOENGREE4QTg0RDgzRTZDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQzg5QTQ0NThENzgxMUUzOENGREE4QTg0RDgzRTZDNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMwOEQ1NDRGOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMwOEQ1NDUwOEQ3NzExRTM4Q0ZEQThBODREODNFNkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+e9P33AAAACVJREFUeNpisXJ0YUACTAyoAMr/+eM7EGGRZ4FQ7BycEAZAgAEAHbEGtkoQm/wAAAAASUVORK5CYII=") repeat',"root-color":"#430","root-background":"#e9df98","root-stroke":"#e9df98","root-font-size":25,"root-padding":b?15:20,"root-margin":b?[15,25]:100,"root-radius":30,"root-space":10,"root-shadow":"rgba(0, 0, 0, .25)","root-shape":"circle","main-color":"#333","main-background":"#a4c5c0","main-stroke":"#a4c5c0","main-font-size":15,"main-padding":b?10:12,"main-margin":b?10:12,"main-radius":10,"main-space":5,"main-shadow":"rgba(0, 0, 0, .25)","main-shape":"circle","sub-color":"#333","sub-background":"#99ca6a","sub-stroke":"#a4c5c0","sub-font-size":13,"sub-padding":5,"sub-margin":b?6:10,"sub-tree-margin":30,"sub-radius":5,"sub-space":5,"sub-shadow":"rgba(0, 0, 0, .25)","sub-shape":"circle","connect-color":"white","connect-width":2,"main-connect-width":3,"connect-radius":5,"selected-background":"rgb(254, 219, 0)","selected-stroke":"rgb(254, 219, 0)","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.4}}var f=b.r(57);f.register("tianpan",e("tianpan")),f.register("tianpan-compact",e("tianpan-compact"))}},b[111]={value:function(a,c,d){var e=b.r(57);e.register("wire",{background:"black",color:"#999",stroke:"none",padding:10,margin:20,"font-size":14,"connect-color":"#999","connect-width":1,"selected-background":"#999","selected-color":"black","marquee-background":"rgba(255,255,255,.3)","marquee-stroke":"white","drop-hint-color":"yellow","sub-drop-hint-width":2,"main-drop-hint-width":4,"root-drop-hint-width":4,"order-hint-area-color":"rgba(0, 255, 0, .5)","order-hint-path-color":"#0f0","order-hint-path-width":1,"text-selection-color":"rgb(27,171,255)","line-height":1.5})}};var c={"expose-editor":1};a("expose-editor")}();
/*!
 * ====================================================
 * km-editor - v0.0.1 - 2015-05-04
 * https://github.com/fex-team/kityminder-editor
 * GitHub: https://github.com/fex-team/kityminder-editor 
 * Copyright (c) 2015 ; Licensed 
 * ====================================================
 */

!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(a,c,d){function e(a){g.push(a)}function f(a){this.selector=a;for(var b=0;b<g.length;b++)"function"==typeof g[b]&&g[b].call(this,this)}var g=[];return f.assemble=e,e(b.r(5)),e(b.r(6)),e(b.r(11)),e(b.r(15)),e(b.r(8)),e(b.r(9)),e(b.r(12)),e(b.r(7)),e(b.r(10)),e(b.r(13)),e(b.r(14)),d.exports=f}},b[1]={value:function(a,c,d){return d.exports=kityminder.Editor=b.r(0)}},b[2]={value:function(a,b,c){return c.exports=window.HotBox}},b[3]={value:function(a,b,c){}},b[4]={value:function(a,b,c){return c.exports=window.kityminder.Minder}},b[5]={value:function(a,b,c){function d(){var a;if(a="string"==typeof this.selector?document.querySelector(this.selector):this.selector,!a)throw new Error("Invalid selector: "+this.selector);a.classList.add("km-editor"),this.container=a}return c.exports=d}},b[6]={value:function(a,c,d){function e(a,b,c,d){if(a.when!=b)return!1;if("*"!=a.enter&&a.enter!=d)return!1;if("*"==a.exit||a.exit==c)return!0}function f(a){var b=a,c=" - ",d=" -> ",f=[];this.jump=function(a,c){if(!c)throw new Error("Please tell fsm the reason to jump");var d,g,h=b,j=[h,a].concat([].slice.call(arguments,1));for(d=0;d<f.length;d++)if(g=f[d],e(g.condition,"before",h,a)&&g.apply(null,j))return;for(b=a,i.log("[{0}] {1} -> {2}",c,h,a),d=0;d<f.length;d++)g=f[d],e(g.condition,"after",h,a)&&g.apply(null,j);return b},this.state=function(){return b},this.when=function(a,b){1==arguments.length&&(b=a,a="* -> *");var e,g,h,i;if(g=a.split(c),2==g.length?e="before":(g=a.split(d),2==g.length&&(e="after")),!e)throw new Error("Illegal fsm condition: "+a);h=g[0],i=g[1],b.condition={when:e,exit:h,enter:i},f.push(b)}}function g(){this.fsm=new f("normal")}var h=b.r(16),i=new h("fsm");return d.exports=g}},b[7]={value:function(a,c,d){function e(){function a(){m=[],n=[],k=o.exportJson()}function b(){var a=o.exportJson(),b=f(a,k);if(b.length){for(m.push(b);m.length>q;)m.shift();return k=a,!0}}function c(){var a=o.exportJson();n.push(f(a,k)),k=a}function d(){l=!0;var a=m.pop();a&&(o.applyPatches(a),c()),l=!1}function e(){l=!0;var a=n.pop();n&&(o.applyPatches(a),b()),l=!1}function g(){l||b()&&(n=[])}function h(){return!!m.length}function i(){return!!n.length}function j(a){if(l){var b=a.patch;switch(b.express){case"node.add":o.select(b.node.getChild(b.index),!0);break;case"node.remove":case"data.replace":case"data.remove":case"data.add":o.select(b.node,!0)}}}var k,l,m,n,o=this.minder,p=this.hotbox,q=100;this.history={reset:a,undo:d,redo:e,hasUndo:h,hasRedo:i},a(),o.on("contentchange",g),o.on("import",a),o.on("patch",j);var r=p.state("main");r.button({position:"top",label:"撤销",key:"Ctrl + Z",enable:h,action:d,next:"idle"}),r.button({position:"top",label:"重做",key:"Ctrl + Y",enable:i,action:e,next:"idle"})}var f=b.r(19);return window.diff=f,d.exports=e}},b[8]={value:function(a,c,d){function e(){var a=this.fsm,b=this.minder,c=(this.receiver,this.container),d=new f(c);a.when("normal -> hotbox",function(a,c,e){var f,g=b.getSelectedNode();if(g){var h=g.getRenderBox();f={x:h.cx,y:h.cy}}d.active("main",f)}),a.when("normal -> normal",function(a,c,e,f){if("shortcut-handle"==e){var g=d.dispatch(f);g?f.preventDefault():b.dispatchKeyEvent(f)}}),this.hotbox=d}var f=b.r(2);return d.exports=e}},b[9]={value:function(a,c,d){function e(){function a(){j.when("* -> input",e),j.when("input -> *",function(a,b,c){switch(c){case"input-cancel":return h();case"input-commit":default:return f()}}),k.on("beforemousedown",function(){"input"==j.state()&&j.jump("normal","input-commit")}),k.on("dblclick",function(){k.getSelectedNode()&&d()})}function b(){g.flaged&&n.classList.add("debug"),n.onmousedown=function(a){a.stopPropagation()},k.on("layoutallfinish viewchange viewchanged selectionchange",function(a){("viewchange"!=a.type||"input"==j.state())&&i()}),i()}function c(){l.state("main").button({position:"center",label:"编辑",key:"F2",enable:function(){return-1!=k.queryCommandState("text")},action:d})}function d(){n.innerText=k.queryCommandValue("text"),j.jump("input","input-request"),m.selectAll()}function e(){var a=k.getSelectedNode();if(a){var b=a.getData("font-size")||a.getStyle("font-size");n.style.fontSize=b+"px",n.style.minWidth=0,n.style.minWidth=n.clientWidth+"px",n.classList.add("input"),n.focus()}}function f(){var a=n.innerText;k.execCommand("text",a.replace(/^\n*|\n*$/g,"")),h()}function h(){n.classList.remove("input"),m.selectAll()}function i(){var a=i,b=k.getSelectedNode();b&&(a.timer||(a.timer=setTimeout(function(){var c=b.getRenderBox("TextRenderer");n.style.left=Math.round(c.x)+"px",n.style.top=Math.round(g.flaged?c.bottom+30:c.y)+"px",a.timer=0})))}var j=this.fsm,k=this.minder,l=this.hotbox,m=this.receiver,n=m.element;b(),a(),c(),this.editText=d}b.r(18);var f=b.r(16),g=new f("input");return d.exports=e}},b[10]={value:function(a,c,d){function e(a){return a.ctrlKey||a.metaKey||a.altKey?!1:a.keyCode>=65&&a.keyCode<=90?!0:a.keyCode>=48&&a.keyCode<=57?!0:229==a.keyCode?!0:void 0}function f(){var a=this.fsm,b=this.minder,c=this.receiver,d=this.container,f=c.element,h=this.hotbox;c.listen("normal",function(c){if("keydown"==c.type&&c.is("Space"))return c.preventDefault(),a.jump("hotbox","space-trigger");if("keydown"==c.type&&e(c)){if(b.getSelectedNode())return a.jump("input","user-input");f.innerHTML=""}return"keydown"==c.type?a.jump("normal","shortcut-handle",c):void 0}),c.listen("hotbox",function(b){b.preventDefault();h.dispatch(b);return h.state()==g.STATE_IDLE&&"hotbox"==a.state()?a.jump("normal","hotbox-idle"):void 0}),c.listen("input",function(b){if("keydown"==b.type){if(b.is("Enter"))return b.preventDefault(),a.jump("normal","input-commit");if(b.is("Esc"))return b.preventDefault(),a.jump("normal","input-cancel");(b.is("Tab")||b.is("Shift + Tab"))&&b.preventDefault()}});var i,j,k=2;d.addEventListener("mousedown",function(b){"hotbox"==a.state()?(h.active(g.STATE_IDLE),a.jump("normal","blur")):"normal"==a.state()&&b.button==k&&(i=b.clientX,j=b.clientY)},!1),d.addEventListener("mouseup",function(c){"normal"==a.state()&&c.button==k&&c.clientX==i&&c.clientY==j&&b.getSelectedNode()&&a.jump("hotbox","content-menu")},!1),h.$element.addEventListener("mousedown",function(a){a.stopPropagation()})}var g=b.r(2);return d.exports=f}},b[11]={value:function(a,c,d){function e(){var a=new f({enableKeyReceiver:!1,enableAnimation:!1});a.renderTo(this.selector),a.setTheme(null),a.select(a.getRoot(),!0),a.execCommand("text","中心主题"),this.minder=a}var f=b.r(4);return d.exports=e}},b[12]={value:function(a,b,c){function d(){var a=this,b=this.minder,c=this.hotbox,d=this.fsm,e=c.state("main"),f=["前移:Alt+Up:ArrangeUp","下级:Tab:AppendChildNode","同级:Enter:AppendSiblingNode","后移:Alt+Down:ArrangeDown","删除:Delete|Backspace:RemoveNode","归纳:Shift+Tab|Shift+Insert:AppendParentNode"];f.forEach(function(c){var f=c.split(":"),g=f.shift(),h=f.shift(),i=f.shift();e.button({position:"ring",label:g,key:h,action:function(){0===i.indexOf("Append")?(b.execCommand(i,"新主题"),a.editText()):(b.execCommand(i),d.jump("normal","command-executed"))},enable:function(){return-1!=b.queryCommandState(i)}})}),e.button({position:"ring",key:"/",action:function(){b.queryCommandState("expand")?b.queryCommandState("collapse")||b.execCommand("collapse"):b.execCommand("expand")},enable:function(){return-1!=b.queryCommandState("expand")||-1!=b.queryCommandState("collapse")},beforeShow:function(){b.queryCommandState("expand")?this.$button.children[0].innerHTML="收起":this.$button.children[0].innerHTML="展开"}})}return c.exports=d}},b[13]={value:function(a,b,c){function d(){var a=this.minder,b=this.hotbox,c=b.state("main");c.button({position:"top",label:"优先级",key:"P",next:"priority"});var d=b.state("priority");"123456789".replace(/./g,function(b){d.button({position:"ring",label:"P"+b,key:b,action:function(){a.execCommand("Priority",b)}})}),d.button({position:"center",label:"移除",key:"Del",action:function(){a.execCommand("Priority",0)}}),d.button({position:"top",label:"返回",key:"esc",next:"back"})}return c.exports=d}},b[14]={value:function(a,b,c){function d(){var a=this.minder,b=this.hotbox,c=b.state("main");c.button({position:"top",label:"进度",key:"G",next:"progress"});var d=b.state("progress");"012345678".replace(/./g,function(b){d.button({position:"ring",label:"G"+b,key:b,action:function(){a.execCommand("Progress",parseInt(b)+1)}})}),d.button({position:"center",label:"移除",key:"Del",action:function(){a.execCommand("Progress",0)}}),d.button({position:"top",label:"返回",key:"esc",next:"back"})}return c.exports=d}},b[15]={value:function(a,c,d){function e(){function a(a){a.is=function(a){for(var b=a.split("|"),c=0;c<b.length;c++)if(f.is(this,b[c]))return!0;return!1};for(var c,d=0;d<g.length;d++)if(c=g[d],("*"==c.notifyState||c.notifyState==b.state())&&c.call(null,a))return}var b=this.fsm,c=this.minder,d=document.createElement("div");d.contentEditable=!0,d.classList.add("receiver"),d.onkeydown=d.onkeypress=d.onkeyup=a,this.container.appendChild(d);var e={element:d,selectAll:function(){d.innerHTML||(d.innerHTML="&nbsp;");var a=document.createRange(),b=window.getSelection();a.selectNodeContents(d),b.removeAllRanges(),b.addRange(a),d.focus()}};e.selectAll(),c.on("beforemousedown",e.selectAll);var g=[];e.listen=function(a,b){1==arguments.length&&(b=a,a="*"),b.notifyState=a,g.push(b)},this.receiver=e}var f=b.r(20);return d.exports=e}},b[16]={value:function(a,c,d){function e(){}function f(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b}function g(a){var b=this.flaged=-1!=window.location.search.indexOf(a);if(b){var c=f(a)%360,d=h("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",c),g="background: none; color: black;";this.log=function(){var b=h.apply(null,arguments);console.log(h("%c{0}%c{1}",a,b),d,g)}}else this.log=e}var h=b.r(17);return d.exports=g}},b[17]={value:function(a,b,c){function d(a,b){return"object"!=typeof b&&(b=[].slice.call(arguments,1)),String(a).replace(/\{(\w+)\}/gi,function(a,c){return b[c]||c})}return c.exports=d}},b[18]={value:function(a,b,c){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var a,b,c=window.getSelection(),d=[];for(b=0;b<c.rangeCount;b++)d[b]=c.getRangeAt(b);for(c.removeAllRanges(),c.selectAllChildren(this),a=c.toString(),c.removeAllRanges(),b=0;b<d.length;b++)c.addRange(d[b]);return a}),HTMLElement.prototype.__defineSetter__("innerText",function(a){this.innerHTML=a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},b[19]={value:function(a,b,c){function d(a){return-1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function e(a){return"object"==typeof a?JSON.parse(JSON.stringify(a)):a}function f(a,b,c,g){for(var i=h(b),j=h(a),k=!1,l=!1,m=j.length-1;m>=0;m--){var n=j[m],o=a[n];if(b.hasOwnProperty(n)){var p=b[n];"object"==typeof o&&null!=o&&"object"==typeof p&&null!=p?f(o,p,c,g+"/"+d(n)):o!=p&&(k=!0,c.push({op:"replace",path:g+"/"+d(n),value:e(p)}))}else c.push({op:"remove",path:g+"/"+d(n)}),l=!0}if(l||i.length!=j.length)for(var m=0;m<i.length;m++){var n=i[m];a.hasOwnProperty(n)||c.push({op:"add",path:g+"/"+d(n),value:e(b[n])})}}function g(a,b){var c=[];return f(a,b,c,""),c}var h=function(){return Object.keys?Object.keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}();return c.exports=g}},b[20]={value:function(a,c,d){function e(a){return"string"==typeof a?h(a):g(a)}function f(a,b){return a&&b&&e(a)==e(b)}function g(a){var b=0;return(a.ctrlKey||a.metaKey)&&(b|=j),a.altKey&&(b|=k),a.shiftKey&&(b|=l),-1==[16,17,18,91].indexOf(a.keyCode)&&(b|=a.keyCode),b}function h(a){var b=0;return a.toLowerCase().split(/\s*\+\s*/).forEach(function(a){switch(a){case"ctrl":case"cmd":b|=j;break;case"alt":b|=k;break;case"shift":b|=l;break;default:b|=i[a]}}),b}var i=b.r(21),j=4096,k=8192,l=16384;c.hash=e,c.is=f}},b[21]={value:function(a,b,c){var d={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var e in d)d.hasOwnProperty(e)&&(d[e.toLowerCase()]=d[e]);var f=65,g="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(a){d[a]=f+(a.charCodeAt(0)-g)});var h=9;do d[h.toString()]=h+48;while(--h);c.exports=d}};var c={"expose-editor":1};angular.module("kmEditorUI",["ui.bootstrap","ui.codemirror"]).config(["$sceDelegateProvider",function(a){a.resourceUrlWhitelist(["self","http://agroup.baidu.com:8910/**","http://agroup.baidu.com:8911/**"])}]).controller("uiController",["$scope","$element",function(a,b){a.initEditor=function(a,b){console.log(a,b)}}]),angular.module("kmEditorUI").run(["$templateCache",function(a){"use strict";a.put("ui/directive/controlPanel/controlPanel.html",'<tabset><tab heading="思路"><accordion close-others="false"><accordion-group heading="优先级" is-open="true"><priority-editor minder="minder"></priority-editor></accordion-group><accordion-group heading="进度" is-open="true"><progress-editor minder="minder"></progress-editor></accordion-group><accordion-group heading="资源" is-open="true"><resource-editor minder="minder"></resource-editor></accordion-group></accordion></tab><tab heading="备注" select="refreshNotePanel()"><note-editor minder="minder" class="km-note"></note-editor></tab></tabset>'),a.put("ui/directive/kityminderEditor/kityminderEditor.html",'<div class="minder-editor-container"><div class="minder-editor"></div><div class="control-panel" control-panel ng-if="minder"></div><div class="note-previewer" note-previewer ng-if="minder"></div></div>'),a.put("ui/directive/noteEditor/noteEditor.html",'<div class="km-note" ng-show="noteEnabled" ui-codemirror="{ onLoad: codemirrorLoaded }" ng-model="noteContent" ui-codemirror-opts="{\n		gfm: true,\n		breaks: true,\n		lineWrapping : true,\n		mode: \'gfm\',\n        dragDrop: false,\n        lineNumbers:true\n	 }"></div><p ng-show="!noteEnabled" class="km-note-tips">请选择节点编辑备注</p>'),a.put("ui/directive/notePreviewer/notePreviewer.html",'<div id="previewer-content" ng-show="showNotePreviewer" ng-style="previewerStyle" ng-bind-html="noteContent"></div>'),a.put("ui/directive/priorityEditor/priorityEditor.html",'<ul class="km-priority tool-group" ng-disabled="commandDisabled"><li class="km-priority-item tool-group-item" ng-repeat="p in priorities" ng-click="minder.execCommand(\'priority\', p)" ng-class="{ active: commandValue == p }" title="{{ getPriorityTitle(p) }}"><div class="km-priority-icon tool-group-icon priority-{{p}}"></div></li></ul>'),a.put("ui/directive/progressEditor/progressEditor.html",'<ul class="km-progress tool-group" ng-disabled="commandDisabled"><li class="km-progress-item tool-group-item" ng-repeat="p in progresses" ng-click="minder.execCommand(\'progress\', p)" ng-class="{ active: commandValue == p }" title="{{ getProgressTitle(p) }}"><div class="km-progress-icon tool-group-icon progress-{{p}}"></div></li></ul>'),a.put("ui/directive/resourceEditor/resourceEditor.html",'<div><div class="input-group"><input class="form-control" type="text" ng-model="newResourceName" ng-required ng-keypress="$event.keyCode == 13 && addResource(newResourceName)" ng-disabled="!enabled"> <span class="input-group-btn"><button class="btn btn-default" ng-click="addResource(newResourceName)" ng-disabled="!enabled">添加</button></span></div><ul class="km-resource"><li ng-repeat="resource in used" ng-disabled="!enabled"><label style="background: {{resourceColor(resource.name)}}"><input type="checkbox" ng-model="resource.selected" ng-disabled="!enabled"> <span>{{resource.name}}</span></label></li></ul></div>')}]),angular.module("kmEditorUI").service("commandBinder",function(){return{bind:function(a,b,c){a.on("interactchange",function(){c.commandDisabled=-1===a.queryCommandState(b),c.commandValue=a.queryCommandValue(b),c.$apply()})}}}),angular.module("kmEditorUI").filter("commandState",function(){return function(a,b){return a.queryCommandState(b)}}).filter("commandValue",function(){return function(a,b){return a.queryCommandValue(b)}}),angular.module("kmEditorUI").directive("controlPanel",function(){return{templateUrl:"ui/directive/controlPanel/controlPanel.html",restrict:"A",link:function(a){a.refreshNotePanel=function(){a.$broadcast("notePanelActived")}}}}),angular.module("kmEditorUI").directive("kityminderEditor",function(){return{restrict:"E",templateUrl:"ui/directive/kityminderEditor/kityminderEditor.html",replace:!0,scope:{onInit:"&"},link:function(a,b,c){function d(b,c){a.onInit({editor:b,minder:c})}var e=b.find(".minder-editor")[0];if("undefined"!=typeof seajs)seajs.config({base:"./src"}),define("demo",function(b){var c=b("editor"),f=window.editor=new c(e);window.localStorage.__dev_minder_content&&f.minder.importJson(JSON.parse(window.localStorage.__dev_minder_content)),f.minder.on("contentchange",function(){window.localStorage.__dev_minder_content=JSON.stringify(f.minder.exportJson())}),window.minder=window.km=f.minder,a.editor=f,a.minder=minder,a.$apply(),d(f,minder)}),seajs.use("demo");else if(window.kityminder&&window.kityminder.Editor){var f=new kityminder.Editor(e);window.editor=a.editor=f,window.minder=a.minder=f.minder,d(f,f.minder)}}}}),angular.module("kmEditorUI").directive("noteEditor",function(){return{restrict:"E",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},controller:["$scope",function(a){function b(){var b=a.noteEnabled=-1!=d.queryCommandState("note"),c=d.queryCommandValue("note")||"";b&&(a.noteContent=c),e=!0,a.$apply(),e=!1}var c,d=a.minder,e=!1;a.codemirrorLoaded=function(b){c=a.cmEditor=b,b.setSize("100%","100%")},a.$watch("noteContent",function(a){var b=-1!=d.queryCommandState("note");a&&b&&!e&&d.execCommand("note",a)}),a.$on("notePanelActived",function(){setTimeout(function(){c.refresh(),c.focus()})}),d.on("interactchange",b)}]}}),angular.module("kmEditorUI").directive("notePreviewer",["$sce",function(a){return{restrict:"A",templateUrl:"ui/directive/notePreviewer/notePreviewer.html",link:function(b,c){function d(c,d){var e=c.getRenderer("NoteIconRenderer").getRenderShape(),g=e.getRenderBox("screen"),i=c.getData("note");f[0].scrollTop=0;var j=marked(i);d&&(j=j.replace(new RegExp("("+d+")","ig"),'<span class="highlight">$1</span>')),b.noteContent=a.trustAsHtml(j),b.$apply();var k=$(document).width(),l=$(document).height(),m=$(f).outerWidth(),n=$(f).outerHeight(),o=g.cx-m/2,p=g.bottom+10;0>o&&(o=10),o+m>k&&(o=k-m-10),p+n>l&&(p=g.top-n-10),b.previewerStyle={left:Math.round(o)+"px",top:Math.round(p)+"px"},b.showNotePreviewer=!0;var q=f[0].querySelector(".highlight");q&&q.scrollIntoView(),h=!0,b.$apply()}var e=b.minder,f=c.children();b.showNotePreviewer=!1,marked.setOptions({gfm:!0,breaks:!0});var g;e.on("shownoterequest",function(a){g=setTimeout(function(){d(a.node)},300)}),e.on("hidenoterequest",function(){clearTimeout(g)});var h=!1;$(document).on("mousedown mousewheel DOMMouseScroll",function(){h&&(b.showNotePreviewer=!1,b.$apply())})}}}]),angular.module("kmEditorUI").directive("priorityEditor",["commandBinder",function(a){return{restrict:"E",templateUrl:"ui/directive/priorityEditor/priorityEditor.html",scope:{minder:"="},link:function(b){for(var c=b.minder,d=[],e=0;10>e;e++)d.push(e);a.bind(c,"priority",b),b.priorities=d,b.getPriorityTitle=function(a){switch(a){case 0:return"移除优先级";default:return"优先级"+a}}}}}]),angular.module("kmEditorUI").directive("progressEditor",["commandBinder",function(a){return{restrict:"E",templateUrl:"ui/directive/progressEditor/progressEditor.html",scope:{minder:"="},link:function(b){for(var c=b.minder,d=[],e=0;10>e;e++)d.push(e);a.bind(c,"progress",b),b.progresses=d,b.getProgressTitle=function(a){switch(a){case 0:return"移除进度";case 1:return"未开始";case 9:return"全部完成";default:return"完成"+(a-1)+"/8"}}}}}]),angular.module("kmEditorUI").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},controller:["$scope",function(a){var b=a.minder,c=!1;b.on("interactchange",function(){var d=a.enabled=-1!=b.queryCommandState("resource"),e=d?b.queryCommandValue("resource"):[],f=b.getUsedResource().map(function(a){return{name:a,selected:e.indexOf(a)>-1}});a.used=f,c=!0,a.$apply(),c=!1}),a.$watch("used",function(a){if(-1!=b.queryCommandState("resource")&&a){var d=a.filter(function(a){return a.selected}).map(function(a){return a.name});if(c)return;b.execCommand("resource",d)}},!0),a.resourceColor=function(a){return b.getResourceColor(a).toHEX()},a.addResource=function(c){var d=b.queryCommandValue("resource");c&&/\S/.test(c)&&(-1==d.indexOf(c)&&a.used.push({name:c,selected:!0}),a.newResourceName=null)}}]}}),a("expose-editor")}();